<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Menu Designer Pro</title>
    <style>
        :root {
            /* Apple Glass Theme Colors */
            --bg-body: #000000;
            --glass-bg: rgba(28, 28, 30, 0.45); /* More translucent */
            --glass-border: rgba(255, 255, 255, 0.12);
            --glass-highlight: rgba(255, 255, 255, 0.05);
            --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.7);
            --blur: blur(25px);
            
            --text-main: #f5f5f7;
            --text-muted: #98989d;
            
            --accent: #0a84ff;
            --danger: #ff453a;
            --success: #30d158;
            --warning: #ff9f0a;
            --purple: #bf5af2;
            
            --font-stack: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: var(--font-stack);
            background: radial-gradient(circle at 50% 0%, #2c3e50, #000000 80%);
            background-attachment: fixed;
            color: var(--text-main);
            margin: 0;
            padding: 15px; /* Mobile friendly padding */
            min-height: 100vh;
            overflow-x: hidden;
        }

        .app-container { 
            max-width: 1000px; 
            margin: 0 auto; 
            display: flex; 
            flex-direction: column; 
            gap: 25px; 
            padding-bottom: 100px; 
        }
        
        /* HEADERS */
        header { margin-bottom: 10px; }
        h1 { text-align: center; margin: 0; font-size: 1.8rem; letter-spacing: -0.5px; font-weight: 700; }
        .app-subtitle { text-align: center; color: var(--text-muted); font-size: 0.9rem; margin-top: 5px; opacity: 0.8; }
        
        .section-title { font-size: 1.2rem; font-weight: 600; margin-bottom: 5px; color: #fff; }
        .section-quote { color: var(--text-muted); font-size: 0.85rem; border-left: 2px solid var(--accent); padding-left: 10px; margin-bottom: 15px; opacity: 0.8; }
        .category-header { 
            color: var(--text-muted); 
            text-transform: uppercase; 
            font-size: 0.75rem; 
            font-weight: 600; 
            margin: 20px 0 10px 5px; 
            letter-spacing: 0.5px; 
        }

        /* GLASS PANELS */
        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border: 1px solid var(--glass-border);
            border-top: 1px solid var(--glass-highlight);
            border-radius: 22px;
            box-shadow: var(--glass-shadow);
            padding: 20px;
            overflow: hidden;
            position: relative;
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        /* HIGHLIGHT EFFECTS */
        /* Desktop Hover */
        @media (min-width: 768px) {
            .glass-panel:hover {
                border-color: rgba(255, 255, 255, 0.4);
                box-shadow: 0 15px 40px rgba(0,0,0,0.8), 0 0 20px rgba(255,255,255,0.05);
                transform: translateY(-4px);
                z-index: 10;
            }
        }
        /* Mobile Active State (Scroll Spy) */
        .glass-panel.highlighted {
            border-color: var(--accent);
            box-shadow: 0 10px 40px rgba(10, 132, 255, 0.15);
            background: rgba(40, 40, 45, 0.6);
            transform: scale(1.01);
        }

        /* --- CONFIGURATION --- */
        .config-grid { display: grid; grid-template-columns: 1fr; gap: 20px; }
        @media (min-width: 768px) { .config-grid { grid-template-columns: 1fr 1fr; } }
        
        .inputs-container { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        
        .input-group { display: flex; flex-direction: column; gap: 5px; }
        .input-label { color: var(--text-muted); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px; }
        
        .glass-input {
            width: 100%; 
            background: rgba(0, 0, 0, 0.2); 
            border: 1px solid var(--glass-border);
            color: var(--text-main); 
            padding: 12px; 
            border-radius: 12px; 
            text-align: center; 
            font-weight: 500; 
            font-size: 0.9rem; /* Adjusted for dropdown text */
            outline: none;
            transition: border-color 0.2s;
        }
        .glass-input:focus { border-color: var(--accent); background: rgba(0,0,0,0.4); }
        select.glass-input { appearance: none; text-align-last: center; }

        .calc-display { background: rgba(0, 0, 0, 0.2); border-radius: 16px; padding: 15px; border: 1px solid var(--glass-border); }
        .calc-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        .calc-table th { text-align: right; color: var(--text-muted); padding-bottom: 8px; font-weight: 500; font-size: 0.7rem; width: 25%; }
        .calc-table th:first-child { text-align: left; width: 50%; }
        .calc-table td { padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .val-col { text-align: right; font-family: "SF Mono", monospace; font-weight: 600; }
        
        /* --- CAROUSEL / SWIPE --- */
        .swipe-row {
            display: flex; 
            gap: 15px; 
            overflow-x: auto; 
            scroll-snap-type: x mandatory;
            padding: 10px 5px 20px 5px; /* Bottom padding for shadow */
            margin: 0 -20px; /* Bleed to edges */
            padding-left: 20px; /* Restore padding */
            padding-right: 20px;
            -webkit-overflow-scrolling: touch;
        }
        .swipe-row::-webkit-scrollbar { display: none; }

        .food-card {
            flex: 0 0 140px; 
            scroll-snap-align: center;
            background: rgba(60, 60, 60, 0.3); 
            border-radius: 18px; 
            overflow: hidden;
            border: 1px solid transparent; 
            position: relative; 
            cursor: pointer;
            transition: transform 0.2s, background 0.2s;
            display: flex; flex-direction: column;
        }
        .food-card:active { transform: scale(0.96); }
        .food-card.active { 
            border-color: rgba(255, 255, 255, 0.4); 
            background: rgba(80, 80, 80, 0.5); 
            box-shadow: 0 0 15px rgba(255,255,255,0.1);
        }
        
        .card-img { width: 100%; height: 100px; object-fit: cover; opacity: 0.9; display: block; }
        .card-content { padding: 10px; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .card-title { font-weight: 600; font-size: 0.85rem; margin-bottom: 4px; line-height: 1.2; }
        .card-details { font-size: 0.7rem; color: var(--text-muted); display: flex; justify-content: space-between; margin-top: 5px; }

        /* INDICATORS */
        .meal-indicator {
            position: absolute; top: 8px; right: 8px; 
            width: 24px; height: 24px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.7rem; font-weight: 800; color: white; 
            opacity: 0; transform: scale(0.5); transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        .status-b { background: var(--warning); opacity: 1; transform: scale(1); }
        .status-l { background: var(--success); opacity: 1; transform: scale(1); }
        .status-d { background: var(--purple); opacity: 1; transform: scale(1); }

        /* --- SELECTED MENU (Mobile Columns) --- */
        .selected-grid { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 8px; 
            align-items: start;
        }
        
        .selected-col h4 { 
            text-align: center; 
            margin: 0 0 10px 0; 
            color: var(--text-muted); 
            text-transform: uppercase; 
            font-size: 0.65rem; 
            letter-spacing: 1px;
        }
        
        .selected-card {
            display: flex; 
            flex-direction: column; /* Stack vertically for mobile columns */
            align-items: center; 
            text-align: center;
            background: rgba(255,255,255,0.06); 
            border-radius: 12px; 
            padding: 6px; 
            margin-bottom: 6px;
            border: 1px solid rgba(255,255,255,0.05);
            animation: popIn 0.3s ease;
        }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .selected-card img { width: 100%; aspect-ratio: 1; border-radius: 8px; object-fit: cover; margin-bottom: 5px; }
        .selected-card .info { font-size: 0.65rem; font-weight: 500; line-height: 1.2; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; }
        
        .sel-b { border-bottom: 2px solid var(--warning); }
        .sel-l { border-bottom: 2px solid var(--success); }
        .sel-d { border-bottom: 2px solid var(--purple); }

        /* --- SUMMARY TABLE --- */
        .summary-wrapper { overflow-x: auto; margin: 0 -20px; padding: 0 20px; }
        .summary-table { width: 100%; border-collapse: collapse; min-width: 300px; }
        .summary-table th { text-align: center; color: var(--accent); font-size: 0.7rem; text-transform: uppercase; padding: 10px 2px; border-bottom: 1px solid var(--glass-border); }
        .summary-table th:first-child { text-align: left; }
        .summary-table td { padding: 12px 2px; border-bottom: 1px solid rgba(255,255,255,0.03); font-size: 0.8rem; text-align: center; }
        .summary-table td:first-child { text-align: left; font-weight: 600; }
        .summary-table tfoot td { font-weight: bold; font-size: 0.9rem; border-top: 2px solid var(--glass-border); border-bottom: none; padding-top: 15px; }
        .dot { display: inline-block; width: 6px; height: 6px; border-radius: 50%; margin-right: 6px; vertical-align: middle; }

        /* --- KITCHEN / SHOPPING --- */
        .shop-category { color: var(--accent); font-size: 0.8rem; font-weight: 700; margin: 20px 0 8px 0; border-bottom: 1px solid var(--glass-border); padding-bottom: 2px; letter-spacing: 0.5px; }
        /* Updated Grid for 5 columns */
        .shop-item { display: grid; grid-template-columns: 2fr 0.8fr 0.8fr 0.8fr 0.8fr; align-items: center; font-size: 0.85rem; padding: 8px 0; border-bottom: 1px dashed rgba(255,255,255,0.05); }
        .shop-amt { font-family: "SF Mono", monospace; color: var(--text-muted); font-size: 0.75rem; text-align: right; }
        .shop-unit { font-family: "SF Mono", monospace; color: var(--text-main); font-weight: bold; text-align: right; }
        
        /* PRICE TABLES */
        .price-table { width: 100%; margin-bottom: 20px; border-collapse: collapse; }
        .price-table th { text-align: right; font-size: 0.7rem; color: var(--text-muted); border-bottom: 1px solid var(--glass-border); padding: 5px; }
        .price-table th:first-child { text-align: left; }
        .price-table td { padding: 8px 5px; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 0.85rem; text-align: right; font-family: "SF Mono", monospace; }
        .price-table td:first-child { text-align: left; font-family: var(--font-stack); }

        /* CHEF JUMPS */
        .chef-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px; }
        .chef-jump { 
            background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); 
            border-radius: 12px; height: 60px; display: flex; align-items: center; justify-content: center;
            font-size: 0.8rem; font-weight: 600; color: var(--text-muted); cursor: not-allowed;
            transition: 0.2s;
        }
        .chef-jump:hover { background: rgba(255,255,255,0.1); color: white; }

        /* --- FOOTER --- */
        .ascii-art { font-family: monospace; white-space: pre; text-align: center; color: var(--accent); font-size: 0.5rem; opacity: 0.7; margin-top: 40px; margin-bottom: 20px; line-height: 8px; }
        .placeholder-box { border: 1px dashed var(--glass-border); background: rgba(0,0,0,0.2); padding: 20px; text-align: center; border-radius: 12px; opacity: 0.7; color: var(--text-muted); font-size: 0.9rem; }

    </style>
</head>
<body>

<div class="app-container">

    <header>
        <h1>Menu Designer</h1>
        <div class="app-subtitle">Feed Yourself Logic</div>
    </header>

    <section class="glass-panel">
        <div class="section-title">Configuration</div>
        <blockquote class="section-quote">Math is hard. Eating is easy.</blockquote>
        
        <div class="config-grid">
            <div class="inputs-container">
                <div class="input-group">
                    <label class="input-label">BMR (kcal)</label>
                    <input type="number" id="inBase" class="glass-input" value="2000" onchange="calculate()">
                </div>
                
                <div class="input-group">
                    <label class="input-label">Active (kcal)</label>
                    <input type="number" id="inActive" class="glass-input" value="200" onchange="calculate()">
                </div>
                
                <div class="input-group">
                    <label class="input-label">Deficit</label>
                    <input type="number" id="inDeficit" class="glass-input" value="50" onchange="calculate()">
                </div>

                <div class="input-group">
                    <label class="input-label">Protein Target</label>
                    <select id="inProtein" class="glass-input" onchange="calculate()">
                        <option value="60">Minimum (60g)</option>
                        <option value="80">Ideal (80g)</option>
                        <option value="100" selected>High (100g)</option>
                        <option value="150">Bodybuilding (150g)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label class="input-label">Carb Mode</label>
                    <select id="inCarbMode" class="glass-input" onchange="calculate()">
                        <option value="50">Keto (<50g)</option>
                        <option value="150" selected>Low Carb (150g)</option>
                        <option value="250">Normal (250g)</option>
                        <option value="400">Bodybuilding (High)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label class="input-label">Prot Cost (kcal/g)</label>
                    <select id="inCost" class="glass-input" onchange="calculate()">
                        <option value="5">Cheap (5)</option>
                        <option value="7" selected>Medium (7)</option>
                        <option value="10">Expensive (10)</option>
                    </select>
                </div>
            </div>

            <div class="calc-display">
                <div class="section-title" style="font-size:0.9rem; margin-bottom:10px; opacity:0.8;">Daily Targets</div>
                <table class="calc-table">
                    <thead>
                        <tr>
                            <th></th>
                            <th>Daily</th>
                            <th>Per Meal</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Net Kcal Budget</td>
                            <td class="val-col" id="outTotalKcal" style="color:white; font-size:1.1rem;">0</td>
                            <td class="val-col" id="outTotalKcalMeal" style="color:var(--text-muted); font-size:1rem;">0</td>
                        </tr>
                        <tr>
                            <td>Target Protein</td>
                            <td class="val-col" id="outProtG">0g</td>
                            <td class="val-col" id="outProtGMeal">0g</td>
                        </tr>
                        <tr>
                            <td>Target Carbs (Limit)</td>
                            <td class="val-col" id="outCarbsLimit">0g</td>
                            <td class="val-col" id="outCarbsLimitMeal">0g</td>
                        </tr>
                        <tr>
                            <td style="padding-top:10px; border:none; opacity:0.6; font-size:0.75rem;" colspan="3">Budget Allocation</td>
                        </tr>
                        <tr>
                            <td>↳ Protein Sources</td>
                            <td class="val-col" id="outProtKcal">0</td>
                            <td class="val-col" id="outProtKcalMeal">0</td>
                        </tr>
                        <tr>
                            <td>↳ Sides/Fats (Leftover)</td>
                            <td class="val-col" style="color:var(--accent)" id="outSidesKcal">0</td>
                            <td class="val-col" style="color:var(--accent)" id="outSidesKcalMeal">0</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <section class="glass-panel">
        <div class="section-title">Protein Source</div>
        <blockquote class="section-quote">Tap: 1x Breakfast, 2x Lunch, 3x Dinner</blockquote>

        <div class="category-header">Vegan Sources</div>
        <div class="swipe-row" id="row-vegan"></div>

        <div class="category-header">Vegetarian</div>
        <div class="swipe-row" id="row-veg"></div>

        <div class="category-header">Meat & Fish</div>
        <div class="swipe-row" id="row-meat"></div>
    </section>

    <section class="glass-panel">
        <div class="section-title">Sides</div>
        <blockquote class="section-quote">Greens & Beige Carbs. Swipe to explore.</blockquote>
        
        <div class="category-header">Vegan Sides</div>
        <div class="swipe-row" id="row-side-vegan"></div>
        
        <div class="category-header">Vegetarian/Dairy Sides</div>
        <div class="swipe-row" id="row-side-veg"></div>
    </section>

    <section class="glass-panel">
        <div class="section-title">Selected Menu</div>
        <blockquote class="section-quote">Your daily masterpiece.</blockquote>
        <div class="selected-grid">
            <div class="selected-col" id="col-b">
                <h4>Breakfast</h4>
                <div id="list-b"></div>
            </div>
            <div class="selected-col" id="col-l">
                <h4>Lunch</h4>
                <div id="list-l"></div>
            </div>
            <div class="selected-col" id="col-d">
                <h4>Dinner</h4>
                <div id="list-d"></div>
            </div>
        </div>
    </section>

    <section class="glass-panel">
        <div class="section-title">Summary</div>
        <blockquote class="section-quote">The nutritional damage report.</blockquote>

        <div class="summary-wrapper">
            <table class="summary-table">
                <thead>
                    <tr>
                        <th style="width: 25%">Meal</th>
                        <th style="width: 15%">Kcal</th>
                        <th style="width: 15%">Prot</th>
                        <th style="width: 15%">Carb</th>
                        <th style="width: 15%">Fat</th>
                        <th style="width: 15%">Kcal/P</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="dot" style="background:var(--warning)"></span> Bkfst</td>
                        <td id="m1-kcal">0</td>
                        <td id="m1-prot">0</td>
                        <td id="m1-carb">0</td>
                        <td id="m1-fat">0</td>
                        <td id="m1-ratio">-</td>
                    </tr>
                    <tr>
                        <td><span class="dot" style="background:var(--success)"></span> Lunch</td>
                        <td id="m2-kcal">0</td>
                        <td id="m2-prot">0</td>
                        <td id="m2-carb">0</td>
                        <td id="m2-fat">0</td>
                        <td id="m2-ratio">-</td>
                    </tr>
                    <tr>
                        <td><span class="dot" style="background:var(--purple)"></span> Dinner</td>
                        <td id="m3-kcal">0</td>
                        <td id="m3-prot">0</td>
                        <td id="m3-carb">0</td>
                        <td id="m3-fat">0</td>
                        <td id="m3-ratio">-</td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <td>TOTAL</td>
                        <td id="grand-total" style="color:var(--accent);">0</td>
                        <td id="grand-prot">0</td>
                        <td id="grand-carb">0</td>
                        <td id="grand-fat">0</td>
                        <td id="grand-ratio">-</td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </section>

    <section class="glass-panel">
        <div class="section-title">Shopping List</div>
        <blockquote class="section-quote">Shopping List. Don't go hungry.</blockquote>
        <div class="summary-table" style="margin-bottom:10px;">
            <div class="shop-item" style="border-bottom:1px solid var(--glass-border); color:var(--text-muted); font-size:0.7rem;">
                <span>ITEM</span>
                <span style="text-align:right">GRAMS</span>
                <span style="text-align:right">UNITS</span>
                <span style="text-align:right">$/KG</span>
                <span style="text-align:right">TOTAL $</span>
            </div>
        </div>
        <div id="shopping-list-container">
            <div style="text-align:center; color:#666; padding:20px; font-size:0.8rem;">Add items to menu to generate list</div>
        </div>
    </section>

    <section class="glass-panel">
        <div class="section-title">Price</div>
        <blockquote class="section-quote">Where it hurts</blockquote>
        
        <div id="price-analysis-container">
            <div class="placeholder-box">Add items to menu to calculate costs</div>
        </div>
    </section>

    <section class="glass-panel">
        <div class="section-title">Chef's Table</div>
        <blockquote class="section-quote">Recipes where the magic happens.</blockquote>
        
        <div class="chef-grid">
            <div class="chef-jump">Quick Prep</div>
            <div class="chef-jump">Batch Cook</div>
            <div class="chef-jump">Sauces</div>
            <div class="chef-jump">Spices</div>
        </div>
    </section>

    <div class="ascii-art">
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⣶⣶⣶⣶⣶⣦⡀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⣿⣿⣿⣿⣿⣿⣿⣿⣿⣄⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡆⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠏⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠛⢿⣿⣿⣿⣿⡿⠟⠁⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠉⠉⠁⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣴⡶⠶⠶⠶⠶⠶⢶⣦⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣸⡿⠁⠀⠀⠀⠀⠀⠀⢿⣇⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣿⡇⠀⠀⠀⠀⠀⠀⠀⢸⣿⡀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⡇⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⡇⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⡇⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⡇⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣿⡀⠀⠀⠀⠀⠀⠀⠀⢀⣿⡇⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢿⣇⠀⠀⠀⠀⠀⠀⠀⣸⡿⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠿⣦⣤⣤⣤⣤⣤⣴⠿⠁⠀⠀⠀
        FEED YOURSELF
    </div>

</div>

<script>
    /* --- DATA (Enhanced with Fat/Carbs/UnitSize/PricePerKg) --- */
    // Added 'priceKg' (Approx $) to items
    const proteins = [
        // Vegan
        { id: 'p1', name: 'Super Firm Tofu', type: 'Vegan', sub: 'vegan', grams: 200, unitG: 400, unitName: 'pack', shopCat: 'Fridge (Vegan)', prot: 32, carb: 8, fat: 18, kcal: 320, priceKg: 8.50, img: 'https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=400' },
        { id: 'p2', name: 'Tempeh', type: 'Vegan', sub: 'vegan', grams: 150, unitG: 200, unitName: 'pack', shopCat: 'Fridge (Vegan)', prot: 30, carb: 14, fat: 16, kcal: 320, priceKg: 12.00, img: 'https://images.unsplash.com/photo-1511421654771-178547557199?w=400' },
        { id: 'p3', name: 'Edamame Beans', type: 'Vegan', sub: 'vegan', grams: 200, unitG: 500, unitName: 'bag', shopCat: 'Freezer', prot: 24, carb: 20, fat: 10, kcal: 240, priceKg: 6.00, img: 'https://images.unsplash.com/photo-1626133493003-f44d6698879b?w=400' },
        // Vegetarian
        { id: 'p4', name: 'Greek Yogurt', type: 'Veg', sub: 'veg', grams: 300, unitG: 500, unitName: 'tub', shopCat: 'Dairy', prot: 30, carb: 12, fat: 0, kcal: 180, priceKg: 5.50, img: 'https://images.unsplash.com/photo-1488477181946-6428a0291777?w=400' },
        { id: 'p5', name: 'Cottage Cheese', type: 'Veg', sub: 'veg', grams: 250, unitG: 300, unitName: 'tub', shopCat: 'Dairy', prot: 28, carb: 8, fat: 10, kcal: 240, priceKg: 7.00, img: 'https://images.unsplash.com/photo-1596708703869-d2d8544c0628?w=400' },
        { id: 'p6', name: 'Eggs (3 Whole)', type: 'Veg', sub: 'veg', grams: 150, unitG: 50, unitName: 'egg', shopCat: 'Dairy', prot: 18, carb: 2, fat: 15, kcal: 210, priceKg: 4.00, img: 'https://images.unsplash.com/photo-1596634629427-04664539c43a?w=400' },
        // Meat
        { id: 'p7', name: 'Chicken Breast', type: 'Meat', sub: 'meat', grams: 150, unitG: 300, unitName: 'breast', shopCat: 'Meat', prot: 46, carb: 0, fat: 5, kcal: 250, priceKg: 11.00, img: 'https://images.unsplash.com/photo-1604908176997-125f25cc6f3d?w=400' },
        { id: 'p8', name: 'White Fish', type: 'Meat', sub: 'meat', grams: 200, unitG: 250, unitName: 'fillet', shopCat: 'Meat', prot: 36, carb: 0, fat: 2, kcal: 180, priceKg: 18.00, img: 'https://images.unsplash.com/photo-1519708227418-c8fd9a3a277d?w=400' },
        { id: 'p9', name: 'Salmon', type: 'Meat', sub: 'meat', grams: 150, unitG: 150, unitName: 'fillet', shopCat: 'Meat', prot: 30, carb: 0, fat: 20, kcal: 350, priceKg: 28.00, img: 'https://images.unsplash.com/photo-1499125562588-29fb8a56b5d5?w=400' },
    ];

    const sides = [
        // Vegan Sides
        { id: 's1', name: 'Jasmine Rice', type: 'Vegan', sub: 'vegan', grams: 150, unitG: 1000, unitName: 'bag', shopCat: 'Pantry', prot: 4, carb: 42, fat: 0, kcal: 200, priceKg: 2.50, img: 'https://images.unsplash.com/photo-1512058564366-18510be2db19?w=400' },
        { id: 's2', name: 'Sweet Potato', type: 'Vegan', sub: 'vegan', grams: 200, unitG: 200, unitName: 'potato', shopCat: 'Veggies', prot: 3, carb: 40, fat: 0, kcal: 180, priceKg: 3.00, img: 'https://images.unsplash.com/photo-1596097635121-14b63b7a0c19?w=400' },
        { id: 's3', name: 'Avocado Salad', type: 'Vegan', sub: 'vegan', grams: 150, unitG: 150, unitName: 'avo', shopCat: 'Veggies', prot: 2, carb: 10, fat: 22, kcal: 240, priceKg: 9.00, img: 'https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=400' },
        { id: 's4', name: 'Broccoli', type: 'Vegan', sub: 'vegan', grams: 150, unitG: 500, unitName: 'head', shopCat: 'Veggies', prot: 4, carb: 10, fat: 0, kcal: 55, priceKg: 4.50, img: 'https://images.unsplash.com/photo-1459411621453-7fb8db8feaa2?w=400' },
        { id: 's5', name: 'Pasta (Pesto)', type: 'Veg', sub: 'veg', grams: 120, unitG: 500, unitName: 'box', shopCat: 'Pantry', prot: 6, carb: 35, fat: 12, kcal: 280, priceKg: 3.50, img: 'https://images.unsplash.com/photo-1473093295043-cdd812d0e601?w=400' },
        { id: 's6', name: 'Green Beans', type: 'Veg', sub: 'veg', grams: 180, unitG: 300, unitName: 'bag', shopCat: 'Veggies', prot: 3, carb: 12, fat: 4, kcal: 100, priceKg: 5.00, img: 'https://images.unsplash.com/photo-1590301157890-4810ed352733?w=400' },
    ];

    const allFood = [...proteins, ...sides];
    let selections = {}; 

    function init() {
        // Render Proteins
        renderGroup(proteins, 'vegan', 'row-vegan');
        renderGroup(proteins, 'veg', 'row-veg');
        renderGroup(proteins, 'meat', 'row-meat');
        
        // Render Sides
        renderGroup(sides, 'vegan', 'row-side-vegan');
        renderGroup(sides, 'veg', 'row-side-veg');
        
        // Start Scroll Spy for Mobile
        setupScrollSpy();

        calculate();
    }

    function setupScrollSpy() {
        // Intersection Observer for highlighting sections on scroll
        const options = {
            root: null,
            rootMargin: '-40% 0px -40% 0px', // Trigger when element is in the vertical center
            threshold: 0
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if(entry.isIntersecting) {
                    // Remove highlight from others
                    document.querySelectorAll('.glass-panel').forEach(p => p.classList.remove('highlighted'));
                    // Add to current
                    entry.target.classList.add('highlighted');
                }
            });
        }, options);

        document.querySelectorAll('.glass-panel').forEach(panel => {
            observer.observe(panel);
        });
    }

    function renderGroup(data, sub, elId) {
        const container = document.getElementById(elId);
        container.innerHTML = data.filter(i => i.sub === sub).map(item => `
            <div class="food-card" id="card-${item.id}" onclick="tapCard('${item.id}')">
                <div class="meal-indicator" id="badge-${item.id}"></div>
                <img src="${item.img}" class="card-img" loading="lazy">
                <div class="card-content">
                    <div class="card-title">${item.name}</div>
                    <div class="card-details">
                        <span>${item.kcal} kc</span>
                        <span>${item.prot}p</span>
                    </div>
                </div>
            </div>
        `).join('');
    }

    /* --- LOGIC: MULTI-TAP --- */
    function tapCard(id) {
        if (!selections[id]) selections[id] = 0;
        selections[id]++;
        if (selections[id] > 3) selections[id] = 0;

        updateVisuals(id);
        updateState();
    }

    function updateVisuals(id) {
        const card = document.getElementById(`card-${id}`);
        const badge = document.getElementById(`badge-${id}`);
        const state = selections[id];

        card.classList.remove('active');
        badge.className = 'meal-indicator';
        badge.innerText = '';

        if (state > 0) {
            card.classList.add('active');
            if (state === 1) { badge.classList.add('status-b'); badge.innerText = 'B'; }
            if (state === 2) { badge.classList.add('status-l'); badge.innerText = 'L'; }
            if (state === 3) { badge.classList.add('status-d'); badge.innerText = 'D'; }
        }
    }

    function updateState() {
        // Data structure for 3 meals
        const meals = { 
            1: {k:0, p:0, c:0, f:0, i:[]}, 
            2: {k:0, p:0, c:0, f:0, i:[]}, 
            3: {k:0, p:0, c:0, f:0, i:[]} 
        };
        
        // Clear selected views
        ['list-b', 'list-l', 'list-d'].forEach(id => document.getElementById(id).innerHTML = '');

        const colMap = {1:'list-b', 2:'list-l', 3:'list-d'};
        const clsMap = {1:'sel-b', 2:'sel-l', 3:'sel-d'};

        Object.keys(selections).forEach(id => {
            const qty = selections[id];
            if (qty > 0) {
                const item = allFood.find(f => f.id === id);
                // Macros Sum
                meals[qty].k += (item.kcal || 0);
                meals[qty].p += (item.prot || 0);
                meals[qty].c += (item.carb || 0);
                meals[qty].f += (item.fat || 0);
                meals[qty].i.push(item.name);

                // Render Tiny Card in Selected Column (With Image)
                const div = document.createElement('div');
                div.className = `selected-card ${clsMap[qty]}`;
                div.innerHTML = `
                    <img src="${item.img}">
                    <div class="info">${item.name}</div>
                `;
                document.getElementById(colMap[qty]).appendChild(div);
            }
        });

        // Update Summary Table Rows
        updateSumRow(1, meals[1]);
        updateSumRow(2, meals[2]);
        updateSumRow(3, meals[3]);

        // Grand Totals
        const tK = meals[1].k + meals[2].k + meals[3].k;
        const tP = meals[1].p + meals[2].p + meals[3].p;
        const tC = meals[1].c + meals[2].c + meals[3].c;
        const tF = meals[1].f + meals[2].f + meals[3].f;
        
        const gTotal = document.getElementById('grand-total');
        gTotal.innerText = tK;
        
        // Color warning if over budget
        const budget = parseInt(document.getElementById('outTotalKcal').innerText) || 9999;
        gTotal.style.color = tK > budget ? 'var(--danger)' : 'var(--accent)';
        
        document.getElementById('grand-prot').innerText = tP;
        document.getElementById('grand-carb').innerText = tC;
        document.getElementById('grand-fat').innerText = tF;

        // Ratio for Grand Total
        const gRatio = tP > 0 ? (tK / tP).toFixed(1) : '-';
        document.getElementById('grand-ratio').innerText = gRatio;

        renderShoppingList();
    }

    function updateSumRow(n, data) {
        // data = { k, p, c, f, i }
        document.getElementById(`m${n}-kcal`).innerText = data.k;
        document.getElementById(`m${n}-prot`).innerText = data.p;
        document.getElementById(`m${n}-carb`).innerText = data.c;
        document.getElementById(`m${n}-fat`).innerText = data.f;
        
        // Calc Kcal/Protein Ratio
        const ratio = data.p > 0 ? (data.k / data.p).toFixed(1) : '-';
        document.getElementById(`m${n}-ratio`).innerText = ratio;
    }

    /* --- SHOPPING LIST WITH UNITS & PRICES --- */
    function renderShoppingList() {
        const container = document.getElementById('shopping-list-container');
        const shopData = {};
        // Explicit ordering
        const cats = ['Veggies', 'Fruits', 'Fridge (Vegan)', 'Dairy', 'Meat', 'Freezer', 'Pantry', 'Others'];

        // Aggregate
        Object.keys(selections).forEach(id => {
            const count = selections[id];
            if(count > 0) {
                const item = allFood.find(f => f.id === id);
                const cat = item.shopCat || 'Others';
                if(!shopData[cat]) shopData[cat] = [];
                
                // Check if item exists in cat to sum grams
                const existing = shopData[cat].find(x => x.name === item.name);
                if(existing) {
                    existing.g += (item.grams * count);
                } else {
                    shopData[cat].push({ 
                        name: item.name, 
                        g: item.grams * count,
                        unitSize: item.unitG || 100,
                        priceKg: item.priceKg,
                        isProtein: item.id.startsWith('p') // Simple check based on ID prefix for second table
                    });
                }
            }
        });

        // Render Shopping List
        let html = '';
        let hasItems = false;
        let flatItemsForPrice = [];
        
        cats.forEach(cat => {
            if(shopData[cat] && shopData[cat].length > 0) {
                hasItems = true;
                html += `<div class="shop-category">${cat}</div>`;
                shopData[cat].forEach(i => {
                    // Calculate Units
                    const units = (i.g / i.unitSize).toFixed(1);
                    const unitDisplay = units.endsWith('.0') ? units.slice(0, -2) : units;
                    
                    // Calculate Price
                    const priceTotal = (i.g / 1000) * i.priceKg;
                    
                    // Add to flat array for price tables
                    flatItemsForPrice.push({...i, cat: cat, total: priceTotal});

                    html += `
                        <div class="shop-item">
                            <span>${i.name}</span>
                            <span class="shop-amt">${i.g}g</span>
                            <span class="shop-unit">${unitDisplay} u</span>
                            <span class="shop-amt">$${i.priceKg.toFixed(2)}</span>
                            <span class="shop-unit" style="color:var(--success)">$${priceTotal.toFixed(2)}</span>
                        </div>
                    `;
                });
            }
        });

        if(!hasItems) html = '<div style="text-align:center; color:#666; padding:20px; font-size:0.8rem;">Add items to menu to generate list</div>';
        container.innerHTML = html;

        // Trigger Price Tables Render
        renderPriceTables(flatItemsForPrice, cats, hasItems);
    }

    function renderPriceTables(items, cats, hasItems) {
        const container = document.getElementById('price-analysis-container');
        if(!hasItems) {
             container.innerHTML = '<div class="placeholder-box">Add items to menu to calculate costs</div>';
             return;
        }

        // --- Table 1: Organized by Category (ONLY) ---
        let t1 = `
        <div class="category-header" style="margin-top:0;">Breakdown by Category</div>
        <table class="price-table">
            <thead>
                <tr>
                    <th>Category</th>
                    <th>Total Amt (g)</th>
                    <th>Total $</th>
                </tr>
            </thead>
            <tbody>
        `;
        
        let grandTotal = 0;

        cats.forEach(cat => {
            const catItems = items.filter(i => i.cat === cat);
            if(catItems.length > 0) {
                // Sum totals for this category
                const catTotal = catItems.reduce((sum, item) => sum + item.total, 0);
                const catWeight = catItems.reduce((sum, item) => sum + item.g, 0);
                
                grandTotal += catTotal;
                
                // Add ONE row for the category
                t1 += `
                    <tr>
                        <td style="color:var(--accent); font-weight:500;">${cat}</td>
                        <td>${catWeight}g</td>
                        <td>$${catTotal.toFixed(2)}</td>
                    </tr>
                `;
            }
        });
        
        t1 += `
            <tr style="border-top: 1px solid white;">
                <td colspan="2" style="font-weight:bold; color:white;">Total</td>
                <td style="font-weight:bold; color:var(--success);">$${grandTotal.toFixed(2)}</td>
            </tr>
            </tbody></table>`;


        // --- Table 2: Protein Items vs Sides Items (UNCHANGED) ---
        let protSum = 0;
        let sideSum = 0;
        
        const protItems = items.filter(i => i.isProtein);
        const sideItems = items.filter(i => !i.isProtein);

        let t2 = `
        <div class="category-header">Breakdown by Types</div>
        <table class="price-table">
            <thead>
                <tr>
                    <th>Type</th>
                    <th>Amt (g)</th>
                    <th>Avg $/kg</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody>
        `;

        // Protein Row
        if(protItems.length > 0) {
            const totalG = protItems.reduce((a,b) => a + b.g, 0);
            const totalCost = protItems.reduce((a,b) => a + b.total, 0);
            const avgPrice = (totalCost / (totalG/1000));
            protSum = totalCost;
            
            t2 += `
                <tr>
                    <td style="color:var(--accent)">Protein Items</td>
                    <td>${totalG}</td>
                    <td>${avgPrice.toFixed(2)}</td>
                    <td>$${totalCost.toFixed(2)}</td>
                </tr>
            `;
        }

        // Side Row
        if(sideItems.length > 0) {
            const totalG = sideItems.reduce((a,b) => a + b.g, 0);
            const totalCost = sideItems.reduce((a,b) => a + b.total, 0);
            const avgPrice = (totalCost / (totalG/1000));
            sideSum = totalCost;
            
            t2 += `
                <tr>
                    <td style="color:var(--warning)">Sides Items</td>
                    <td>${totalG}</td>
                    <td>${avgPrice.toFixed(2)}</td>
                    <td>$${totalCost.toFixed(2)}</td>
                </tr>
            `;
        }

        t2 += `
            <tr style="border-top: 1px solid white;">
                <td colspan="3" style="font-weight:bold; color:white;">Total</td>
                <td style="font-weight:bold; color:var(--success);">$${(protSum + sideSum).toFixed(2)}</td>
            </tr>
            </tbody></table>`;

        container.innerHTML = t1 + t2;
    }

    /* --- CALCULATOR --- */
    function calculate() {
        const base = parseInt(document.getElementById('inBase').value) || 0;
        const active = parseInt(document.getElementById('inActive').value) || 0;
        const deficit = parseInt(document.getElementById('inDeficit').value) || 0;
        const proteinTarget = parseInt(document.getElementById('inProtein').value) || 0;
        const cost = parseInt(document.getElementById('inCost').value) || 10;
        
        // Carb Mode
        const carbLimit = parseInt(document.getElementById('inCarbMode').value) || 250;

        const totalNet = base + active - deficit;
        const proteinKcal = proteinTarget * cost; // Approx cost of protein source
        const sidesKcal = totalNet - proteinKcal;
        
        // Update DOM
        const set = (id, val) => document.getElementById(id).innerText = val;

        // Daily
        set('outTotalKcal', totalNet);
        set('outProtKcal', proteinKcal);
        set('outSidesKcal', sidesKcal);
        set('outProtG', proteinTarget + 'g');
        set('outCarbsLimit', carbLimit + 'g');

        // Per Meal (/3)
        set('outTotalKcalMeal', Math.round(totalNet / 3));
        set('outProtKcalMeal', Math.round(proteinKcal / 3));
        set('outSidesKcalMeal', Math.round(sidesKcal / 3));
        set('outProtGMeal', Math.round(proteinTarget / 3) + 'g');
        set('outCarbsLimitMeal', Math.round(carbLimit / 3) + 'g');
        
        // Dynamic re-render to check budget coloring
        updateState();
    }

    window.onload = init;
</script>

</body>
</html>

