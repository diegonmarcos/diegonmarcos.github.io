(()=>{function B(){document.addEventListener("mousemove",t=>{let e=document.querySelectorAll(".doc-icon"),n=document.querySelectorAll(".glow-spot"),s=(t.clientX/window.innerWidth-.5)*30,i=(t.clientY/window.innerHeight-.5)*30;e.forEach((l,a)=>{let r=(a%4+1)*.4,L=s*.1*r;l.style.transform=`translate(${s*r}px, ${i*r}px) rotate(${L}deg)`}),n.forEach((l,a)=>{let r=(a+1)*.15;l.style.transform=`translate(${s*r}px, ${i*r}px) scale(${1+Math.abs(s*.002)})`})})}function c(){let t=document.querySelector(".service-table.active"),e=t?t.querySelector(".service-option.active"):null,n=document.querySelector(".auth-btn.active"),s=e&&e.dataset.name||"Service",i=e&&e.dataset.url||"#",l=e&&e.dataset.config||"#",a=n&&n.dataset.authPrefix||"",r=e?e.querySelector(".service-desc"):null,L=r&&r.textContent||"",M=document.getElementById("tool-name-app"),x=document.getElementById("go-app-btn"),b=document.getElementById("go-config-btn"),A=document.getElementById("info-app-name"),C=document.getElementById("info-app-desc");M&&(M.textContent=s),x&&(x.href=a?a+encodeURIComponent(i):i),b&&(b.href=a?a+encodeURIComponent(l):l),A&&(A.textContent=s),C&&(C.textContent=L)}var $=["theme-sheets","theme-docs","theme-slides","theme-photos","theme-files","theme-notes","theme-lgtm","theme-powersheets","theme-videos"];function I(t){document.body.classList.remove(...$),document.body.classList.add("theme-"+t)}function H(){let t=document.querySelectorAll(".category-tabs .category-tab, .category-tabs-row2 .category-tab"),e=document.querySelectorAll(".service-table");t.forEach(n=>{n.addEventListener("click",function(){let s=this.dataset.category;s&&(t.forEach(i=>i.classList.remove("active")),this.classList.add("active"),e.forEach(i=>{i.classList.remove("active"),i.dataset.category===s&&i.classList.add("active")}),I(s),c())})}),e.forEach(n=>{let s=n.querySelectorAll(".service-option:not(.coming-soon):not(.not-deployed)");s.forEach(i=>{i.addEventListener("click",function(){s.forEach(l=>l.classList.remove("active")),this.classList.add("active"),c()})})}),I("notes")}function w(){let t=document.querySelectorAll(".auth-btn");t.forEach(e=>{e.addEventListener("click",function(){t.forEach(n=>n.classList.remove("active")),this.classList.add("active"),c()})})}var E="https://api.diegonmarcos.com",V="oci-flex",S=null,y=null,P=null,N=null,R=null,m=null,f=null,v=null,o=null,d=null,g=null;async function D(){if(S)return S;try{let t=await fetch(`${E}/rust/health/ids`,{signal:AbortSignal.timeout(5e3)});if(!t.ok)return null;let e=await t.json();for(let[n,s]of Object.entries(e.vms||{}))if(s.label===V)return S=n,y=`${E}/rust/health/${n}`,P=`${E}/rust/vms/${n}/start`,N=`${E}/rust/vms/${n}/stop`,R=`${E}/rust/vms/${n}/reset`,n}catch(t){console.log("VM discovery failed:",t.message)}return null}function p(t,e){!d||!g||(d.className="status-dot",t==="RUNNING"?(d.classList.add("online"),g.textContent=e||"Server Online"):t==="STOPPED"||t==="STOPPING"?(d.classList.add("offline"),g.textContent=e||"Server Offline (Sleeping)"):t==="STARTING"?(d.classList.add("checking"),g.textContent=e||"Server Starting..."):(d.classList.add("checking"),g.textContent=e||"Checking..."))}function h(t){!m||!f||!v||(t==="running"?(m.disabled=!0,f.disabled=!1,v.disabled=!1):t==="stopped"?(m.disabled=!1,f.disabled=!0,v.disabled=!0):(m.disabled=!0,f.disabled=!0,v.disabled=!0))}async function u(){try{if(await D(),!y)throw new Error("VM not discovered");let t=await fetch(y,{method:"GET",signal:AbortSignal.timeout(8e3)});if(t.ok){let e=await t.json(),n=e.provider_state;e.health==="online"||e.ping===!0?(p("RUNNING","Server Online"),h("running"),o&&(o.textContent="")):n==="STARTING"?(p("STARTING","Server Starting..."),h("loading"),o&&(o.textContent="VM is starting up...")):n==="RUNNING"?(p("STOPPED","Server Degraded (Not Responding)"),h("running"),o&&(o.textContent="Server is running but not responding. Try Reset.")):(p("STOPPED","Server Offline (Sleeping)"),h("stopped"),o&&(o.textContent="Drive server is sleeping."))}else throw new Error("API unavailable")}catch(t){console.log("Status check error:",t.message),p("STOPPED","Status Unknown"),h("stopped"),o&&(o.textContent="Could not check server status.")}}async function T(t){if(!S){o&&(o.textContent="VM not discovered");return}let n={start:P,stop:N,reset:R}[t];if(n){h("loading"),o&&(o.textContent=`Sending ${t} command...`);try{let s=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"}});if(s.ok){let i={start:"VM starting...",stop:"VM stopping...",reset:"VM resetting..."};o&&(o.textContent=i[t]),p(t==="stop"?"STOPPING":"STARTING"),setTimeout(()=>u(),1e4),setTimeout(()=>u(),3e4),setTimeout(()=>u(),6e4)}else{let i=await s.json().catch(()=>({}));o&&(o.textContent=i.message||`${t} failed`),await u()}}catch{o&&(o.textContent="Could not reach API."),await u()}}}function k(){m=document.getElementById("vm-start-btn"),f=document.getElementById("vm-stop-btn"),v=document.getElementById("vm-reset-btn"),o=document.getElementById("wake-status"),d=document.getElementById("status-dot"),g=document.getElementById("status-text"),m&&m.addEventListener("click",()=>T("start")),f&&f.addEventListener("click",()=>T("stop")),v&&v.addEventListener("click",()=>T("reset")),u(),setInterval(u,3e4)}document.addEventListener("DOMContentLoaded",()=>{B(),H(),w(),k(),c()});})();
