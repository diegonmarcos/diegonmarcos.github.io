<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geopolitical World Map (Country Granularity)</title>

    <!-- LIBRARIES -->
    <script src="https://code.highcharts.com/maps/highmaps.js"></script>
    <script src="https://code.highcharts.com/maps/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/maps/modules/offline-exporting.js"></script>
    <script src="https://code.highcharts.com/maps/modules/accessibility.js"></script>

    <!-- MAP GEOMETRY -->
    <script src="https://code.highcharts.com/mapdata/custom/world.js"></script>

    <style>
        body {
            margin: 0;
            padding: 20px;
            background-color: #121212; /* Deep Dark Background */
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            color: #ffffff;
        }

        h1 {
            text-align: center;
            font-weight: 300;
            margin-bottom: 5px;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .subtitle {
            text-align: center;
            color: #888;
            font-size: 0.9em;
            margin-bottom: 30px;
        }

        #container {
            height: 75vh;
            min-height: 500px;
            max-width: 1400px;
            margin: 0 auto;
            border: 1px solid #333;
            border-radius: 4px;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        .legend-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            font-size: 0.8rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            background: #1e1e1e;
            padding: 5px 10px;
            border-radius: 4px;
            border: 1px solid #333;
        }

        .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .loading-msg {
            text-align: center;
            color: #ff4444;
            display: none;
            padding: 20px;
        }
    </style>
</head>
<body>

    <h1>Strategic Balance: 2025</h1>
    <div class="subtitle">Country-Level Granularity • Red (Russia) vs Blue (NATO) vs Grey (Neutral)</div>

    <div id="loading" class="loading-msg">
        <h3>⚠️ Map Data Not Loaded</h3>
        <p>If you see this, your network or browser is blocking the map script (world.js).</p>
        <p>Please check your internet connection or try a different browser.</p>
    </div>

    <div id="container"></div>

    <div class="legend-container">
        <!-- RUSSIA -->
        <div class="legend-item" style="border-left: 3px solid #8B0000">
            <div class="dot" style="background:#8B0000"></div>Russia (Aggressor)
        </div>
        <div class="legend-item">
            <div class="dot" style="background:#CD5C5C"></div>Key Allies (Iran, Belarus)
        </div>
        <div class="legend-item">
            <div class="dot" style="background:#FF8C00"></div>Infrastructure Ties (Kazakhstan)
        </div>

        <!-- NATO -->
        <div class="legend-item" style="border-left: 3px solid #00008B">
            <div class="dot" style="background:#00008B"></div>NATO Core
        </div>
        <div class="legend-item">
            <div class="dot" style="background:#87CEEB"></div>The Frontline (Ukraine)
        </div>

        <!-- NEUTRAL -->
        <div class="legend-item" style="border-left: 3px solid #4F4F4F">
            <div class="dot" style="background:#4F4F4F"></div>Strong Neutral (China, India, Mexico)
        </div>

        <!-- STRATEGIC -->
        <div class="legend-item" style="border-left: 3px solid #FFFF00">
            <div class="dot" style="background:#FFFF00; box-shadow: 0 0 5px yellow;"></div>Stalingrad (The Spine)
        </div>
    </div>

    <script>
        // Check if Highcharts map data is loaded
        if (typeof Highcharts === 'undefined') {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('container').style.display = 'none';
        }

        // --- DYNAMIC MAP DATA LOADING ---
        // Sometimes the map key varies (custom/world, custom\world, etc.)
        // We find the first available map in the library.
        let mapKey = 'custom/world'; // Default
        let mapGeoJSON = null;

        if (Highcharts.maps) {
            const keys = Object.keys(Highcharts.maps);
            if (keys.length > 0) {
                mapKey = keys[0];
                mapGeoJSON = Highcharts.maps[mapKey];
                console.log("Loaded Map Key: " + mapKey);
            } else {
                console.error("Highcharts.maps is empty!");
                document.getElementById('loading').innerHTML += "<br>ERROR: No map data found in Highcharts.maps.";
                document.getElementById('loading').style.display = 'block';
            }
        } else {
            console.error("Highcharts.maps is undefined!");
            document.getElementById('loading').innerHTML += "<br>ERROR: Highcharts.maps object is missing.";
            document.getElementById('loading').style.display = 'block';
        }


        // --- STRATEGIC COLORS ---
        const C = {
            // RED SPHERE
            red_core: '#8B0000',      // Russia
            red_ally: '#CD5C5C',      // Belarus, Iran, NK
            red_tied: '#FF8C00',      // Kazakhstan, Hungary (Pipeline/Energy hostages)
            red_weak: '#F0E68C',      // Sahel, Georgia (Occupied)

            // BLUE SPHERE
            blue_core: '#00008B',     // USA, UK, Poland, Turkey
            blue_ally: '#87CEEB',     // Ukraine, Japan, Aus
            blue_surr: '#90EE90',     // Swiss, Austria

            // NEUTRALS
            neu_strong: '#4F4F4F',    // China, India, Mexico, Brazil
            neu_weak: '#2C2C2C'       // The Rest of the World
        };

        // --- DATASET ---
        // Switched to 'code' (ISO Alpha-2 Uppercase) for reliable joining with custom/world.js 'iso-a2' property.
        const countryData = [
            // RUSSIA BLOCK
            { code: 'RU', color: C.red_core, name: 'Russia', role: 'The Aggressor / Heartland' },
            { code: 'BY', color: C.red_ally, name: 'Belarus', role: 'Union State / Staging Ground' },
            { code: 'IR', color: C.red_ally, name: 'Iran', role: 'Drone Supplier / South Corridor' },
            { code: 'KP', color: C.red_ally, name: 'North Korea', role: 'Ammo Factory' },
            { code: 'SY', color: C.red_ally, name: 'Syria', role: 'Mediterranean Base' },
            { code: 'VE', color: C.red_ally, name: 'Venezuela', role: 'Ideological Ally (Oil Reserve)' },

            // RUSSIAN TIES (The "Orange" Zone)
            { code: 'KZ', color: C.red_tied, name: 'Kazakhstan', role: 'Pipeline Hostage (CPC)' },
            { code: 'UZ', color: C.red_tied, name: 'Uzbekistan', role: 'Economic Dependence' },
            { code: 'AM', color: C.red_tied, name: 'Armenia', role: 'Security Dependent' },
            { code: 'AZ', color: C.red_tied, name: 'Azerbaijan', role: 'Transport Corridor (Middle)' },
            { code: 'HU', color: C.red_tied, name: 'Hungary', role: 'NATO Member / Russian Gas Client' },
            { code: 'RS', color: C.red_tied, name: 'Serbia', role: 'Political Ally in Europe' },

            // NATO BLOCK
            { code: 'US', color: C.blue_core, name: 'USA', role: 'NATO Backbone' },
            { code: 'CA', color: C.blue_core, name: 'Canada', role: 'NATO Core' },
            { code: 'GB', color: C.blue_core, name: 'United Kingdom', role: 'Nuclear Power' },
            { code: 'FR', color: C.blue_core, name: 'France', role: 'EU Military Leader' },
            { code: 'DE', color: C.blue_core, name: 'Germany', role: 'Logistics Hub' },
            { code: 'PL', color: C.blue_core, name: 'Poland', role: 'The Shield (Heavy Armor)' },
            { code: 'TR', color: C.blue_core, name: 'Turkey', role: 'The Gatekeeper (Bosporus)' },
            { code: 'FI', color: C.blue_core, name: 'Finland', role: 'Northern Flank' },
            { code: 'SE', color: C.blue_core, name: 'Sweden', role: 'Baltic Control' },
            { code: 'NO', color: C.blue_core, name: 'Norway', role: 'Arctic/Energy' },
            { code: 'EE', color: C.blue_core, name: 'Estonia', role: 'Tripwire State' },
            { code: 'LV', color: C.blue_core, name: 'Latvia', role: 'Tripwire State' },
            { code: 'LT', color: C.blue_core, name: 'Lithuania', role: 'Suwalki Guardian' },
            { code: 'RO', color: C.blue_core, name: 'Romania', role: 'Black Sea Hub' },

            // BLUE ALIGNED
            { code: 'UA', color: C.blue_ally, name: 'Ukraine', role: 'THE TANK HIGHWAY (Frontline)' },
            { code: 'JP', color: C.blue_ally, name: 'Japan', role: 'Eastern Front Containment' },
            { code: 'KR', color: C.blue_ally, name: 'South Korea', role: 'Artillery Production' },
            { code: 'AU', color: C.blue_ally, name: 'Australia', role: 'Pacific Depth' },
            { code: 'IL', color: C.blue_ally, name: 'Israel', role: 'Tech/Intel Partner' },
            { code: 'TW', color: C.blue_ally, name: 'Taiwan', role: 'Chip Shield' },

            // NEUTRALS (STRONG)
            { code: 'CN', color: C.neu_strong, name: 'China', role: 'The Silent Superpower' },
            { code: 'IN', color: C.neu_strong, name: 'India', role: 'Strategic Autonomy' },
            { code: 'BR', color: C.neu_strong, name: 'Brazil', role: 'BRICS / Agri-Power' },
            { code: 'MX', color: C.neu_strong, name: 'Mexico', role: 'Economic Partner / Political Neutral' },
            { code: 'SA', color: C.neu_strong, name: 'Saudi Arabia', role: 'Oil Price Controller' },
            { code: 'ZA', color: C.neu_strong, name: 'South Africa', role: 'BRICS' }
        ];

        // VOLGOGRAD MARKER
        const strategicPoints = [{
            name: 'Stalingrad (Volgograd)',
            lat: 48.70, lon: 44.51,
            color: '#FFFF00',
            desc: 'The Dorsal Spine. Intersects North-South & East-West trade.'
        }];

        // INITIALIZE MAP
        Highcharts.mapChart('container', {
            chart: {
                map: mapGeoJSON || 'custom/world',
                backgroundColor: '#121212', // Match body bg
            },
            title: { text: '' },
            subtitle: {
                 text: 'Debug: Loaded Map Key = ' + mapKey,
                 align: 'right',
                 style: { color: '#444', fontSize: '10px' }
            },

            // Zoom/Pan controls
            mapNavigation: {
                enabled: true,
                buttonOptions: {
                    verticalAlign: 'bottom',
                    theme: {
                        fill: '#333',
                        'stroke-width': 1,
                        stroke: '#444',
                        style: { color: 'white' }
                    }
                }
            },

            // Tooltip Config
            tooltip: {
                backgroundColor: 'rgba(0, 0, 0, 0.9)',
                borderWidth: 1,
                borderColor: '#666',
                style: { color: '#fff', fontSize: '14px' },
                formatter: function () {
                    if (this.point.role) {
                        return '<span style="color:#aaa; font-size:10px">STRATEGIC ROLE</span><br>' +
                               '<b>' + this.point.name + '</b><br>' +
                               '<span style="color:' + this.point.color + '">' + this.point.role + '</span>';
                    }
                    if (this.point.desc) {
                        return '<b>' + this.point.name + '</b><br>' + this.point.desc;
                    }
                    return '<b>' + this.point.name + '</b><br>Weak Neutral / Non-Aligned';
                }
            },

            // Hides the "Highcharts.com" credit
            credits: { enabled: false },

            // Legend hidden (using custom HTML legend)
            legend: { enabled: false },

            series: [
                {
                    // The Map Layer
                    data: countryData,
                    name: 'Geopolitics',
                    joinBy: ['iso-a2', 'code'], // Safe Join
                    nullColor: '#2C2C2C', // Default color for unlisted countries
                    borderColor: '#444',
                    borderWidth: 0.5,
                    states: {
                        hover: {
                            color: '#FFFFFF', // White highlight on hover
                            borderColor: '#fff'
                        }
                    },
                    dataLabels: {
                        enabled: false,
                        format: '{point.name}'
                    }
                },
                {
                    // The City Marker Layer
                    type: 'mappoint',
                    name: 'Critical Points',
                    color: '#FFFF00',
                    data: strategicPoints,
                    marker: {
                        symbol: 'circle',
                        radius: 5,
                        lineColor: 'red',
                        lineWidth: 2
                    },
                    dataLabels: {
                        enabled: true,
                        format: '{point.name}',
                        style: {
                            color: '#FFFF00',
                            textOutline: '2px black',
                            fontWeight: 'normal',
                            fontSize: '11px'
                        },
                        y: -10
                    }
                }
            ]
        });
    </script>

    <div style="margin-top: 40px; padding: 20px; border-top: 1px solid #444; font-family: sans-serif; text-align: center; color: #777; font-size: 12px;">
        <h4 style="color: #999; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px;">Tech Stack & Data</h4>
        <p style="margin: 5px 0;"><strong>JS Library:</strong> <span style="color: #aaa;">Highcharts Maps</span> (SVG Rendering Engine)</p>
        <p style="margin: 5px 0;"><strong>Map Geometry:</strong> <span style="color: #aaa;">Highcharts Map Collection</span> (custom/world.js - Derived from Natural Earth)</p>
        <p style="margin: 5px 0;"><strong>Data Layer:</strong> <span style="color: #aaa;">Custom JSON</span> (Manual Geopolitical Classification)</p>
    </div>
</body>
</html>