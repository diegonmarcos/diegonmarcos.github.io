<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strategic Map 2025 (Fixed)</title>

    <!-- 1. LOAD LIBRARIES -->
    <script src="https://code.highcharts.com/maps/highmaps.js"></script>
    <script src="https://code.highcharts.com/maps/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/maps/modules/offline-exporting.js"></script>
    <script src="https://code.highcharts.com/maps/modules/accessibility.js"></script>
    <!-- 2. LOAD WORLD MAP DATA -->
    <script src="https://code.highcharts.com/mapdata/custom/world.js"></script>

    <style>
        body { margin: 0; padding: 20px; background: #1a1a1a; font-family: sans-serif; color: #fff; }
        #container { height: 600px; width: 100%; border: 1px solid #444; border-radius: 8px; margin-bottom: 20px; }
        .error-msg { color: #ff6b6b; display: none; text-align: center; padding: 20px; }
        .legend { display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; }
        .legend-item { display: flex; align-items: center; font-size: 12px; color: #ccc; }
        .dot { width: 10px; height: 10px; border-radius: 50%; margin-right: 8px; }
    </style>
</head>
<body>

    <h2 style="text-align:center; font-weight:300;">Strategic Balance: Late 2025</h2>

    <!-- Error message if scripts fail to load -->
    <div id="error-box" class="error-msg">
        ⚠️ <strong>Map cannot load.</strong><br>
        This usually happens in previews that block external scripts.<br>
        Please download this file and open it in Chrome/Edge/Safari.
    </div>

    <div id="container"></div>

    <!-- LEGEND -->
    <div class="legend">
        <!-- RUSSIA -->
        <div class="legend-item"><div class="dot" style="background:#8B0000"></div>Russia Core</div>
        <div class="legend-item"><div class="dot" style="background:#CD5C5C"></div>RU Ally (Iran/Belarus)</div>
        <div class="legend-item"><div class="dot" style="background:#FF8C00"></div>RU Econ Ties (Kazakhstan)</div>
        <div class="legend-item"><div class="dot" style="background:#F0E68C"></div>RU Weak/Controlled</div>
        <!-- NATO -->
        <div class="legend-item"><div class="dot" style="background:#00008B"></div>NATO Core</div>
        <div class="legend-item"><div class="dot" style="background:#87CEEB"></div>West Aligned (Ukraine/Japan)</div>
        <div class="legend-item"><div class="dot" style="background:#90EE90"></div>Surrounded</div>
        <!-- NEUTRAL -->
        <div class="legend-item"><div class="dot" style="background:#4F4F4F"></div>Strong Neutral</div>
        <div class="legend-item"><div class="dot" style="background:#ffff00; border:2px solid red;"></div>Stalingrad (Volgograd)</div>
    </div>

    <script>
        // Check if Highcharts loaded
        if (typeof Highcharts === 'undefined') {
            document.getElementById('error-box').style.display = 'block';
            document.getElementById('container').style.display = 'none';
        }

        // --- DYNAMIC MAP DATA LOADING ---
        let mapGeoJSON = null;
        let mapKeyStr = 'custom/world';

        if (Highcharts.maps) {
            const keys = Object.keys(Highcharts.maps);
            if (keys.length > 0) {
                mapKeyStr = keys[0];
                mapGeoJSON = Highcharts.maps[mapKeyStr];
                console.log("Map loaded via key: " + mapKeyStr);
            } else {
                console.error("Highcharts.maps is empty.");
                document.getElementById('error-box').innerHTML += "<br>ERROR: No map data found in Highcharts.maps.";
            }
        } else {
            console.error("Highcharts.maps is undefined!");
            document.getElementById('error-box').innerHTML += "<br>ERROR: Highcharts.maps object is missing.";
        }


        // --- COLORS ---
        const C = {
            ru: '#8B0000', ru_ally: '#CD5C5C', ru_tie: '#FF8C00', ru_weak: '#F0E68C',
            nato: '#00008B', nato_ally: '#87CEEB', nato_sur: '#90EE90',
            neu_str: '#4F4F4F'
        };

        // --- DATA (Using standard 'hc-key' lowercase keys) ---
        const data = [
            // RUSSIA SPHERE
            { 'hc-key': 'ru', color: C.ru, name: 'Russia', type: 'Aggressor Core' },
            { 'hc-key': 'by', color: C.ru_ally, name: 'Belarus', type: 'Union State' },
            { 'hc-key': 'ir', color: C.ru_ally, name: 'Iran', type: 'Key Military Ally' },
            { 'hc-key': 'kp', color: C.ru_ally, name: 'North Korea', type: 'Ammo Supplier' },
            { 'hc-key': 'sy', color: C.ru_ally, name: 'Syria', type: 'Base Host' },
            { 'hc-key': 've', color: C.ru_ally, name: 'Venezuela', type: 'Ideological Ally' },
            { 'hc-key': 'ni', color: C.ru_ally, name: 'Nicaragua', type: 'Pol. Support' },
            { 'hc-key': 'cu', color: C.ru_ally, name: 'Cuba', type: 'Intel Partner' },

            { 'hc-key': 'kz', color: C.ru_tie, name: 'Kazakhstan', type: 'Pipeline Dependent' },
            { 'hc-key': 'uz', color: C.ru_tie, name: 'Uzbekistan', type: 'Econ. Ties' },
            { 'hc-key': 'am', color: C.ru_tie, name: 'Armenia', type: 'Hist. Security' },
            { 'hc-key': 'az', color: C.ru_tie, name: 'Azerbaijan', type: 'Trade Route' },
            { 'hc-key': 'rs', color: C.ru_tie, name: 'Serbia', type: 'Pol. Ties' },
            { 'hc-key': 'hu', color: C.ru_tie, name: 'Hungary', type: 'Energy Client (NATO)' },

            { 'hc-key': 'kg', color: C.ru_weak, name: 'Kyrgyzstan', type: 'Dependent' },
            { 'hc-key': 'tj', color: C.ru_weak, name: 'Tajikistan', type: 'Mil. Base' },
            { 'hc-key': 'mn', color: C.ru_weak, name: 'Mongolia', type: 'Trapped' },
            { 'hc-key': 'ge', color: C.ru_weak, name: 'Georgia', type: '20% Occupied' },
            { 'hc-key': 'ml', color: C.ru_weak, name: 'Mali', type: 'Wagner Ops' },
            { 'hc-key': 'bf', color: C.ru_weak, name: 'Burkina Faso', type: 'Wagner Ops' },
            { 'hc-key': 'cf', color: C.ru_weak, name: 'CAR', type: 'Wagner Ops' },

            // NATO SPHERE
            { 'hc-key': 'us', color: C.nato, name: 'USA', type: 'NATO Core' },
            { 'hc-key': 'ca', color: C.nato, name: 'Canada', type: 'NATO Core' },
            { 'hc-key': 'gb', color: C.nato, name: 'UK', type: 'NATO Core' },
            { 'hc-key': 'fr', color: C.nato, name: 'France', type: 'NATO Core' },
            { 'hc-key': 'de', color: C.nato, name: 'Germany', type: 'NATO Core' },
            { 'hc-key': 'pl', color: C.nato, name: 'Poland', type: 'The Shield' },
            { 'hc-key': 'tr', color: C.nato, name: 'Turkey', type: 'The Gatekeeper' },
            { 'hc-key': 'no', color: C.nato, name: 'Norway', type: 'NATO Core' },
            { 'hc-key': 'se', color: C.nato, name: 'Sweden', type: 'Baltic Control' },
            { 'hc-key': 'fi', color: C.nato, name: 'Finland', type: 'Northern Flank' },
            { 'hc-key': 'it', color: C.nato, name: 'Italy', type: 'NATO Core' },
            { 'hc-key': 'es', color: C.nato, name: 'Spain', type: 'NATO Core' },
            { 'hc-key': 'ro', color: C.nato, name: 'Romania', type: 'Black Sea Hub' },
            { 'hc-key': 'ee', color: C.nato, name: 'Estonia', type: 'Tripwire' },
            { 'hc-key': 'lv', color: C.nato, name: 'Latvia', type: 'Tripwire' },
            { 'hc-key': 'lt', color: C.nato, name: 'Lithuania', type: 'Tripwire' },

            // WEST ALIGNED
            { 'hc-key': 'ua', color: C.nato_ally, name: 'Ukraine', type: 'THE FRONTLINE' },
            { 'hc-key': 'jp', color: C.nato_ally, name: 'Japan', type: 'MNNA' },
            { 'hc-key': 'kr', color: C.nato_ally, name: 'South Korea', type: 'MNNA' },
            { 'hc-key': 'au', color: C.nato_ally, name: 'Australia', type: 'AUKUS' },
            { 'hc-key': 'il', color: C.nato_ally, name: 'Israel', type: 'Strategic Ally' },
            { 'hc-key': 'tw', color: C.nato_ally, name: 'Taiwan', type: 'Partner' },

            // SURROUNDED
            { 'hc-key': 'at', color: C.nato_sur, name: 'Austria', type: 'Surrounded' },
            { 'hc-key': 'ch', color: C.nato_sur, name: 'Switzerland', type: 'Surrounded' },
            { 'hc-key': 'ie', color: C.nato_sur, name: 'Ireland', type: 'Surrounded' },

            // STRONG NEUTRALS
            { 'hc-key': 'cn', color: C.neu_str, name: 'China', type: 'Superpower Neutral' },
            { 'hc-key': 'in', color: C.neu_str, name: 'India', type: 'Strategic Autonomy' },
            { 'hc-key': 'br', color: C.neu_str, name: 'Brazil', type: 'BRICS' },
            { 'hc-key': 'za', color: C.neu_str, name: 'South Africa', type: 'BRICS' },
            { 'hc-key': 'sa', color: C.neu_str, name: 'Saudi Arabia', type: 'Energy Swing' },
            { 'hc-key': 'mx', color: C.neu_str, name: 'Mexico', type: 'Isolationist Neutral' }
        ];

        // Volgograd Marker
        const cities = [{
            name: 'Volgograd',
            lat: 48.70, lon: 44.51,
            color: '#FFFF00',
            desc: 'The Dorsal Spine (Stalingrad)'
        }];

        // RENDER MAP
        Highcharts.mapChart('container', {
            chart: { map: mapGeoJSON || 'custom/world', backgroundColor: '#2b2b2b' },
            title: { text: '' },
            subtitle: { text: 'Map Key: ' + mapKeyStr },
            mapNavigation: { enabled: true, buttonOptions: { verticalAlign: 'bottom' } },
            legend: { enabled: false },
            tooltip: {
                backgroundColor: 'rgba(0,0,0,0.9)',
                style: { color: '#fff' },
                pointFormat: '<b>{point.name}</b><br>{point.type}'
            },
            series: [
                {
                    name: 'Countries',
                    data: data,
                    joinBy: 'hc-key', // <--- CRITICAL FIX: Uses standard lowercase keys
                    nullColor: '#3a3a3a',
                    borderColor: '#555',
                    borderWidth: 0.5,
                    states: { hover: { color: '#fff' } }
                },
                {
                    type: 'mappoint',
                    name: 'Strategic',
                    data: cities,
                    color: 'yellow',
                    marker: { radius: 6, lineColor: 'red', lineWidth: 2 }
                }
            ]
        });
    </script>
    <div style="margin-top: 40px; padding: 20px; border-top: 1px solid #444; font-family: sans-serif; text-align: center; color: #777; font-size: 12px;">
        <h4 style="color: #999; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px;">Tech Stack & Data</h4>
        <p style="margin: 5px 0;"><strong>JS Library:</strong> <span style="color: #aaa;">Highcharts Maps</span> (SVG Rendering Engine)</p>
        <p style="margin: 5px 0;"><strong>Map Geometry:</strong> <span style="color: #aaa;">Highcharts Map Collection</span> (custom/world.js - Derived from Natural Earth)</p>
        <p style="margin: 5px 0;"><strong>Data Layer:</strong> <span style="color: #aaa;">Custom JSON</span> (Manual Geopolitical Classification)</p>
    </div>
</body>
</html>
