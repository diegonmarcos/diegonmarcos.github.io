(()=>{function H(){document.addEventListener("mousemove",t=>{let e=document.querySelectorAll(".doc-icon"),n=document.querySelectorAll(".glow-spot"),o=(t.clientX/window.innerWidth-.5)*30,i=(t.clientY/window.innerHeight-.5)*30;e.forEach((r,l)=>{let a=(l%4+1)*.4,y=o*.1*a;r.style.transform=`translate(${o*a}px, ${i*a}px) rotate(${y}deg)`}),n.forEach((r,l)=>{let a=(l+1)*.15;r.style.transform=`translate(${o*a}px, ${i*a}px) scale(${1+Math.abs(o*.002)})`})})}function c(){let t=document.querySelector(".service-table.active"),e=t?t.querySelector(".service-option.active"):null,n=document.querySelector(".auth-btn.active"),o=e&&e.dataset.name||"Service",i=e&&e.dataset.url||"#",r=e&&e.dataset.config||"#",l=n&&n.dataset.authPrefix||"",a=e?e.querySelector(".service-desc"):null,y=a&&a.textContent||"",b=document.getElementById("tool-name-app"),M=document.getElementById("go-app-btn"),x=document.getElementById("go-config-btn"),A=document.getElementById("info-app-name"),w=document.getElementById("info-app-desc");b&&(b.textContent=o),M&&(M.href=l?l+encodeURIComponent(i):i),x&&(x.href=l?l+encodeURIComponent(r):r),A&&(A.textContent=o),w&&(w.textContent=y)}var O=["theme-sheets","theme-docs","theme-slides","theme-photos","theme-files","theme-notes","theme-lgtm","theme-powersheets","theme-videos"];function I(t){document.body.classList.remove(...O),document.body.classList.add("theme-"+t)}function B(){let t=document.querySelectorAll(".category-tabs .category-tab, .category-tabs-row2 .category-tab"),e=document.querySelectorAll(".service-table");t.forEach(n=>{n.addEventListener("click",function(){let o=this.dataset.category;o&&(t.forEach(i=>i.classList.remove("active")),this.classList.add("active"),e.forEach(i=>{i.classList.remove("active"),i.dataset.category===o&&i.classList.add("active")}),I(o),c())})}),e.forEach(n=>{let o=n.querySelectorAll(".service-option:not(.coming-soon):not(.not-deployed)");o.forEach(i=>{i.addEventListener("click",function(){o.forEach(r=>r.classList.remove("active")),this.classList.add("active"),c()})})}),I("notes")}function P(){let t=document.querySelectorAll(".auth-btn");t.forEach(e=>{e.addEventListener("click",function(){t.forEach(n=>n.classList.remove("active")),this.classList.add("active"),c()})})}var E="https://api.diegonmarcos.com",N="oci-flex",h=null,S=null,k=null,R=null,$=null,m=null,f=null,T=null,s=null,d=null,v=null;async function C(){if(h)return h;try{console.debug("[vmControl] discovering VM via /rust/health/ids ...");let t=await fetch(`${E}/rust/health/ids`,{signal:AbortSignal.timeout(1e4)});if(!t.ok)return console.debug("[vmControl] discovery HTTP",t.status),null;let e=await t.json();console.debug("[vmControl] discovered VMs:",Object.keys(e.vms||{}));for(let[n,o]of Object.entries(e.vms||{}))if(o.label===N)return h=n,S=`${E}/rust/health/${n}`,k=`${E}/rust/vms/${n}/start`,R=`${E}/rust/vms/${n}/stop`,$=`${E}/rust/vms/${n}/reset`,console.debug("[vmControl] matched VM:",n),n;console.debug("[vmControl] no VM with label",N)}catch(t){console.debug("[vmControl] discovery failed:",t.message)}return null}function g(t,e){!d||!v||(d.className="status-dot",t==="RUNNING"?(d.classList.add("online"),v.textContent=e||"Server Online"):t==="STOPPED"||t==="STOPPING"?(d.classList.add("offline"),v.textContent=e||"Server Offline (Sleeping)"):t==="STARTING"?(d.classList.add("checking"),v.textContent=e||"Server Starting..."):(d.classList.add("checking"),v.textContent=e||"Checking..."))}function p(t){!m||!f||!T||(T.disabled=!1,t==="running"?(m.disabled=!0,f.disabled=!1):t==="stopped"?(m.disabled=!1,f.disabled=!0):(m.disabled=!0,f.disabled=!0))}async function u(){try{if(await C(),!S)throw new Error("VM not discovered");console.debug("[vmControl] checking status:",S);let t=performance.now(),e=await fetch(S,{method:"GET",signal:AbortSignal.timeout(3e4)});if(console.debug("[vmControl] status response:",e.status,`(${((performance.now()-t)/1e3).toFixed(1)}s)`),e.ok){let n=await e.json();console.debug("[vmControl] health data:",JSON.stringify(n));let o=n.provider_state;n.health==="online"||n.ping===!0?(g("RUNNING","Server Online"),p("running"),s&&(s.textContent="")):o==="STARTING"?(g("STARTING","Server Starting..."),p("loading"),s&&(s.textContent="VM is starting up...")):o==="RUNNING"?(g("STOPPED","Server Degraded (Not Responding)"),p("running"),s&&(s.textContent="Server is running but not responding. Try Reset.")):(g("STOPPED","Server Offline (Sleeping)"),p("stopped"),s&&(s.textContent="Drive server is sleeping."))}else throw new Error(`API HTTP ${e.status}`)}catch(t){console.debug("[vmControl] status check failed:",t.message),g("STOPPED","Status Unknown"),p("stopped"),s&&(s.textContent="Could not check server status.")}}async function L(t){if(h||await C(),h||(s&&(s.textContent="VM not discovered \u2014 retrying..."),await C()),!h){s&&(s.textContent="Could not discover VM. Check API connectivity.");return}let n={start:k,stop:R,reset:$}[t];if(n){console.debug("[vmControl] action:",t,"\u2192 POST",n),p("loading"),s&&(s.textContent=`Sending ${t} command...`);try{let o=performance.now(),i=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},signal:AbortSignal.timeout(3e4)});if(console.debug("[vmControl] action response:",i.status,`(${((performance.now()-o)/1e3).toFixed(1)}s)`),i.ok){let r=await i.json();console.debug("[vmControl] action result:",JSON.stringify(r));let l={start:"VM starting...",stop:"VM stopping...",reset:"VM resetting..."};s&&(s.textContent=l[t]),g(t==="stop"?"STOPPING":"STARTING"),setTimeout(()=>u(),1e4),setTimeout(()=>u(),3e4),setTimeout(()=>u(),6e4)}else{let r=await i.json().catch(()=>({}));console.debug("[vmControl] action failed:",i.status,r),s&&(s.textContent=r.message||`${t} failed`),await u()}}catch(o){console.debug("[vmControl] action error:",o.message),s&&(s.textContent="Could not reach API."),await u()}}}function V(){m=document.getElementById("vm-start-btn"),f=document.getElementById("vm-stop-btn"),T=document.getElementById("vm-reset-btn"),s=document.getElementById("wake-status"),d=document.getElementById("status-dot"),v=document.getElementById("status-text"),m&&m.addEventListener("click",()=>L("start")),f&&f.addEventListener("click",()=>L("stop")),T&&T.addEventListener("click",()=>L("reset")),u(),setInterval(u,3e4)}document.addEventListener("DOMContentLoaded",()=>{H(),B(),P(),V(),c()});})();
