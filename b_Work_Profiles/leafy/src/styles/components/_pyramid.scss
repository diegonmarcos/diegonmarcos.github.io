// =====================
// 3D PYRAMID - Mathematically Correct
// =====================

// Pyramid geometry calculations:
// Base side (a) = 200px
// Slope angle from horizontal (α) = 58° (steep, dramatic look)
// Pyramid height (h) = (a/2) * tan(α) = 100 * tan(58°) = 160px
// Slant height (s) = sqrt(h² + (a/2)²) = sqrt(160² + 100²) = 189px
// Face tilt from vertical = 90° - α = 32°

// Larger pyramid for better text fit
$base-size: 240px;
$slant-height: 227px; // Proportionally scaled
$face-tilt: 32deg;
$half-base: calc($base-size / 2);

.pyramid-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
    max-width: 600px;
    margin: 0 auto;
    padding: 10px 20px;
    perspective: 900px;
    user-select: none;
}

.pyramid-wrapper {
    position: relative;
    width: 320px;
    height: 300px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: center;
}

.pyramid-canvas {
    position: absolute;
    top: -40px;
    left: -60px;
    width: 400px;
    height: 400px;
    pointer-events: none;
    opacity: 0.5;
    z-index: 0;
}

.pyramid {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
    // Initial rotation for nice view angle (like cube)
    transform: rotateX(-20deg) rotateY(-35deg);
    transition: transform 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    cursor: grab;
    z-index: 1;

    &:active {
        cursor: grabbing;
    }

    &.dragging {
        transition: none;
    }
}

// Each triangular face
.pyramid-face {
    position: absolute;
    width: $base-size;
    height: $slant-height;
    // Center the face in the pyramid container
    left: 50%;
    top: 50%;
    margin-left: calc($base-size / -2);
    margin-top: calc($slant-height / -2);
    // Triangle pointing up - apex at top
    clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
    // Transform origin at the BASE of the triangle (bottom center)
    // This is where the face connects to the pyramid base
    transform-origin: 50% 100%;
    backface-visibility: visible;

    // Content positioning
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    align-items: center;
    padding-bottom: 30px;

    // Golden edge highlight at apex
    &::before {
        content: '';
        position: absolute;
        inset: 0;
        clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
        background: linear-gradient(180deg,
            rgba(201, 162, 39, 0.3) 0%,
            rgba(201, 162, 39, 0.05) 20%,
            transparent 40%);
        pointer-events: none;
    }

    .pyramid-content {
        text-align: center;
        color: var(--text-primary);
        padding: 0 20px;
        max-width: 180px;

        .face-number {
            font-family: 'Cormorant Garamond', serif;
            font-size: 20px;
            font-weight: 300;
            color: rgba(201, 162, 39, 0.25);
            display: block;
            margin-bottom: 4px;
        }

        h3 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 15px;
            font-weight: 500;
            color: var(--gold-light);
            margin-bottom: 6px;
            letter-spacing: 0.5px;
        }

        p {
            font-size: 10px;
            color: var(--text-secondary);
            line-height: 1.3;
        }
    }
}

// FRONT face - faces toward viewer (0° rotation)
.pyramid-front {
    background: linear-gradient(180deg,
        rgba(75, 60, 42, 0.95) 0%,
        rgba(50, 40, 28, 0.98) 100%);
    // 1. No Y rotation (faces front)
    // 2. Move forward to front edge of base
    // 3. Tilt backward to form pyramid slope
    transform:
        rotateY(0deg)
        translateZ($half-base)
        rotateX($face-tilt);
}

// RIGHT face - faces right (90° rotation)
.pyramid-right {
    background: linear-gradient(180deg,
        rgba(60, 48, 34, 0.95) 0%,
        rgba(40, 32, 22, 0.98) 100%);
    transform:
        rotateY(90deg)
        translateZ($half-base)
        rotateX($face-tilt);
}

// BACK face - faces away (180° rotation)
.pyramid-back {
    background: linear-gradient(180deg,
        rgba(50, 40, 28, 0.95) 0%,
        rgba(35, 28, 20, 0.98) 100%);
    transform:
        rotateY(180deg)
        translateZ($half-base)
        rotateX($face-tilt);
}

// LEFT face - faces left (-90° rotation)
.pyramid-left {
    background: linear-gradient(180deg,
        rgba(55, 44, 31, 0.95) 0%,
        rgba(38, 30, 21, 0.98) 100%);
    transform:
        rotateY(-90deg)
        translateZ($half-base)
        rotateX($face-tilt);
}

// Square BASE - horizontal at bottom
.pyramid-base {
    position: absolute;
    width: $base-size;
    height: $base-size;
    left: 50%;
    top: 50%;
    margin-left: calc($base-size / -2);
    margin-top: calc($base-size / -2);
    clip-path: none;
    background: linear-gradient(135deg,
        rgba(25, 20, 14, 0.98),
        rgba(35, 28, 20, 0.98));
    border: 1px solid rgba(201, 162, 39, 0.2);
    transform-origin: center center;
    // Move down to bottom of pyramid and lay flat
    // The faces' bottom edges are at Y = slant-height/2 from center
    // Base should be at that same level, rotated to be horizontal
    transform: translateY(calc($slant-height / 2)) rotateX(-90deg);

    .pyramid-content {
        display: none;
    }

    &::before {
        display: none;
    }
}

// Active face highlight
.pyramid-face.active {
    background: linear-gradient(180deg,
        rgba(85, 68, 48, 0.98) 0%,
        rgba(55, 44, 31, 0.98) 100%);

    &::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 15%;
        right: 15%;
        height: 2px;
        background: linear-gradient(90deg,
            transparent,
            var(--gold),
            transparent);
    }

    .pyramid-content h3 {
        color: var(--gold);
        text-shadow: 0 0 15px rgba(201, 162, 39, 0.4);
    }
}

// Navigation buttons
.pyramid-nav {
    display: flex;
    gap: 8px;
    margin-top: 15px;
    flex-wrap: wrap;
    justify-content: center;
}

.pyramid-nav-btn {
    background: transparent;
    border: 1px solid rgba(201, 162, 39, 0.3);
    color: var(--text-secondary);
    padding: 8px 16px;
    font-family: 'Outfit', sans-serif;
    font-size: 11px;
    font-weight: 500;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.3s ease;
    border-radius: 3px;

    &:hover {
        border-color: var(--gold);
        color: var(--gold);
    }

    &.active {
        background: var(--gold);
        border-color: var(--gold);
        color: var(--wood-darkest);
    }
}

.pyramid-hint {
    margin-top: 15px;
    font-size: 11px;
    color: var(--text-secondary);
    letter-spacing: 1.5px;
    text-transform: uppercase;
    opacity: 0.5;
}

// =====================
// MOBILE RESPONSIVE
// =====================
@media (max-width: 768px) {
    // Mobile pyramid - larger than before for better text fit
    $m-base: 180px;
    $m-slant: 170px;
    $m-half: calc($m-base / 2);

    .pyramid-container {
        perspective: 700px;
        padding: 10px;
    }

    .pyramid-wrapper {
        width: 260px;
        height: 280px;
        margin: 15px auto;
    }

    .pyramid-canvas {
        width: 320px;
        height: 320px;
        top: -20px;
        left: -30px;
    }

    .pyramid-face {
        width: $m-base;
        height: $m-slant;
        margin-left: calc($m-base / -2);
        margin-top: calc($m-slant / -2);
        padding-bottom: 25px;

        .pyramid-content {
            padding: 0 12px;
            max-width: 140px;

            .face-number {
                font-size: 16px;
                margin-bottom: 3px;
            }

            h3 {
                font-size: 13px;
                margin-bottom: 4px;
            }

            p {
                font-size: 9px;
                line-height: 1.25;
            }
        }
    }

    .pyramid-front {
        transform: rotateY(0deg) translateZ($m-half) rotateX($face-tilt);
    }
    .pyramid-right {
        transform: rotateY(90deg) translateZ($m-half) rotateX($face-tilt);
    }
    .pyramid-back {
        transform: rotateY(180deg) translateZ($m-half) rotateX($face-tilt);
    }
    .pyramid-left {
        transform: rotateY(-90deg) translateZ($m-half) rotateX($face-tilt);
    }

    .pyramid-base {
        width: $m-base;
        height: $m-base;
        margin-left: calc($m-base / -2);
        margin-top: calc($m-base / -2);
        transform: translateY(calc($m-slant / 2)) rotateX(-90deg);
    }

    .pyramid-nav {
        gap: 5px;
        margin-top: 10px;
    }

    .pyramid-nav-btn {
        padding: 5px 10px;
        font-size: 9px;
        letter-spacing: 1px;
    }

    .pyramid-hint {
        margin-top: 10px;
        font-size: 9px;
    }
}
