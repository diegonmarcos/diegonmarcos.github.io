(()=>{function w(){document.addEventListener("mousemove",t=>{let e=document.querySelectorAll(".doc-icon"),n=document.querySelectorAll(".glow-spot"),o=(t.clientX/window.innerWidth-.5)*30,s=(t.clientY/window.innerHeight-.5)*30;e.forEach((i,l)=>{let c=(l%4+1)*.4,p=o*.1*c;i.style.transform=`translate(${o*c}px, ${s*c}px) rotate(${p}deg)`}),n.forEach((i,l)=>{let c=(l+1)*.15;i.style.transform=`translate(${o*c}px, ${s*c}px) scale(${1+Math.abs(o*.002)})`})})}function a(){let t=document.querySelector(".service-table.active"),e=t?t.querySelector(".service-option.active"):null,n=document.querySelector(".auth-btn.active"),o=e&&e.dataset.name||"Service",s=e&&e.dataset.url||"#",i=e&&e.dataset.config||"#",l=n&&n.dataset.authPrefix||"",c=e?e.querySelector(".service-desc"):null,p=c&&c.textContent||"",C=document.getElementById("tool-name-app"),b=document.getElementById("go-app-btn"),M=document.getElementById("go-config-btn"),x=document.getElementById("info-app-name"),A=document.getElementById("info-app-desc");C&&(C.textContent=o),b&&(b.href=l?l+encodeURIComponent(s):s),M&&(M.href=l?l+encodeURIComponent(i):i),x&&(x.textContent=o),A&&(A.textContent=p)}var V=["theme-sheets","theme-docs","theme-slides","theme-photos","theme-files","theme-notes","theme-lgtm","theme-powersheets","theme-videos"];function H(t){document.body.classList.remove(...V),document.body.classList.add("theme-"+t)}function B(){let t=document.querySelectorAll(".category-tabs .category-tab, .category-tabs-row2 .category-tab"),e=document.querySelectorAll(".service-table");t.forEach(n=>{n.addEventListener("click",function(){let o=this.dataset.category;o&&(t.forEach(s=>s.classList.remove("active")),this.classList.add("active"),e.forEach(s=>{s.classList.remove("active"),s.dataset.category===o&&s.classList.add("active")}),H(o),a())})}),e.forEach(n=>{let o=n.querySelectorAll(".service-option:not(.coming-soon):not(.not-deployed)");o.forEach(s=>{s.addEventListener("click",function(){o.forEach(i=>i.classList.remove("active")),this.classList.add("active"),a()})})}),H("notes")}function I(){let t=document.querySelectorAll(".auth-btn");t.forEach(e=>{e.addEventListener("click",function(){t.forEach(n=>n.classList.remove("active")),this.classList.add("active"),a()})})}var v="https://api.diegonmarcos.com",P="oci-flex",f=null,h=null,k=null,$=null,N=null,E=null,T=null,y=null,r=null,u=null,d=null;async function S(){if(f)return f;try{console.debug("[vmControl] discovering VM via /rust/health/ids ...");let t=await fetch(`${v}/rust/health/ids`,{signal:AbortSignal.timeout(1e4)});if(!t.ok)return console.debug("[vmControl] discovery HTTP",t.status),null;let e=await t.json();console.debug("[vmControl] discovered VMs:",Object.keys(e.vms||{}));for(let[n,o]of Object.entries(e.vms||{}))if(o.label===P)return f=n,h=`${v}/rust/health/up/${n}`,k=`${v}/rust/vms/${n}/start`,$=`${v}/rust/vms/${n}/stop`,N=`${v}/rust/vms/${n}/reset`,console.debug("[vmControl] matched VM:",n),n;console.debug("[vmControl] no VM with label",P)}catch(t){console.debug("[vmControl] discovery failed:",t.message)}return null}function g(t,e){!u||!d||(u.className="status-dot",t==="RUNNING"?(u.classList.add("online"),d.textContent=e||"Server Online"):t==="STOPPED"||t==="STOPPING"?(u.classList.add("offline"),d.textContent=e||"Server Offline (Sleeping)"):t==="STARTING"?(u.classList.add("checking"),d.textContent=e||"Server Starting..."):(u.classList.add("checking"),d.textContent=e||"Checking..."))}async function m(){try{if(await S(),!h)throw new Error("VM not discovered");console.debug("[vmControl] checking status:",h);let t=performance.now(),e=await fetch(h,{method:"GET",signal:AbortSignal.timeout(1e4)});if(console.debug("[vmControl] status response:",e.status,`(${((performance.now()-t)/1e3).toFixed(1)}s)`),e.ok){let n=await e.json();console.debug("[vmControl] health data:",JSON.stringify(n)),n.health==="online"?(g("RUNNING","Server Online"),r&&(r.textContent="")):(g("STOPPED","Server Offline"),r&&(r.textContent="Server is offline."))}else throw new Error(`API HTTP ${e.status}`)}catch(t){console.debug("[vmControl] status check failed:",t.message),g("STOPPED","Status Unknown"),r&&(r.textContent="Could not check server status.")}}async function L(t){if(f||await S(),f||await S(),!f){r&&(r.textContent="Could not discover VM. Check API connectivity.");return}let n={start:k,stop:$,reset:N}[t];if(n){console.debug("[vmControl] action:",t,"\u2192 POST",n),r&&(r.textContent=`Sending ${t} command...`),g("STARTING",`Sending ${t}...`);try{let o=performance.now(),s=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},signal:AbortSignal.timeout(3e4)});if(console.debug("[vmControl] action response:",s.status,`(${((performance.now()-o)/1e3).toFixed(1)}s)`),s.ok){let i=await s.json();console.debug("[vmControl] action result:",JSON.stringify(i));let l={start:"VM starting...",stop:"VM stopping...",reset:"VM resetting..."};r&&(r.textContent=l[t]),g(t==="stop"?"STOPPING":"STARTING"),setTimeout(()=>m(),1e4),setTimeout(()=>m(),3e4),setTimeout(()=>m(),6e4)}else{let i=await s.json().catch(()=>({}));console.debug("[vmControl] action failed:",s.status,i),r&&(r.textContent=i.message||`${t} failed`),await m()}}catch(o){console.debug("[vmControl] action error:",o.message),r&&(r.textContent="Could not reach API."),await m()}}}function O(){E=document.getElementById("vm-start-btn"),T=document.getElementById("vm-stop-btn"),y=document.getElementById("vm-reset-btn"),r=document.getElementById("wake-status"),u=document.getElementById("status-dot"),d=document.getElementById("status-text"),E&&E.addEventListener("click",()=>L("start")),T&&T.addEventListener("click",()=>L("stop")),y&&y.addEventListener("click",()=>L("reset")),m(),setInterval(m,3e4)}document.addEventListener("DOMContentLoaded",()=>{w(),B(),I(),O(),a()});})();
