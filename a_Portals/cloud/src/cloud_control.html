<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cloud Control | Cloud Portal</title>

    <!-- Matomo Tag Manager -->
    <script>
      var _mtm = window._mtm = window._mtm || [];
      _mtm.push({'mtm.startTime': (new Date().getTime()), 'event': 'mtm.Start'});
      (function() {
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.async=true; g.src='https://analytics.diegonmarcos.com/js/container_odwLIyPV.js'; s.parentNode.insertBefore(g,s);
      })();
    </script>
    <!-- End Matomo Tag Manager -->

    <link rel="stylesheet" href="styles.css">
    <script>
        // Apply saved theme immediately
        (function() {
            var theme = localStorage.getItem('cloud-dashboard-theme') || 'blurred';
            document.documentElement.setAttribute('data-theme', theme);
        })();
    </script>
</head>
<body>
    <button class="theme-toggle" id="theme-toggle" title="Switch theme">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5"/>
            <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
        </svg>
        <span class="theme-label">Blurred</span>
    </button>

    <div class="container">
        <header class="main-header">
            <h1>Cloud Portal</h1>
            <!-- Cloud Infrastructure Banner -->
            <div class="header-banner">
                <svg viewBox="0 0 800 120" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="bgGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:rgba(56,189,248,0.1)"/>
                            <stop offset="50%" style="stop-color:rgba(139,92,246,0.15)"/>
                            <stop offset="100%" style="stop-color:rgba(56,189,248,0.1)"/>
                        </linearGradient>
                        <linearGradient id="lineGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:rgba(56,189,248,0.3)"/>
                            <stop offset="50%" style="stop-color:rgba(139,92,246,0.5)"/>
                            <stop offset="100%" style="stop-color:rgba(56,189,248,0.3)"/>
                        </linearGradient>
                    </defs>
                    <path d="M50 60 L150 40 L250 70 L350 35 L450 60 L550 30 L650 55 L750 45" stroke="url(#lineGrad)" stroke-width="1.5" fill="none" opacity="0.6"/>
                    <path d="M50 80 L150 90 L250 75 L350 95 L450 80 L550 100 L650 85 L750 90" stroke="url(#lineGrad)" stroke-width="1.5" fill="none" opacity="0.4"/>
                    <circle cx="150" cy="40" r="8" fill="rgba(56,189,248,0.8)" opacity="0.9"/>
                    <circle cx="350" cy="35" r="10" fill="rgba(139,92,246,0.8)" opacity="0.9"/>
                    <circle cx="550" cy="30" r="7" fill="rgba(56,189,248,0.8)" opacity="0.9"/>
                    <circle cx="250" cy="70" r="6" fill="rgba(56,189,248,0.6)" opacity="0.8"/>
                    <circle cx="450" cy="60" r="9" fill="rgba(139,92,246,0.7)" opacity="0.85"/>
                    <circle cx="650" cy="55" r="7" fill="rgba(56,189,248,0.7)" opacity="0.85"/>
                    <rect x="140" y="75" width="20" height="30" rx="2" fill="rgba(56,189,248,0.3)" stroke="rgba(56,189,248,0.6)" stroke-width="1"/>
                    <line x1="143" y1="82" x2="157" y2="82" stroke="rgba(56,189,248,0.8)" stroke-width="1"/>
                    <line x1="143" y1="88" x2="157" y2="88" stroke="rgba(56,189,248,0.6)" stroke-width="1"/>
                    <rect x="340" y="70" width="20" height="30" rx="2" fill="rgba(139,92,246,0.3)" stroke="rgba(139,92,246,0.6)" stroke-width="1"/>
                    <line x1="343" y1="77" x2="357" y2="77" stroke="rgba(139,92,246,0.8)" stroke-width="1"/>
                    <line x1="343" y1="83" x2="357" y2="83" stroke="rgba(139,92,246,0.6)" stroke-width="1"/>
                    <rect x="540" y="65" width="20" height="30" rx="2" fill="rgba(56,189,248,0.3)" stroke="rgba(56,189,248,0.6)" stroke-width="1"/>
                    <line x1="543" y1="72" x2="557" y2="72" stroke="rgba(56,189,248,0.8)" stroke-width="1"/>
                    <line x1="543" y1="78" x2="557" y2="78" stroke="rgba(56,189,248,0.6)" stroke-width="1"/>
                    <circle cx="350" cy="35" r="15" fill="none" stroke="rgba(139,92,246,0.4)" stroke-width="1" opacity="0.5"/>
                    <circle cx="450" cy="60" r="14" fill="none" stroke="rgba(139,92,246,0.3)" stroke-width="1" opacity="0.4"/>
                </svg>
            </div>
            <!-- Level 1: Main Navigation Links -->
            <div class="nav-level1">
                <a href="products.html" class="nav-main-btn">User</a>
                <a href="cloud_control.html" class="nav-main-btn active">Cloud Control</a>
                <a href="architecture.html" class="nav-main-btn">Architecture</a>
            </div>
            <!-- Level 2: Dashboard Tabs -->
            <div class="nav-level2 active" id="nav-cloudcontrol">
                <button class="view-btn" data-dash-parent="topology">Topology</button>
                <span class="nav-divider"></span>
                <button class="view-btn active" data-dash-parent="health">Health</button>
                <button class="view-btn" data-dash-parent="security">Security</button>
                <button class="view-btn" data-dash-parent="ops">Ops</button>
                <span class="nav-divider"></span>
                <button class="view-btn" data-dash-tab="apps">Apps</button>
            </div>
            <!-- Level 3: Sub-navigation for Topology -->
            <div class="nav-level3-wrapper nav-hidden" id="nav-topology">
                <h2 class="nav-level3-title">Topology</h2>
                <div class="nav-level3">
                    <button class="view-btn active" data-topology-cat="resource">Resource</button>
                    <button class="view-btn" data-topology-cat="security">Security</button>
                </div>
            </div>
            <!-- Level 4: Sub-navigation for Resource (under Topology) -->
            <div class="nav-level4-wrapper nav-hidden" id="nav-resource">
                <div class="nav-level4">
                    <button class="view-btn active" data-resource-view="graphs">Graphs</button>
                    <button class="view-btn" data-resource-view="tables">Tables</button>
                </div>
            </div>
            <!-- Level 5: Sub-navigation for Tables (under Resource) -->
            <div class="nav-level5-wrapper nav-hidden" id="nav-resource-tables">
                <div class="nav-level5">
                    <button class="view-btn active" data-table-view="app">App</button>
                    <button class="view-btn" data-table-view="data">Data</button>
                    <button class="view-btn" data-table-view="containers">Containers</button>
                </div>
            </div>
            <!-- Level 4: Sub-navigation for Security (under Topology) -->
            <div class="nav-level4-wrapper nav-hidden" id="nav-security-topo">
                <div class="nav-level4">
                    <button class="view-btn active" data-security-view="graphs">Graphs</button>
                    <button class="view-btn" data-security-view="table">Table</button>
                </div>
            </div>
            <!-- Level 3: Sub-navigation for Health -->
            <div class="nav-level3-wrapper nav-visible" id="nav-health">
                <h2 class="nav-level3-title">Health</h2>
                <div class="nav-level3">
                    <button class="view-btn active" data-dash-tab="resources">Metrics</button>
                    <button class="view-btn" data-dash-tab="profiling">Profiling</button>
                </div>
            </div>
            <!-- Level 3: Sub-navigation for Security -->
            <div class="nav-level3-wrapper nav-hidden" id="nav-security">
                <h2 class="nav-level3-title">Security</h2>
                <div class="nav-level3">
                    <button class="view-btn active" data-dash-tab="security">Security</button>
                    <button class="view-btn" data-dash-tab="audit-analytics">Analytics</button>
                    <button class="view-btn" data-dash-tab="audit-logs">Logs</button>
                </div>
            </div>
            <!-- Level 3: Sub-navigation for Ops -->
            <div class="nav-level3-wrapper nav-hidden" id="nav-ops">
                <h2 class="nav-level3-title">Ops</h2>
                <div class="nav-level3">
                    <button class="view-btn active" data-dash-tab="cost">Cost</button>
                    <button class="view-btn" data-dash-tab="capacity">Capacity</button>
                </div>
            </div>
            <!-- Level 4: Cost sub-tabs (under Ops) -->
            <div class="nav-level4-wrapper nav-hidden" id="nav-cost-subtabs">
                <div class="nav-level4">
                    <button class="view-btn active" data-subtab="cost-infra">Infrastructure</button>
                    <button class="view-btn" data-subtab="cost-ai">AI Costs</button>
                </div>
            </div>
            <!-- Level 3: Apps title -->
            <div class="nav-level3-wrapper nav-hidden" id="nav-apps">
                <h2 class="nav-level3-title">Apps</h2>
                <p class="nav-level3-subtitle">Cloud Management Applications</p>
            </div>
        </header>

        <!-- Status Tab Content (hidden) -->
        <div id="status-tab" class="tab-content">

        <!-- VMs Section -->
        <div class="resources-category">
            <h3 class="resources-category-title">VMs</h3>
            <div class="resources-section">
                <div class="resources-table-container">
                    <table class="resources-table status-table">
                        <thead><tr><th>Mode</th><th>Host</th><th>VM</th><th>IP</th><th>Status</th><th>Actions</th></tr></thead>
                        <tbody id="vms-tbody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Services Section -->
        <div class="resources-category">
            <h3 class="resources-category-title">Services</h3>
            <div class="resources-section">
                <div class="resources-table-container">
                    <table class="resources-table status-table services-hierarchical">
                        <thead><tr><th>VM</th><th>Name</th><th>URL</th><th>IP:PORT</th><th>Proxy Name</th><th>STATUS</th></tr></thead>
                        <tbody id="services-tbody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Backlog Section -->
        <div class="resources-category">
            <h3 class="resources-category-title">Backlog (DEV/HOLD)</h3>
            <div class="resources-section">
                <div class="resources-table-container">
                    <table class="resources-table status-table">
                        <thead><tr><th>Service</th><th>Status</th><th>VM</th><th>Notes</th></tr></thead>
                        <tbody id="backlog-tbody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        </div><!-- End Status Tab -->

        <!-- Resources Tab Content (htop-style) -->
        <div id="resources-tab" class="tab-content active">
            <!-- VM Summary -->
            <div class="resources-category">
                <h3 class="resources-category-title">VM Overview</h3>
                <div class="resources-section">
                    <div class="resources-table-container">
                        <table class="resources-table fs-md">
                            <thead>
                                <tr>
                                    <th class="col-w-18">VM</th>
                                    <th class="col-w-12">CPU</th>
                                    <th class="col-w-14">RAM</th>
                                    <th class="col-w-14">Storage</th>
                                    <th class="col-w-10">VRAM</th>
                                    <th class="col-w-12">Status</th>
                                    <th class="col-w-20">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="vm-row">
                                    <td><span class="provider-dot provider-dot--oracle"></span>OCI Paid Flex 1</td>
                                    <td>2 vCPU</td>
                                    <td>3.6 / 8 GB</td>
                                    <td>165 / 242 GB</td>
                                    <td>-</td>
                                    <td><span class="health-badge healthy">Active</span></td>
                                    <td>
                                        <div class="vm-actions-inline">
                                            <button class="vm-action-btn btn-url" onclick="window.open('https://cloud.oracle.com/compute/instances', '_blank')" title="Open cloud console">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
                                            </button>
                                            <button class="vm-action-btn btn-ssh" onclick="copyToClipboard('ssh -i ~/.ssh/id_rsa ubuntu@84.235.234.87', 'SSH copied!')" title="Copy SSH command">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                                            </button>
                                            <button class="vm-action-btn btn-reset" onclick="resetVM('oci-p-flex_1')" title="Reboot/Start VM">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
                                            </button>
                                            <button class="vm-action-btn btn-shutdown" onclick="shutdownVM('oci-p-flex_1')" title="Shutdown VM">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18.36 6.64a9 9 0 1 1-12.73 0"/><line x1="12" y1="2" x2="12" y2="12"/></svg>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="vm-row">
                                    <td><span class="provider-dot provider-dot--oracle"></span>OCI Free Micro 1</td>
                                    <td>1 OCPU</td>
                                    <td>0.6 / 1 GB</td>
                                    <td>13 / 47 GB</td>
                                    <td>-</td>
                                    <td><span class="health-badge healthy">Active</span></td>
                                    <td>
                                        <div class="vm-actions-inline">
                                            <button class="vm-action-btn btn-url" onclick="window.open('https://cloud.oracle.com/compute/instances', '_blank')" title="Open cloud console">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
                                            </button>
                                            <button class="vm-action-btn btn-ssh" onclick="copyToClipboard('ssh -i ~/.ssh/id_rsa ubuntu@130.110.251.193', 'SSH copied!')" title="Copy SSH command">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                                            </button>
                                            <button class="vm-action-btn btn-reset" onclick="resetVM('oci-f-micro_1')" title="Reboot/Start VM">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
                                            </button>
                                            <button class="vm-action-btn btn-shutdown" onclick="shutdownVM('oci-f-micro_1')" title="Shutdown VM">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18.36 6.64a9 9 0 1 1-12.73 0"/><line x1="12" y1="2" x2="12" y2="12"/></svg>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="vm-row">
                                    <td><span class="provider-dot provider-dot--oracle"></span>OCI Free Micro 2</td>
                                    <td>1 OCPU</td>
                                    <td>0.55 / 1 GB</td>
                                    <td>9 / 47 GB</td>
                                    <td>-</td>
                                    <td><span class="health-badge healthy">Active</span></td>
                                    <td>
                                        <div class="vm-actions-inline">
                                            <button class="vm-action-btn btn-url" onclick="window.open('https://cloud.oracle.com/compute/instances', '_blank')" title="Open cloud console">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
                                            </button>
                                            <button class="vm-action-btn btn-ssh" onclick="copyToClipboard('ssh -i ~/.ssh/id_rsa ubuntu@129.151.228.66', 'SSH copied!')" title="Copy SSH command">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                                            </button>
                                            <button class="vm-action-btn btn-reset" onclick="resetVM('oci-f-micro_2')" title="Reboot/Start VM">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
                                            </button>
                                            <button class="vm-action-btn btn-shutdown" onclick="shutdownVM('oci-f-micro_2')" title="Shutdown VM">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18.36 6.64a9 9 0 1 1-12.73 0"/><line x1="12" y1="2" x2="12" y2="12"/></svg>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="vm-row">
                                    <td><span class="provider-dot provider-dot--gcp"></span>GCP Free Micro 1</td>
                                    <td>0.25 vCPU</td>
                                    <td>0.7 / 1 GB</td>
                                    <td>6 / 30 GB</td>
                                    <td>-</td>
                                    <td><span class="health-badge healthy">Active</span></td>
                                    <td>
                                        <div class="vm-actions-inline">
                                            <button class="vm-action-btn btn-url" onclick="window.open('https://console.cloud.google.com/compute/instances', '_blank')" title="Open cloud console">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
                                            </button>
                                            <button class="vm-action-btn btn-ssh" onclick="copyToClipboard('gcloud compute ssh arch-1 --zone=us-central1-a', 'SSH copied!')" title="Copy SSH command">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                                            </button>
                                            <button class="vm-action-btn btn-reset" onclick="resetVM('gcp-f-micro_1')" title="Reboot/Start VM">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
                                            </button>
                                            <button class="vm-action-btn btn-shutdown" onclick="shutdownVM('gcp-f-micro_1')" title="Shutdown VM">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18.36 6.64a9 9 0 1 1-12.73 0"/><line x1="12" y1="2" x2="12" y2="12"/></svg>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Resource Usage by VM (Detailed) -->
            <div class="resources-category">
                <h3 class="resources-category-title">Service Breakdown by VM</h3>

                <!-- OCI Paid Flex 1 -->
                <div class="resources-section mb-lg">
                    <h4 class="section-h4">
                        <span class="vm-header-dot vm-header-dot--oracle"></span>
                        OCI Paid Flex 1
                        <span class="vm-specs-text">(1 OCPU, 8 GB RAM, 242 GB)</span>
                    </h4>
                    <div class="resources-table-container">
                        <table class="resources-table fs-md">
                            <thead>
                                <tr>
                                    <th class="col-w-28">Name</th>
                                    <th class="col-w-14">CPU</th>
                                    <th class="col-w-14">RAM</th>
                                    <th class="col-w-14">Storage</th>
                                    <th class="col-w-14">VRAM</th>
                                    <th class="col-w-16">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="totals-row">
                                    <td>Absolute</td>
                                    <td>2 vCPU</td>
                                    <td>3.6 / 8 GB</td>
                                    <td>165 / 242 GB</td>
                                    <td>-</td>
                                    <td>-</td>
                                </tr>
                                <tr class="vm-row vm-row--highlight">
                                    <td>VM Total</td>
                                    <td><span class="usage-bar"><span class="usage-fill usage-fill--blue" style="width: 15%;"></span></span> <span class="usage-val">15%</span></td>
                                    <td><span class="usage-bar"><span class="usage-fill usage-fill--green" style="width: 45%;"></span></span> <span class="usage-val">45%</span></td>
                                    <td><span class="usage-bar"><span class="usage-fill usage-fill--orange" style="width: 68%;"></span></span> <span class="usage-val">68%</span></td>
                                    <td>-</td>
                                    <td>-</td>
                                </tr>
                                <tr class="service-row"><td class="component-name">↳ photoprism</td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--blue" style="width: 5%;"></span></span> <span class="usage-val">5%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--green" style="width: 15%;"></span></span> <span class="usage-val">15%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--orange" style="width: 21%;"></span></span> <span class="usage-val">21%</span></td><td>-</td><td><button class="vm-action-btn btn-reset" onclick="restartContainer('oci-p-flex_1', 'photoprism')" title="Restart container"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg></button></td></tr>
                                <tr class="service-row"><td class="component-name">↳ radicale</td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--blue" style="width: 0%;"></span></span> <span class="usage-val">&lt;1%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--green" style="width: 1%;"></span></span> <span class="usage-val">1%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--orange" style="width: 0%;"></span></span> <span class="usage-val">&lt;1%</span></td><td>-</td><td><button class="vm-action-btn btn-reset" onclick="restartContainer('oci-p-flex_1', 'radicale')" title="Restart container"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg></button></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- OCI Free Micro 1 -->
                <div class="resources-section mb-lg">
                    <h4 class="section-h4">
                        <span class="vm-header-dot vm-header-dot--oracle"></span>
                        OCI Free Micro 1
                        <span class="vm-specs-text">(1 OCPU, 1 GB RAM, 47 GB)</span>
                    </h4>
                    <div class="resources-table-container">
                        <table class="resources-table fs-md">
                            <thead>
                                <tr>
                                    <th class="col-w-28">Name</th>
                                    <th class="col-w-14">CPU</th>
                                    <th class="col-w-14">RAM</th>
                                    <th class="col-w-14">Storage</th>
                                    <th class="col-w-14">VRAM</th>
                                    <th class="col-w-16">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="totals-row">
                                    <td>Absolute</td>
                                    <td>1 OCPU</td>
                                    <td>0.6 / 1 GB</td>
                                    <td>13 / 47 GB</td>
                                    <td>-</td>
                                    <td>-</td>
                                </tr>
                                <tr class="vm-row vm-row--highlight">
                                    <td>VM Total</td>
                                    <td><span class="usage-bar"><span class="usage-fill usage-fill--blue" style="width: 5%;"></span></span> <span class="usage-val">5%</span></td>
                                    <td><span class="usage-bar"><span class="usage-fill usage-fill--orange" style="width: 60%;"></span></span> <span class="usage-val">60%</span></td>
                                    <td><span class="usage-bar"><span class="usage-fill usage-fill--green" style="width: 27%;"></span></span> <span class="usage-val">27%</span></td>
                                    <td>-</td>
                                    <td>-</td>
                                </tr>
                                <tr class="service-row"><td class="component-name">↳ mailu-imap</td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--blue" style="width: 2%;"></span></span> <span class="usage-val">2%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--orange" style="width: 20%;"></span></span> <span class="usage-val">20%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--green" style="width: 15%;"></span></span> <span class="usage-val">15%</span></td><td>-</td><td><button class="vm-action-btn btn-reset" onclick="restartContainer('oci-f-micro_1', 'mailu-imap')" title="Restart container"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg></button></td></tr>
                                <tr class="service-row"><td class="component-name">↳ mailu-admin</td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--blue" style="width: 1%;"></span></span> <span class="usage-val">1%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--orange" style="width: 12%;"></span></span> <span class="usage-val">12%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--green" style="width: 1%;"></span></span> <span class="usage-val">1%</span></td><td>-</td><td><button class="vm-action-btn btn-reset" onclick="restartContainer('oci-f-micro_1', 'mailu-admin')" title="Restart container"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg></button></td></tr>
                                <tr class="service-row"><td class="component-name">↳ mailu-webmail</td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--blue" style="width: 0%;"></span></span> <span class="usage-val">&lt;1%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--orange" style="width: 10%;"></span></span> <span class="usage-val">10%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--green" style="width: 4%;"></span></span> <span class="usage-val">4%</span></td><td>-</td><td><button class="vm-action-btn btn-reset" onclick="restartContainer('oci-f-micro_1', 'mailu-webmail')" title="Restart container"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg></button></td></tr>
                                <tr class="service-row"><td class="component-name">↳ mailu-smtp</td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--blue" style="width: 1%;"></span></span> <span class="usage-val">1%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--orange" style="width: 10%;"></span></span> <span class="usage-val">10%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--green" style="width: 5%;"></span></span> <span class="usage-val">5%</span></td><td>-</td><td><button class="vm-action-btn btn-reset" onclick="restartContainer('oci-f-micro_1', 'mailu-smtp')" title="Restart container"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg></button></td></tr>
                                <tr class="service-row"><td class="component-name">↳ mailu-front</td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--blue" style="width: 1%;"></span></span> <span class="usage-val">1%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--orange" style="width: 8%;"></span></span> <span class="usage-val">8%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--green" style="width: 2%;"></span></span> <span class="usage-val">2%</span></td><td>-</td><td><button class="vm-action-btn btn-reset" onclick="restartContainer('oci-f-micro_1', 'mailu-front')" title="Restart container"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg></button></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- OCI Free Micro 2 -->
                <div class="resources-section mb-lg">
                    <h4 class="section-h4">
                        <span class="vm-header-dot vm-header-dot--oracle"></span>
                        OCI Free Micro 2
                        <span class="vm-specs-text">(1 OCPU, 1 GB RAM, 47 GB)</span>
                    </h4>
                    <div class="resources-table-container">
                        <table class="resources-table fs-md">
                            <thead>
                                <tr>
                                    <th class="col-w-28">Name</th>
                                    <th class="col-w-14">CPU</th>
                                    <th class="col-w-14">RAM</th>
                                    <th class="col-w-14">Storage</th>
                                    <th class="col-w-14">VRAM</th>
                                    <th class="col-w-16">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="totals-row">
                                    <td>Absolute</td>
                                    <td>1 OCPU</td>
                                    <td>0.55 / 1 GB</td>
                                    <td>9 / 47 GB</td>
                                    <td>-</td>
                                    <td>-</td>
                                </tr>
                                <tr class="vm-row vm-row--highlight">
                                    <td>VM Total</td>
                                    <td><span class="usage-bar"><span class="usage-fill usage-fill--blue" style="width: 10%;"></span></span> <span class="usage-val">10%</span></td>
                                    <td><span class="usage-bar"><span class="usage-fill usage-fill--orange" style="width: 55%;"></span></span> <span class="usage-val">55%</span></td>
                                    <td><span class="usage-bar"><span class="usage-fill usage-fill--green" style="width: 20%;"></span></span> <span class="usage-val">20%</span></td>
                                    <td>-</td>
                                    <td>-</td>
                                </tr>
                                <tr class="service-row"><td class="component-name">↳ matomo-db</td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--blue" style="width: 5%;"></span></span> <span class="usage-val">5%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--orange" style="width: 30%;"></span></span> <span class="usage-val">30%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--green" style="width: 15%;"></span></span> <span class="usage-val">15%</span></td><td>-</td><td><button class="vm-action-btn btn-reset" onclick="restartContainer('oci-f-micro_2', 'matomo-db')" title="Restart container"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg></button></td></tr>
                                <tr class="service-row"><td class="component-name">↳ matomo</td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--blue" style="width: 5%;"></span></span> <span class="usage-val">5%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--orange" style="width: 25%;"></span></span> <span class="usage-val">25%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--green" style="width: 5%;"></span></span> <span class="usage-val">5%</span></td><td>-</td><td><button class="vm-action-btn btn-reset" onclick="restartContainer('oci-f-micro_2', 'matomo')" title="Restart container"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg></button></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- GCP Free Micro 1 -->
                <div class="resources-section">
                    <h4 class="section-h4">
                        <span class="vm-header-dot vm-header-dot--gcp"></span>
                        GCP Free Micro 1
                        <span class="vm-specs-text">(0.25 vCPU, 1 GB RAM, 30 GB)</span>
                    </h4>
                    <div class="resources-table-container">
                        <table class="resources-table fs-md">
                            <thead>
                                <tr>
                                    <th class="col-w-28">Name</th>
                                    <th class="col-w-14">CPU</th>
                                    <th class="col-w-14">RAM</th>
                                    <th class="col-w-14">Storage</th>
                                    <th class="col-w-14">VRAM</th>
                                    <th class="col-w-16">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="totals-row">
                                    <td>Absolute</td>
                                    <td>0.25 vCPU</td>
                                    <td>0.7 / 1 GB</td>
                                    <td>6 / 30 GB</td>
                                    <td>-</td>
                                    <td>-</td>
                                </tr>
                                <tr class="vm-row vm-row--highlight">
                                    <td>VM Total</td>
                                    <td><span class="usage-bar"><span class="usage-fill usage-fill--blue" style="width: 20%;"></span></span> <span class="usage-val">20%</span></td>
                                    <td><span class="usage-bar"><span class="usage-fill usage-fill--orange" style="width: 70%;"></span></span> <span class="usage-val">70%</span></td>
                                    <td><span class="usage-bar"><span class="usage-fill usage-fill--green" style="width: 20%;"></span></span> <span class="usage-val">20%</span></td>
                                    <td>-</td>
                                    <td>-</td>
                                </tr>
                                <tr class="service-row"><td class="component-name">↳ npm</td><td><span class="usage-bar-sm"><span class="usage-fill" style="width: 8%; background: var(--accent-blue);"></span></span> <span class="usage-val">8%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--orange" style="width: 25%;"></span></span> <span class="usage-val">25%</span></td><td><span class="usage-bar-sm"><span class="usage-fill" style="width: 10%; background: var(--accent-green);"></span></span> <span class="usage-val">10%</span></td><td>-</td><td><button class="vm-action-btn btn-reset" onclick="restartContainer('gcp-f-micro_1', 'npm')" title="Restart container"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg></button></td></tr>
                                <tr class="service-row"><td class="component-name">↳ authelia</td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--blue" style="width: 3%;"></span></span> <span class="usage-val">3%</span></td><td><span class="usage-bar-sm"><span class="usage-fill" style="width: 15%; background: var(--accent-orange);"></span></span> <span class="usage-val">15%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--green" style="width: 5%;"></span></span> <span class="usage-val">5%</span></td><td>-</td><td><button class="vm-action-btn btn-reset" onclick="restartContainer('gcp-f-micro_1', 'authelia')" title="Restart container"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg></button></td></tr>
                                <tr class="service-row"><td class="component-name">↳ cloud-api</td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--blue" style="width: 1%;"></span></span> <span class="usage-val">1%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--orange" style="width: 10%;"></span></span> <span class="usage-val">10%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--green" style="width: 1%;"></span></span> <span class="usage-val">1%</span></td><td>-</td><td><button class="vm-action-btn btn-reset" onclick="restartContainer('gcp-f-micro_1', 'cloud-api')" title="Restart container"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg></button></td></tr>
                                <tr class="service-row"><td class="component-name">↳ wireguard</td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--blue" style="width: 5%;"></span></span> <span class="usage-val">5%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--orange" style="width: 10%;"></span></span> <span class="usage-val">10%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--green" style="width: 1%;"></span></span> <span class="usage-val">1%</span></td><td>-</td><td><button class="vm-action-btn btn-reset" onclick="restartContainer('gcp-f-micro_1', 'wireguard')" title="Restart container"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg></button></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div><!-- End Resources/Metrics Tab -->

        <!-- Profiling Tab Content -->
        <div id="profiling-tab" class="tab-content">
            <!-- Performance Profiling Dashboard -->
            <div class="resources-category">
                <h3 class="resources-category-title">Performance Profiling</h3>
                <p class="profiling-section-desc">Real-time performance analysis and bottleneck detection</p>

                <!-- Summary Cards -->
                <div class="profiling-summary-grid">
                    <div class="profiling-summary-card">
                        <div class="profiling-summary-value profiling-summary-value--green">98.5%</div>
                        <div class="profiling-summary-label">Avg Uptime</div>
                    </div>
                    <div class="profiling-summary-card">
                        <div class="profiling-summary-value profiling-summary-value--blue">142ms</div>
                        <div class="profiling-summary-label">Avg Response</div>
                    </div>
                    <div class="profiling-summary-card">
                        <div class="profiling-summary-value profiling-summary-value--yellow">3</div>
                        <div class="profiling-summary-label">Slow Queries</div>
                    </div>
                    <div class="profiling-summary-card">
                        <div class="profiling-summary-value profiling-summary-value--purple">0</div>
                        <div class="profiling-summary-label">Errors (24h)</div>
                    </div>
                </div>

                <!-- Response Time Distribution -->
                <div class="profiling-section">
                    <h4 class="profiling-section-title">Response Time Distribution</h4>
                    <div class="resources-table-container">
                        <table class="resources-table">
                            <thead>
                                <tr>
                                    <th>Endpoint</th>
                                    <th>P50</th>
                                    <th>P95</th>
                                    <th>P99</th>
                                    <th>Requests/min</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code class="profiling-code">GET /api/health</code></td>
                                    <td class="text-green">12ms</td>
                                    <td class="text-green">28ms</td>
                                    <td class="text-green">45ms</td>
                                    <td>120</td>
                                    <td><span class="status-badge on">FAST</span></td>
                                </tr>
                                <tr>
                                    <td><code class="profiling-code">POST /api/auth/login</code></td>
                                    <td class="text-green">85ms</td>
                                    <td class="text-yellow">210ms</td>
                                    <td class="text-yellow">380ms</td>
                                    <td>45</td>
                                    <td><span class="status-badge on">OK</span></td>
                                </tr>
                                <tr>
                                    <td><code class="profiling-code">GET /api/metrics</code></td>
                                    <td class="text-green">45ms</td>
                                    <td class="text-green">95ms</td>
                                    <td class="text-yellow">180ms</td>
                                    <td>200</td>
                                    <td><span class="status-badge on">FAST</span></td>
                                </tr>
                                <tr>
                                    <td><code class="profiling-code">GET /api/photos/sync</code></td>
                                    <td class="text-yellow">320ms</td>
                                    <td class="text-orange">890ms</td>
                                    <td class="text-red">1.2s</td>
                                    <td>15</td>
                                    <td><span class="status-badge status-badge--slow">SLOW</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Resource Hotspots -->
                <div class="profiling-section">
                    <h4 class="profiling-section-title">Resource Hotspots</h4>
                    <div class="resources-table-container">
                        <table class="resources-table">
                            <thead>
                                <tr>
                                    <th>Service</th>
                                    <th>CPU Peak</th>
                                    <th>Memory Peak</th>
                                    <th>I/O Wait</th>
                                    <th>Bottleneck</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>photoprism</strong></td>
                                    <td><span class="text-orange">78%</span></td>
                                    <td><span class="text-yellow">2.1 GB</span></td>
                                    <td><span class="text-green">5%</span></td>
                                    <td><span class="text-orange">CPU-bound (image processing)</span></td>
                                </tr>
                                <tr>
                                    <td><strong>matomo</strong></td>
                                    <td><span class="text-green">15%</span></td>
                                    <td><span class="text-yellow">450 MB</span></td>
                                    <td><span class="text-yellow">18%</span></td>
                                    <td><span class="text-yellow">I/O-bound (database)</span></td>
                                </tr>
                                <tr>
                                    <td><strong>npm</strong></td>
                                    <td><span class="text-green">8%</span></td>
                                    <td><span class="text-green">120 MB</span></td>
                                    <td><span class="text-green">2%</span></td>
                                    <td><span class="text-green">None detected</span></td>
                                </tr>
                                <tr>
                                    <td><strong>mailu</strong></td>
                                    <td><span class="text-green">12%</span></td>
                                    <td><span class="text-green">380 MB</span></td>
                                    <td><span class="text-green">4%</span></td>
                                    <td><span class="text-green">None detected</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Recent Traces -->
                <div class="resources-section">
                    <h4 class="profiling-section-title">Recent Slow Traces (&gt;500ms)</h4>
                    <div class="resources-table-container">
                        <table class="resources-table">
                            <thead>
                                <tr>
                                    <th>Timestamp</th>
                                    <th>Request</th>
                                    <th>Duration</th>
                                    <th>Root Cause</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="profiling-timestamp">2025-12-29 13:42:18</td>
                                    <td><code class="profiling-code">GET /api/photos/sync</code></td>
                                    <td class="text-orange">1.2s</td>
                                    <td>Large batch processing (150 images)</td>
                                </tr>
                                <tr>
                                    <td class="profiling-timestamp">2025-12-29 12:15:03</td>
                                    <td><code class="profiling-code">POST /api/matomo/archive</code></td>
                                    <td class="text-yellow">890ms</td>
                                    <td>Database archival job</td>
                                </tr>
                                <tr>
                                    <td class="profiling-timestamp">2025-12-29 10:33:47</td>
                                    <td><code class="profiling-code">GET /api/photos/thumbnails</code></td>
                                    <td class="text-yellow">720ms</td>
                                    <td>Cold cache miss</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div><!-- End Profiling Tab -->

        <!-- Audit Analytics Tab Content -->
        <div id="audit-analytics-tab" class="tab-content">
            <!-- Matomo Analytics Card -->
            <div class="resources-category">
                <h3 class="resources-category-title">Analytics Platform</h3>
                <div class="apps-cards-grid max-w-400">
                    <a href="https://analytics.diegonmarcos.com" target="_blank" class="app-card app-card-link">
                        <div class="app-card-header">
                            <div class="app-card-icon app-card-icon--blue">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M18 20V10M12 20V4M6 20v-6"/>
                                </svg>
                            </div>
                            <h3 class="app-card-title">Matomo Analytics</h3>
                        </div>
                        <div class="app-card-body">
                            <div class="app-card-section">
                                <h4 class="app-card-section-title">Features</h4>
                                <ul class="app-card-list">
                                    <li><span class="app-card-dot app-card-dot--green"></span>Privacy-focused tracking</li>
                                    <li><span class="app-card-dot app-card-dot--blue"></span>GDPR compliant</li>
                                    <li><span class="app-card-dot app-card-dot--purple"></span>Self-hosted on OCI</li>
                                </ul>
                            </div>
                        </div>
                        <div class="app-card-footer">
                            <span class="app-card-badge live">Online</span>
                            <span class="app-card-status">analytics.diegonmarcos.com</span>
                        </div>
                    </a>
                </div>
            </div>

            <!-- Cloud Pages Analytics Example -->
            <div class="resources-category mt-xl">
                <h3 class="resources-category-title">Cloud Pages Analytics</h3>
                <p class="text-secondary mb-3">Visitor metrics for Cloud Portal pages (example data)</p>

                <!-- Summary Cards -->
                <div class="grid-auto-fit-140 mb-3">
                    <div class="card-box">
                        <div class="analytics-summary-value analytics-summary-value--blue">2,847</div>
                        <div class="analytics-summary-label">Total Visits</div>
                    </div>
                    <div class="card-box">
                        <div class="analytics-summary-value analytics-summary-value--green">1,523</div>
                        <div class="analytics-summary-label">Unique Visitors</div>
                    </div>
                    <div class="card-box">
                        <div class="analytics-summary-value analytics-summary-value--purple">4:32</div>
                        <div class="analytics-summary-label">Avg. Duration</div>
                    </div>
                    <div class="card-box">
                        <div class="analytics-summary-value analytics-summary-value--orange">32%</div>
                        <div class="analytics-summary-label">Bounce Rate</div>
                    </div>
                </div>

                <!-- Pages Table -->
                <div class="resources-section">
                    <div class="resources-table-container">
                        <table class="resources-table fs-md">
                            <thead>
                                <tr>
                                    <th class="col-w-35">Page</th>
                                    <th class="col-w-15">Views</th>
                                    <th class="col-w-15">Unique</th>
                                    <th class="col-w-15">Avg. Time</th>
                                    <th class="col-w-20">Traffic</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <div class="d-inline-flex align-center gap-1">
                                            <span class="status-dot-sm status-dot-sm--blue"></span>
                                            <span>/cloud/</span>
                                        </div>
                                    </td>
                                    <td>1,247</td>
                                    <td>892</td>
                                    <td>3:45</td>
                                    <td>
                                        <div class="d-inline-flex align-center gap-1">
                                            <div class="traffic-bar-container">
                                                <div class="chart-fill chart-fill--blue" style="width: 100%;"></div>
                                            </div>
                                            <span class="fs-sm text-secondary">44%</span>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="d-inline-flex align-center gap-1">
                                            <span class="status-dot-sm status-dot-sm--green"></span>
                                            <span>/cloud/cloud_control</span>
                                        </div>
                                    </td>
                                    <td>623</td>
                                    <td>445</td>
                                    <td>5:12</td>
                                    <td>
                                        <div class="d-inline-flex align-center gap-1">
                                            <div class="traffic-bar-container">
                                                <div class="chart-fill chart-fill--green" style="width: 50%;"></div>
                                            </div>
                                            <span class="fs-sm text-secondary">22%</span>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="d-inline-flex align-center gap-1">
                                            <span class="status-dot-sm status-dot-sm--purple"></span>
                                            <span>/cloud/architecture</span>
                                        </div>
                                    </td>
                                    <td>512</td>
                                    <td>398</td>
                                    <td>4:28</td>
                                    <td>
                                        <div class="d-inline-flex align-center gap-1">
                                            <div class="traffic-bar-container">
                                                <div class="chart-fill chart-fill--purple" style="width: 41%;"></div>
                                            </div>
                                            <span class="fs-sm text-secondary">18%</span>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="d-inline-flex align-center gap-1">
                                            <span class="status-dot-sm status-dot-sm--orange"></span>
                                            <span>/cloud/products</span>
                                        </div>
                                    </td>
                                    <td>465</td>
                                    <td>312</td>
                                    <td>2:56</td>
                                    <td>
                                        <div class="d-inline-flex align-center gap-1">
                                            <div class="traffic-bar-container">
                                                <div class="chart-fill chart-fill--orange" style="width: 37%;"></div>
                                            </div>
                                            <span class="fs-sm text-secondary">16%</span>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Traffic Chart -->
                <div class="resources-section mt-3">
                    <h4 class="section-header">Visits Over Time (Last 7 Days)</h4>
                    <div class="visits-chart">
                        <div class="chart-column">
                            <div class="day-bar" style="height: 45%;"></div>
                            <span class="chart-label-xs">Mon</span>
                        </div>
                        <div class="chart-column">
                            <div class="day-bar" style="height: 62%;"></div>
                            <span class="chart-label-xs">Tue</span>
                        </div>
                        <div class="chart-column">
                            <div class="day-bar" style="height: 78%;"></div>
                            <span class="chart-label-xs">Wed</span>
                        </div>
                        <div class="chart-column">
                            <div class="day-bar" style="height: 55%;"></div>
                            <span class="chart-label-xs">Thu</span>
                        </div>
                        <div class="chart-column">
                            <div class="day-bar" style="height: 92%;"></div>
                            <span class="chart-label-xs">Fri</span>
                        </div>
                        <div class="chart-column">
                            <div class="day-bar" style="height: 100%;"></div>
                            <span class="chart-label-xs">Sat</span>
                        </div>
                        <div class="chart-column">
                            <div class="day-bar" style="height: 68%;"></div>
                            <span class="chart-label-xs">Sun</span>
                        </div>
                    </div>
                </div>

                <!-- Traffic Sources -->
                <div class="grid-280-mt">
                    <!-- Device Breakdown -->
                    <div class="resources-section">
                        <h4 class="section-header">Device Type</h4>
                        <div class="flex-col-gap">
                            <div>
                                <div class="progress-label">
                                    <span>Desktop</span><span class="progress-value--blue">68%</span>
                                </div>
                                <div class="progress-bar-container">
                                    <div class="chart-fill chart-fill--blue" style="width: 68%;"></div>
                                </div>
                            </div>
                            <div>
                                <div class="progress-label">
                                    <span>Mobile</span><span class="progress-value--green">24%</span>
                                </div>
                                <div class="progress-bar-container">
                                    <div class="chart-fill chart-fill--green" style="width: 24%;"></div>
                                </div>
                            </div>
                            <div>
                                <div class="progress-label">
                                    <span>Tablet</span><span class="progress-value--orange">8%</span>
                                </div>
                                <div class="progress-bar-container">
                                    <div class="chart-fill chart-fill--orange" style="width: 8%;"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Top Referrers -->
                    <div class="resources-section">
                        <h4 class="section-header">Top Referrers</h4>
                        <div class="flex-col-gap-sm">
                            <div class="referrer-row">
                                <span class="referrer-text">Direct / None</span>
                                <span class="referrer-count referrer-count--blue">892</span>
                            </div>
                            <div class="referrer-row">
                                <span class="referrer-text">github.com</span>
                                <span class="referrer-count referrer-count--green">423</span>
                            </div>
                            <div class="referrer-row">
                                <span class="referrer-text">diegonmarcos.com</span>
                                <span class="referrer-count referrer-count--purple">208</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Audit Logs Tab Content -->
        <div id="audit-logs-tab" class="tab-content">
            <div class="resources-category">
                <h3 class="resources-category-title">Audit Logs</h3>
                <p class="text-secondary mb-3">Security event logs and access history</p>

                <!-- Audit Logs Metrics -->
                <div class="resources-section mb-lg">
                    <div class="grid-150">
                        <div class="card-box">
                            <div class="stat-value-xl stat-value-xl--blue">1,247</div>
                            <div class="stat-label-sm">Total Events (24h)</div>
                        </div>
                        <div class="card-box">
                            <div class="stat-value-xl stat-value-xl--green">94.2%</div>
                            <div class="stat-label-sm">Success Rate</div>
                        </div>
                        <div class="card-box">
                            <div class="stat-value-xl stat-value-xl--red">47</div>
                            <div class="stat-label-sm">Blocked Attempts</div>
                        </div>
                        <div class="card-box">
                            <div class="stat-value-xl stat-value-xl--yellow">12</div>
                            <div class="stat-label-sm">Warnings</div>
                        </div>
                    </div>

                    <!-- Event Type Distribution Charts -->
                    <div class="grid-280">
                        <!-- Event Type Donut -->
                        <div class="analytics-card">
                            <h4 class="section-header">Event Type Distribution</h4>
                            <div class="flex-row-center-gap">
                                <svg viewBox="0 0 42 42" class="pie-chart">
                                    <!-- Auth: 45% (green) -->
                                    <circle cx="21" cy="21" r="15.91549430918954" fill="transparent" stroke="var(--accent-green)" stroke-width="6" stroke-dasharray="45 55" stroke-dashoffset="25"></circle>
                                    <!-- System: 25% (blue) -->
                                    <circle cx="21" cy="21" r="15.91549430918954" fill="transparent" stroke="var(--accent-blue)" stroke-width="6" stroke-dasharray="25 75" stroke-dashoffset="80"></circle>
                                    <!-- Network: 20% (purple) -->
                                    <circle cx="21" cy="21" r="15.91549430918954" fill="transparent" stroke="var(--accent-purple)" stroke-width="6" stroke-dasharray="20 80" stroke-dashoffset="55"></circle>
                                    <!-- Security: 10% (orange) -->
                                    <circle cx="21" cy="21" r="15.91549430918954" fill="transparent" stroke="var(--accent-orange)" stroke-width="6" stroke-dasharray="10 90" stroke-dashoffset="35"></circle>
                                </svg>
                                <div class="legend-list">
                                    <div class="legend-item"><span class="legend-dot legend-dot--green"></span> Authentication <span class="legend-value">45%</span></div>
                                    <div class="legend-item"><span class="legend-dot legend-dot--blue"></span> System <span class="legend-value">25%</span></div>
                                    <div class="legend-item"><span class="legend-dot legend-dot--purple"></span> Network <span class="legend-value">20%</span></div>
                                    <div class="d-inline-flex align-center gap-1"><span class="legend-dot legend-dot--orange"></span> Security <span class="legend-value">10%</span></div>
                                </div>
                            </div>
                        </div>

                        <!-- Event Status Breakdown -->
                        <div class="analytics-card">
                            <h4 class="section-header">Status Breakdown</h4>
                            <div class="flex-col-gap">
                                <div>
                                    <div class="progress-label-sm"><span>Success</span><span class="progress-value--green">1,175</span></div>
                                    <div class="progress-bar-container"><div class="chart-fill chart-fill--green" style="width: 94.2%;"></div></div>
                                </div>
                                <div>
                                    <div class="progress-label-sm"><span>Blocked</span><span class="progress-value--red">47</span></div>
                                    <div class="progress-bar-container"><div class="chart-fill chart-fill--red" style="width: 3.8%;"></div></div>
                                </div>
                                <div>
                                    <div class="progress-label-sm"><span>Warning</span><span class="progress-value--yellow">12</span></div>
                                    <div class="progress-bar-container"><div class="chart-fill chart-fill--yellow" style="width: 1%;"></div></div>
                                </div>
                                <div>
                                    <div class="progress-label-sm"><span>Info</span><span class="progress-value--blue">13</span></div>
                                    <div class="progress-bar-container"><div class="chart-fill chart-fill--blue" style="width: 1%;"></div></div>
                                </div>
                            </div>
                        </div>

                        <!-- Events Over Time -->
                        <div class="analytics-card">
                            <h4 class="section-header">Events Over Time (24h)</h4>
                            <div class="events-chart">
                                <div class="event-bar" style="height: 35%;"></div>
                                <div class="event-bar" style="height: 45%;"></div>
                                <div class="event-bar" style="height: 30%;"></div>
                                <div class="event-bar" style="height: 25%;"></div>
                                <div class="event-bar" style="height: 20%;"></div>
                                <div class="event-bar" style="height: 15%;"></div>
                                <div class="event-bar" style="height: 40%;"></div>
                                <div class="event-bar" style="height: 55%;"></div>
                                <div class="event-bar" style="height: 70%;"></div>
                                <div class="event-bar" style="height: 85%;"></div>
                                <div class="event-bar" style="height: 95%;"></div>
                                <div class="event-bar" style="height: 100%;"></div>
                                <div class="event-bar" style="height: 90%;"></div>
                                <div class="event-bar" style="height: 75%;"></div>
                                <div class="event-bar" style="height: 65%;"></div>
                                <div class="event-bar" style="height: 80%;"></div>
                                <div class="event-bar" style="height: 70%;"></div>
                                <div class="event-bar" style="height: 60%;"></div>
                                <div class="event-bar" style="height: 55%;"></div>
                                <div class="event-bar" style="height: 45%;"></div>
                                <div class="event-bar" style="height: 50%;"></div>
                                <div class="event-bar" style="height: 40%;"></div>
                                <div class="event-bar" style="height: 35%;"></div>
                                <div class="event-bar event-bar--green" style="height: 60%;"></div>
                            </div>
                            <div class="chart-timeline">
                                <span>00:00</span>
                                <span>06:00</span>
                                <span>12:00</span>
                                <span>18:00</span>
                                <span>Now</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="resources-section">
                    <div class="filter-row">
                        <select class="filter-select">
                            <option>All Events</option>
                            <option>Authentication</option>
                            <option>Authorization</option>
                            <option>System</option>
                            <option>Network</option>
                        </select>
                        <select class="filter-select">
                            <option>Last 24 hours</option>
                            <option>Last 7 days</option>
                            <option>Last 30 days</option>
                        </select>
                    </div>

                    <div class="resources-table-container">
                        <table class="resources-table fs-sm">
                            <thead>
                                <tr>
                                    <th>Timestamp</th>
                                    <th>Event</th>
                                    <th>Source</th>
                                    <th>User/IP</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="text-muted">2024-12-22 14:32:18</td>
                                    <td>SSH Login</td>
                                    <td>arch-1 (GCP)</td>
                                    <td>diego@192.168.1.100</td>
                                    <td><span class="status-badge on">SUCCESS</span></td>
                                </tr>
                                <tr>
                                    <td class="text-muted">2024-12-22 14:28:45</td>
                                    <td>OAuth2 Token Refresh</td>
                                    <td>auth.diegonmarcos.com</td>
                                    <td>github:diegonmarcos</td>
                                    <td><span class="status-badge on">SUCCESS</span></td>
                                </tr>
                                <tr>
                                    <td class="text-muted">2024-12-22 14:15:02</td>
                                    <td>NPM Proxy Access</td>
                                    <td>proxy.diegonmarcos.com</td>
                                    <td>185.220.101.45</td>
                                    <td><span class="status-badge on">ALLOWED</span></td>
                                </tr>
                                <tr>
                                    <td class="text-muted">2024-12-22 13:58:33</td>
                                    <td>Failed SSH Attempt</td>
                                    <td>oci-flex-1</td>
                                    <td>root@45.155.205.233</td>
                                    <td><span class="status-badge status-badge--blocked">BLOCKED</span></td>
                                </tr>
                                <tr>
                                    <td class="text-muted">2024-12-22 13:45:12</td>
                                    <td>Docker Container Start</td>
                                    <td>arch-1 (GCP)</td>
                                    <td>system</td>
                                    <td><span class="status-badge on">SUCCESS</span></td>
                                </tr>
                                <tr>
                                    <td class="text-muted">2024-12-22 13:30:00</td>
                                    <td>SSL Certificate Renewal</td>
                                    <td>npm-proxy</td>
                                    <td>letsencrypt</td>
                                    <td><span class="status-badge on">SUCCESS</span></td>
                                </tr>
                                <tr>
                                    <td class="text-muted">2024-12-22 13:12:44</td>
                                    <td>Authelia 2FA Verify</td>
                                    <td>auth.diegonmarcos.com</td>
                                    <td>diego@192.168.1.100</td>
                                    <td><span class="status-badge on">SUCCESS</span></td>
                                </tr>
                                <tr>
                                    <td class="text-muted">2024-12-22 12:55:21</td>
                                    <td>Firewall Rule Update</td>
                                    <td>GCP VPC</td>
                                    <td>terraform</td>
                                    <td><span class="status-badge on">APPLIED</span></td>
                                </tr>
                                <tr>
                                    <td class="text-muted">2024-12-22 12:30:08</td>
                                    <td>Rate Limit Triggered</td>
                                    <td>cloudflare</td>
                                    <td>91.121.45.78</td>
                                    <td><span class="status-badge status-badge--warn">WARN</span></td>
                                </tr>
                                <tr>
                                    <td class="text-muted">2024-12-22 12:00:00</td>
                                    <td>System Health Check</td>
                                    <td>monitoring</td>
                                    <td>cron</td>
                                    <td><span class="status-badge on">PASS</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="pagination-footer">
                        <span class="pagination-info">Showing 10 of 1,247 events</span>
                        <div class="pagination-btns">
                            <button class="pagination-btn">Previous</button>
                            <button class="pagination-btn">Next</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cost Tab Content -->
        <div id="cost-tab" class="tab-content">
            <!-- Infrastructure Cost Sub-tab -->
            <div id="cost-infra" class="cost-subtab-content active">
            <!-- Cloud Infrastructure Costs - Super Enhanced -->
            <div class="resources-category">
                <h3 class="resources-category-title">
                    <span>Cloud Infrastructure Costs</span>
                    <span id="cloud-costs-updated" class="updated-timestamp"></span>
                </h3>

                <!-- Big Hero Banner (like AI Costs) -->
                <div class="ai-cost-hero">
                    <div class="ai-cost-hero-main">
                        <div class="ai-hero-total">
                            <span class="ai-hero-label">Total Cloud Spend (All Time)</span>
                            <span class="ai-hero-value" id="cloud-all-time-spend">€0.83</span>
                            <span class="ai-hero-tokens" id="cloud-total-resources">2 VMs running across 2 providers</span>
                        </div>
                    </div>
                    <div class="ai-cost-hero-cards">
                        <div class="ai-hero-card">
                            <div class="ai-hero-card-value" id="cloud-total-month">€0.83</div>
                            <div class="ai-hero-card-label">This Month</div>
                            <div class="ai-hero-card-sub" id="cloud-month-label">Dec 2025 (8 days)</div>
                        </div>
                        <div class="ai-hero-card">
                            <div class="ai-hero-card-value text-orange" id="cloud-projected">€3.22</div>
                            <div class="ai-hero-card-label">Projected</div>
                            <div class="ai-hero-card-sub">Full month estimate</div>
                        </div>
                        <div class="ai-hero-card">
                            <div class="ai-hero-card-value" id="cloud-ytd">€0.83</div>
                            <div class="ai-hero-card-label">Year to Date</div>
                            <div class="ai-hero-card-sub">2025 Total</div>
                        </div>
                        <div class="ai-hero-card">
                            <div class="ai-hero-card-value text-success" id="cloud-savings">€44.17</div>
                            <div class="ai-hero-card-label">Savings</div>
                            <div class="ai-hero-card-sub">98% vs Market</div>
                        </div>
                    </div>
                </div>

                <!-- Provider Distribution Donut (like AI Costs model distribution) -->
                <div class="resources-category">
                    <h3 class="resources-category-title">Provider Cost Distribution (Current Month)</h3>
                    <div class="resources-section">
                        <div class="ai-donut-container">
                            <div class="ai-donut-chart">
                                <svg viewBox="0 0 100 100" class="ai-donut-svg">
                                    <circle cx="50" cy="50" r="40" fill="none" stroke="#1a1a2e" stroke-width="15"/>
                                    <circle cx="50" cy="50" r="40" fill="none" stroke="#F80000" stroke-width="15"
                                        stroke-dasharray="251 251" stroke-dashoffset="0" class="cloud-donut-oci"
                                        transform="rotate(-90 50 50)"/>
                                    <circle cx="50" cy="50" r="40" fill="none" stroke="#4285F4" stroke-width="15"
                                        stroke-dasharray="0 251" stroke-dashoffset="-251" class="cloud-donut-gcp"
                                        transform="rotate(-90 50 50)"/>
                                </svg>
                                <div class="ai-donut-center">
                                    <span class="ai-donut-value" id="cloud-donut-total">€0.83</span>
                                    <span class="ai-donut-label">Total</span>
                                </div>
                            </div>
                            <div class="ai-donut-legend" id="cloud-donut-legend">
                                <div class="ai-donut-legend-item">
                                    <span class="ai-donut-legend-dot ai-donut-legend-dot--oracle"></span>
                                    <span class="ai-donut-legend-name">Oracle Cloud (OCI)</span>
                                    <span class="ai-donut-legend-value" id="cloud-oci-cost">€0.83</span>
                                    <span class="ai-donut-legend-pct" id="cloud-oci-pct">100%</span>
                                </div>
                                <div class="ai-donut-legend-item">
                                    <span class="ai-donut-legend-dot ai-donut-legend-dot--gcp"></span>
                                    <span class="ai-donut-legend-name">Google Cloud (GCP)</span>
                                    <span class="ai-donut-legend-value" id="cloud-gcp-cost">€0.00</span>
                                    <span class="ai-donut-legend-pct" id="cloud-gcp-pct">0%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Resource Usage by VM -->
                <div class="resources-category">
                    <h3 class="resources-category-title">Resource Usage by VM</h3>

                    <!-- OCI Paid Flex 1 -->
                    <div class="resources-section mb-lg">
                        <h4 class="section-h4">
                            <span class="vm-header-dot vm-header-dot--oracle"></span>
                            OCI Paid Flex 1
                            <span class="vm-specs-text">(1 OCPU, 8 GB RAM, 242 GB)</span>
                        </h4>
                        <div class="resources-table-container">
                            <table class="resources-table fs-md">
                                <thead>
                                    <tr>
                                        <th class="col-w-40">Name</th>
                                        <th class="col-w-20">CPU</th>
                                        <th class="col-w-20">RAM</th>
                                        <th class="col-w-20">Storage</th>
                                    </tr>
                                </thead>
                                <tbody id="vm-resources-oci-p-flex_1">
                                    <tr class="vm-row vm-row--highlight">
                                        <td>VM</td>
                                        <td><span class="usage-bar"><span class="usage-fill usage-fill--blue" style="width: 15%;"></span></span> <span class="usage-val">15%</span></td>
                                        <td><span class="usage-bar"><span class="usage-fill usage-fill--green" style="width: 45%;"></span></span> <span class="usage-val">45%</span></td>
                                        <td><span class="usage-bar"><span class="usage-fill usage-fill--orange" style="width: 68%;"></span></span> <span class="usage-val">68%</span></td>
                                    </tr>
                                                                        <tr class="service-row"><td class="component-name">↳ photoprism</td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--blue" style="width: 5%;"></span></span> <span class="usage-val">5%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--green" style="width: 15%;"></span></span> <span class="usage-val">15%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--orange" style="width: 21%;"></span></span> <span class="usage-val">21%</span></td></tr>
                                    <tr class="service-row"><td class="component-name">↳ radicale</td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--blue" style="width: 0%;"></span></span> <span class="usage-val">&lt;1%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--green" style="width: 1%;"></span></span> <span class="usage-val">1%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--orange" style="width: 0%;"></span></span> <span class="usage-val">&lt;1%</span></td></tr>
                                    <tr class="service-row"><td class="component-name">↳ cloud-api</td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--blue" style="width: 1%;"></span></span> <span class="usage-val">1%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--green" style="width: 2%;"></span></span> <span class="usage-val">2%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--orange" style="width: 0%;"></span></span> <span class="usage-val">&lt;1%</span></td></tr>
                                    <tr class="service-row"><td class="component-name">↳ openvpn</td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--blue" style="width: 0%;"></span></span> <span class="usage-val">&lt;1%</span></td><td><span class="usage-bar-sm"><span class="usage-fill" style="width: 0%; background: var(--accent-green);"></span></span> <span class="usage-val">&lt;1%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--orange" style="width: 0%;"></span></span> <span class="usage-val">&lt;1%</span></td></tr>
                                    <tr class="service-row"><td class="component-name">↳ redis</td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--blue" style="width: 1%;"></span></span> <span class="usage-val">1%</span></td><td><span class="usage-bar-sm"><span class="usage-fill" style="width: 0%; background: var(--accent-green);"></span></span> <span class="usage-val">&lt;1%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--orange" style="width: 0%;"></span></span> <span class="usage-val">&lt;1%</span></td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- OCI Free Micro 1 -->
                    <div class="resources-section mb-lg">
                        <h4 class="section-h4">
                            <span class="vm-header-dot vm-header-dot--oracle"></span>
                            OCI Free Micro 1
                            <span class="vm-specs-text">(1 OCPU, 1 GB RAM, 47 GB)</span>
                        </h4>
                        <div class="resources-table-container">
                            <table class="resources-table fs-md">
                                <thead>
                                    <tr>
                                        <th class="col-w-40">Name</th>
                                        <th class="col-w-20">CPU</th>
                                        <th class="col-w-20">RAM</th>
                                        <th class="col-w-20">Storage</th>
                                    </tr>
                                </thead>
                                <tbody id="vm-resources-oci-f-micro_1">
                                    <tr class="vm-row vm-row--highlight">
                                        <td>VM</td>
                                        <td><span class="usage-bar"><span class="usage-fill usage-fill--blue" style="width: 5%;"></span></span> <span class="usage-val">5%</span></td>
                                        <td><span class="usage-bar"><span class="usage-fill usage-fill--orange" style="width: 60%;"></span></span> <span class="usage-val">60%</span></td>
                                        <td><span class="usage-bar"><span class="usage-fill usage-fill--green" style="width: 27%;"></span></span> <span class="usage-val">27%</span></td>
                                    </tr>
                                    <tr class="service-row"><td class="component-name">↳ mailu-front</td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--blue" style="width: 1%;"></span></span> <span class="usage-val">1%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--orange" style="width: 8%;"></span></span> <span class="usage-val">8%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--green" style="width: 2%;"></span></span> <span class="usage-val">2%</span></td></tr>
                                    <tr class="service-row"><td class="component-name">↳ mailu-admin</td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--blue" style="width: 1%;"></span></span> <span class="usage-val">1%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--orange" style="width: 12%;"></span></span> <span class="usage-val">12%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--green" style="width: 1%;"></span></span> <span class="usage-val">1%</span></td></tr>
                                    <tr class="service-row"><td class="component-name">↳ mailu-imap</td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--blue" style="width: 2%;"></span></span> <span class="usage-val">2%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--orange" style="width: 20%;"></span></span> <span class="usage-val">20%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--green" style="width: 15%;"></span></span> <span class="usage-val">15%</span></td></tr>
                                    <tr class="service-row"><td class="component-name">↳ mailu-smtp</td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--blue" style="width: 1%;"></span></span> <span class="usage-val">1%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--orange" style="width: 10%;"></span></span> <span class="usage-val">10%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--green" style="width: 5%;"></span></span> <span class="usage-val">5%</span></td></tr>
                                    <tr class="service-row"><td class="component-name">↳ mailu-webmail</td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--blue" style="width: 0%;"></span></span> <span class="usage-val">&lt;1%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--orange" style="width: 10%;"></span></span> <span class="usage-val">10%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--green" style="width: 4%;"></span></span> <span class="usage-val">4%</span></td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- OCI Free Micro 2 -->
                    <div class="resources-section mb-lg">
                        <h4 class="section-h4">
                            <span class="vm-header-dot vm-header-dot--oracle"></span>
                            OCI Free Micro 2
                            <span class="vm-specs-text">(1 OCPU, 1 GB RAM, 47 GB)</span>
                        </h4>
                        <div class="resources-table-container">
                            <table class="resources-table fs-md">
                                <thead>
                                    <tr>
                                        <th class="col-w-40">Name</th>
                                        <th class="col-w-20">CPU</th>
                                        <th class="col-w-20">RAM</th>
                                        <th class="col-w-20">Storage</th>
                                    </tr>
                                </thead>
                                <tbody id="vm-resources-oci-f-micro_2">
                                    <tr class="vm-row vm-row--highlight">
                                        <td>VM</td>
                                        <td><span class="usage-bar"><span class="usage-fill usage-fill--blue" style="width: 10%;"></span></span> <span class="usage-val">10%</span></td>
                                        <td><span class="usage-bar"><span class="usage-fill usage-fill--orange" style="width: 55%;"></span></span> <span class="usage-val">55%</span></td>
                                        <td><span class="usage-bar"><span class="usage-fill usage-fill--green" style="width: 20%;"></span></span> <span class="usage-val">20%</span></td>
                                    </tr>
                                    <tr class="service-row"><td class="component-name">↳ matomo-app</td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--blue" style="width: 5%;"></span></span> <span class="usage-val">5%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--orange" style="width: 25%;"></span></span> <span class="usage-val">25%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--green" style="width: 5%;"></span></span> <span class="usage-val">5%</span></td></tr>
                                    <tr class="service-row"><td class="component-name">↳ matomo-db</td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--blue" style="width: 5%;"></span></span> <span class="usage-val">5%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--orange" style="width: 30%;"></span></span> <span class="usage-val">30%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--green" style="width: 15%;"></span></span> <span class="usage-val">15%</span></td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- GCP Free Micro 1 -->
                    <div class="resources-section">
                        <h4 class="section-h4">
                            <span class="vm-header-dot vm-header-dot--gcp"></span>
                            GCP Free Micro 1
                            <span class="vm-specs-text">(0.25 vCPU, 1 GB RAM, 30 GB)</span>
                        </h4>
                        <div class="resources-table-container">
                            <table class="resources-table fs-md">
                                <thead>
                                    <tr>
                                        <th class="col-w-40">Name</th>
                                        <th class="col-w-20">CPU</th>
                                        <th class="col-w-20">RAM</th>
                                        <th class="col-w-20">Storage</th>
                                    </tr>
                                </thead>
                                <tbody id="vm-resources-gcp-f-micro_1">
                                    <tr class="vm-row vm-row--highlight">
                                        <td>VM</td>
                                        <td><span class="usage-bar"><span class="usage-fill usage-fill--blue" style="width: 20%;"></span></span> <span class="usage-val">20%</span></td>
                                        <td><span class="usage-bar"><span class="usage-fill usage-fill--orange" style="width: 70%;"></span></span> <span class="usage-val">70%</span></td>
                                        <td><span class="usage-bar"><span class="usage-fill usage-fill--green" style="width: 35%;"></span></span> <span class="usage-val">35%</span></td>
                                    </tr>
                                    <tr class="service-row"><td class="component-name">↳ npm</td><td><span class="usage-bar-sm"><span class="usage-fill" style="width: 8%; background: var(--accent-blue);"></span></span> <span class="usage-val">8%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--orange" style="width: 25%;"></span></span> <span class="usage-val">25%</span></td><td><span class="usage-bar-sm"><span class="usage-fill" style="width: 10%; background: var(--accent-green);"></span></span> <span class="usage-val">10%</span></td></tr>
                                    <tr class="service-row"><td class="component-name">↳ authelia</td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--blue" style="width: 3%;"></span></span> <span class="usage-val">3%</span></td><td><span class="usage-bar-sm"><span class="usage-fill" style="width: 15%; background: var(--accent-orange);"></span></span> <span class="usage-val">15%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--green" style="width: 5%;"></span></span> <span class="usage-val">5%</span></td></tr>
                                    <tr class="service-row"><td class="component-name">↳ authelia-redis</td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--blue" style="width: 1%;"></span></span> <span class="usage-val">1%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--orange" style="width: 10%;"></span></span> <span class="usage-val">10%</span></td><td><span class="usage-bar-sm"><span class="usage-fill" style="width: 3%; background: var(--accent-green);"></span></span> <span class="usage-val">3%</span></td></tr>
                                    <tr class="service-row"><td class="component-name">↳ wireguard</td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--blue" style="width: 5%;"></span></span> <span class="usage-val">5%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--orange" style="width: 10%;"></span></span> <span class="usage-val">10%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--green" style="width: 1%;"></span></span> <span class="usage-val">1%</span></td></tr>
                                    <tr class="service-row"><td class="component-name">↳ oauth2-proxy</td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--blue" style="width: 3%;"></span></span> <span class="usage-val">3%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--orange" style="width: 10%;"></span></span> <span class="usage-val">10%</span></td><td><span class="usage-bar-sm"><span class="usage-fill usage-fill--green" style="width: 1%;"></span></span> <span class="usage-val">1%</span></td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Monthly Cost Bar Chart (like AI Daily Cost) -->
                <div class="resources-category">
                    <h3 class="resources-category-title">Monthly Cost Trend</h3>
                    <div class="resources-section">
                        <div class="ai-bar-chart ai-bar-chart-container" id="cloud-monthly-chart">
                            <!-- Rendered by JS -->
                        </div>
                        <div class="ai-chart-legend">
                            <span class="ai-legend-item"><span class="ai-legend-dot ai-legend-dot--oracle"></span>OCI</span>
                            <span class="ai-legend-item"><span class="ai-legend-dot ai-legend-dot--gcp"></span>GCP</span>
                        </div>
                    </div>
                </div>

                <!-- Service Details Table -->
                <div class="resources-category">
                    <h3 class="resources-category-title">Service Breakdown (Current Month)</h3>
                    <div class="resources-section">
                        <div class="resources-table-container">
                            <table class="resources-table" id="cloud-services-table">
                                <thead>
                                    <tr>
                                        <th>Provider</th>
                                        <th>Service</th>
                                        <th>Description</th>
                                        <th>Usage</th>
                                        <th>Cost</th>
                                        <th>Visual</th>
                                    </tr>
                                </thead>
                                <tbody id="cloud-services-tbody">
                                    <tr>
                                        <td colspan="6" class="text-center text-muted">
                                            Loading cloud costs data...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Free Tier Usage (like Weekly Breakdown) -->
                <div class="resources-category">
                    <h3 class="resources-category-title">Free Tier Utilization</h3>
                    <div class="resources-section">
                        <div id="cloud-free-tier-container" class="free-tier-grid">
                            <!-- OCI Free Tier -->
                            <div class="free-tier-card free-tier-card--oracle">
                                <div class="free-tier-header">
                                    <div class="free-tier-icon free-tier-icon--oracle">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" width="18" height="18">
                                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="free-tier-title">Oracle Cloud (OCI)</div>
                                        <div class="fs-sm text-secondary">Always Free Tier</div>
                                    </div>
                                </div>
                                <div id="oci-free-tier-bars">
                                    <div class="free-tier-metric">
                                        <div class="progress-label">
                                            <span>Compute (ARM)</span><span class="text-muted">0%</span>
                                        </div>
                                        <div class="free-tier-bar">
                                            <div style="height: 100%; width: 0%; background: linear-gradient(90deg, #22c55e, #4ade80); border-radius: 4px;"></div>
                                        </div>
                                        <div class="free-tier-note">0 of 4 OCPU + 24 GB (Available)</div>
                                    </div>
                                    <div class="free-tier-metric">
                                        <div class="progress-label">
                                            <span>Block Storage</span><span class="text-success">25%</span>
                                        </div>
                                        <div class="free-tier-bar">
                                            <div style="height: 100%; width: 25%; background: #22c55e; border-radius: 4px;"></div>
                                        </div>
                                        <div class="free-tier-note">~94 GB of 200 GB (2x47 GB free micro)</div>
                                    </div>
                                    <div class="free-tier-metric">
                                        <div class="progress-label">
                                            <span>Object Storage</span><span class="text-success">1%</span>
                                        </div>
                                        <div class="free-tier-bar">
                                            <div style="height: 100%; width: 1%; background: #22c55e; border-radius: 4px;"></div>
                                        </div>
                                        <div class="free-tier-note">< 1 GB of 20 GB</div>
                                    </div>
                                    <div>
                                        <div class="progress-label">
                                            <span>VCN Egress</span><span class="text-success">0%</span>
                                        </div>
                                        <div class="free-tier-bar">
                                            <div style="height: 100%; width: 0.01%; background: #22c55e; border-radius: 4px;"></div>
                                        </div>
                                        <div class="free-tier-note">< 1 GB of 10 TB/month</div>
                                    </div>
                                </div>
                            </div>
                            <!-- GCP Free Tier -->
                            <div class="free-tier-card free-tier-card--gcp">
                                <div class="free-tier-header">
                                    <div class="free-tier-icon free-tier-icon--gcp">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" width="18" height="18">
                                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="free-tier-title">Google Cloud (GCP)</div>
                                        <div class="fs-sm text-secondary">Free Tier</div>
                                    </div>
                                </div>
                                <div id="gcp-free-tier-bars">
                                    <div class="free-tier-metric">
                                        <div class="progress-label">
                                            <span>Compute Engine</span><span class="progress-value--orange">100%</span>
                                        </div>
                                        <div class="free-tier-bar">
                                            <div style="height: 100%; width: 100%; background: linear-gradient(90deg, #4285F4, #66aaff); border-radius: 4px;"></div>
                                        </div>
                                        <div class="free-tier-note">1 e2-micro of 1 e2-micro (730 hrs/mo)</div>
                                    </div>
                                    <div class="free-tier-metric">
                                        <div class="progress-label">
                                            <span>Cloud Storage</span><span class="text-success">10%</span>
                                        </div>
                                        <div class="free-tier-bar">
                                            <div style="height: 100%; width: 10%; background: #22c55e; border-radius: 4px;"></div>
                                        </div>
                                        <div class="free-tier-note">< 1 GB of 5 GB</div>
                                    </div>
                                    <div class="free-tier-metric">
                                        <div class="progress-label">
                                            <span>Cloud DNS</span><span class="text-success">4%</span>
                                        </div>
                                        <div class="free-tier-bar">
                                            <div style="height: 100%; width: 4%; background: #22c55e; border-radius: 4px;"></div>
                                        </div>
                                        <div class="free-tier-note">1 zone of 25 zones</div>
                                    </div>
                                    <div>
                                        <div class="progress-label">
                                            <span>Network Egress</span><span class="progress-value--orange">50%</span>
                                        </div>
                                        <div class="free-tier-bar">
                                            <div style="height: 100%; width: 50%; background: #fbbf24; border-radius: 4px;"></div>
                                        </div>
                                        <div class="free-tier-note">~0.5 GB of 1 GB/month</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Market Comparison (Enhanced) -->
                <div class="resources-category">
                    <h3 class="resources-category-title">Market Comparison</h3>
                    <div class="resources-section">
                        <div id="cloud-market-comparison" class="cost-market-comparison">
                            <div class="cost-market-grid">
                                <div class="cost-savings-hero">
                                    <div class="cost-savings-value">98%</div>
                                    <div class="cost-savings-label">Cost Savings</div>
                                </div>
                                <div>
                                    <div class="cost-comparison-item">
                                        <div class="cost-comparison-row">
                                            <span class="text-muted">Your Cost</span>
                                            <span class="text-success fw-semibold">€0.83/mo</span>
                                        </div>
                                        <div class="cost-comparison-bar">
                                            <div style="height: 100%; width: 2%; background: linear-gradient(90deg, #22c55e, #4ade80); border-radius: 6px;"></div>
                                        </div>
                                    </div>
                                    <div class="cost-comparison-item">
                                        <div class="cost-comparison-row">
                                            <span class="text-muted">AWS Equivalent</span>
                                            <span class="text-red">€45.00/mo</span>
                                        </div>
                                        <div class="cost-comparison-bar">
                                            <div style="height: 100%; width: 100%; background: linear-gradient(90deg, #ff6b6b, #ff8888); border-radius: 6px;"></div>
                                        </div>
                                        <div class="cost-comparison-note">t3.medium + 50GB EBS</div>
                                    </div>
                                    <div>
                                        <div class="cost-comparison-row">
                                            <span class="text-muted">Azure Equivalent</span>
                                            <span class="text-pink">€42.00/mo</span>
                                        </div>
                                        <div class="cost-comparison-bar">
                                            <div style="height: 100%; width: 93%; background: linear-gradient(90deg, #f472b6, #f9a8d4); border-radius: 6px;"></div>
                                        </div>
                                        <div class="cost-comparison-note">B2s + 50GB SSD</div>
                                    </div>
                                </div>
                                <div class="cost-summary-box">
                                    <div class="cost-summary-box-value">€44.17</div>
                                    <div class="cost-summary-box-label">Monthly Savings</div>
                                    <div class="cost-summary-box-note">€530/year saved</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </div><!-- End Infrastructure Cost Sub-tab -->

            <!-- AI Cost Sub-tab -->
            <div id="cost-ai" class="cost-subtab-content">

            <!-- AI Cost Hero Summary -->
            <div class="ai-cost-hero">
                <div class="ai-cost-hero-main">
                    <div class="ai-hero-total">
                        <span class="ai-hero-label">Total AI Spend (All Time)</span>
                        <span class="ai-hero-value" id="ai-total-spend">$1,679.87</span>
                        <span class="ai-hero-tokens" id="ai-total-tokens">1.97B tokens processed</span>
                    </div>
                </div>
                <div class="ai-cost-hero-cards">
                    <div class="ai-hero-card">
                        <div class="ai-hero-card-value" id="ai-month-spend">$953.86</div>
                        <div class="ai-hero-card-label">This Month</div>
                        <div class="ai-hero-card-sub" id="ai-month-days">Dec 2025 (8 days)</div>
                    </div>
                    <div class="ai-hero-card">
                        <div class="ai-hero-card-value" id="ai-week-spend">$335.69</div>
                        <div class="ai-hero-card-label">This Week</div>
                        <div class="ai-hero-card-sub">Week of Dec 7</div>
                    </div>
                    <div class="ai-hero-card">
                        <div class="ai-hero-card-value" id="ai-today-spend">$88.91</div>
                        <div class="ai-hero-card-label">Today</div>
                        <div class="ai-hero-card-sub" id="ai-today-date">Dec 8, 2025</div>
                    </div>
                    <div class="ai-hero-card">
                        <div class="ai-hero-card-value" id="ai-avg-daily">$76.36</div>
                        <div class="ai-hero-card-label">Avg Daily</div>
                        <div class="ai-hero-card-sub">Last 21 days</div>
                    </div>
                </div>
            </div>

            <!-- Daily Cost Bar Chart -->
            <div class="resources-category">
                <h3 class="resources-category-title">Daily Cost Trend (Last 21 Days)</h3>
                <div class="resources-section">
                    <div class="ai-bar-chart" id="ai-daily-chart">
                        <!-- Bars will be rendered by JS -->
                    </div>
                    <div class="ai-chart-legend">
                        <span class="ai-legend-item"><span class="ai-legend-dot ai-legend-dot--opus"></span>Opus</span>
                        <span class="ai-legend-item"><span class="ai-legend-dot ai-legend-dot--sonnet"></span>Sonnet</span>
                        <span class="ai-legend-item"><span class="ai-legend-dot ai-legend-dot--haiku"></span>Haiku</span>
                    </div>
                </div>
            </div>

            <!-- Model Distribution Donut -->
            <div class="resources-category">
                <h3 class="resources-category-title">Model Cost Distribution (All Time)</h3>
                <div class="resources-section">
                    <div class="ai-donut-container">
                        <div class="ai-donut-chart">
                            <svg viewBox="0 0 100 100" class="ai-donut-svg">
                                <circle cx="50" cy="50" r="40" fill="none" stroke="#1a1a2e" stroke-width="15"/>
                                <circle cx="50" cy="50" r="40" fill="none" stroke="#a855f7" stroke-width="15"
                                    stroke-dasharray="205 251" stroke-dashoffset="0" class="ai-donut-opus"/>
                                <circle cx="50" cy="50" r="40" fill="none" stroke="#3b82f6" stroke-width="15"
                                    stroke-dasharray="43 251" stroke-dashoffset="-205" class="ai-donut-sonnet"/>
                                <circle cx="50" cy="50" r="40" fill="none" stroke="#22c55e" stroke-width="15"
                                    stroke-dasharray="3 251" stroke-dashoffset="-248" class="ai-donut-haiku"/>
                            </svg>
                            <div class="ai-donut-center">
                                <span class="ai-donut-value">$1,679</span>
                                <span class="ai-donut-label">Total</span>
                            </div>
                        </div>
                        <div class="ai-donut-legend">
                            <div class="ai-donut-legend-item">
                                <span class="ai-donut-legend-dot ai-donut-legend-dot--opus"></span>
                                <span class="ai-donut-legend-name">Claude Opus 4.5</span>
                                <span class="ai-donut-legend-value">$1,372.18</span>
                                <span class="ai-donut-legend-pct">81.7%</span>
                            </div>
                            <div class="ai-donut-legend-item">
                                <span class="ai-donut-legend-dot ai-donut-legend-dot--sonnet"></span>
                                <span class="ai-donut-legend-name">Claude Sonnet 4.5</span>
                                <span class="ai-donut-legend-value">$287.32</span>
                                <span class="ai-donut-legend-pct">17.1%</span>
                            </div>
                            <div class="ai-donut-legend-item">
                                <span class="ai-donut-legend-dot ai-donut-legend-dot--haiku"></span>
                                <span class="ai-donut-legend-name">Claude Haiku 4.5</span>
                                <span class="ai-donut-legend-value">$19.82</span>
                                <span class="ai-donut-legend-pct">1.2%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Token Usage Statistics -->
            <div class="resources-category">
                <h3 class="resources-category-title">Token Usage Statistics</h3>
                <div class="resources-section">
                    <div class="ai-token-grid">
                        <div class="ai-token-card">
                            <div class="ai-token-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                                </svg>
                            </div>
                            <div class="ai-token-content">
                                <div class="ai-token-value" id="ai-input-tokens">1.12M</div>
                                <div class="ai-token-label">Input Tokens</div>
                                <div class="ai-token-bar">
                                    <div class="ai-token-bar-fill" style="width: 0.06%; background: #4ade80;"></div>
                                </div>
                            </div>
                        </div>
                        <div class="ai-token-card">
                            <div class="ai-token-icon ai-token-icon--output">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7 10 12 15 17 10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                            </div>
                            <div class="ai-token-content">
                                <div class="ai-token-value" id="ai-output-tokens">3.25M</div>
                                <div class="ai-token-label">Output Tokens</div>
                                <div class="ai-token-bar">
                                    <div class="ai-token-bar-fill" style="width: 0.16%; background: #f472b6;"></div>
                                </div>
                            </div>
                        </div>
                        <div class="ai-token-card">
                            <div class="ai-token-icon ai-token-icon--cache-write">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83"/>
                                    <circle cx="12" cy="12" r="4"/>
                                </svg>
                            </div>
                            <div class="ai-token-content">
                                <div class="ai-token-value" id="ai-cache-create">152.9M</div>
                                <div class="ai-token-label">Cache Creation</div>
                                <div class="ai-token-bar">
                                    <div class="ai-token-bar-fill" style="width: 7.75%; background: #fbbf24;"></div>
                                </div>
                            </div>
                        </div>
                        <div class="ai-token-card">
                            <div class="ai-token-icon ai-token-icon--cache-read">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M4 4v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.342a2 2 0 0 0-.602-1.43l-4.44-4.342A2 2 0 0 0 13.56 2H6a2 2 0 0 0-2 2z"/>
                                    <path d="M14 2v4a2 2 0 0 0 2 2h4"/>
                                </svg>
                            </div>
                            <div class="ai-token-content">
                                <div class="ai-token-value" id="ai-cache-read">1.82B</div>
                                <div class="ai-token-label">Cache Read (92%)</div>
                                <div class="ai-token-bar">
                                    <div class="ai-token-bar-fill" style="width: 92%; background: #2dd4bf;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Weekly Breakdown -->
            <div class="resources-category">
                <h3 class="resources-category-title">Weekly Cost Breakdown</h3>
                <div class="resources-section">
                    <div class="ai-weekly-bars" id="ai-weekly-chart">
                        <!-- Generated by JS -->
                    </div>
                </div>
            </div>

            <!-- Session Cost Breakdown -->
            <div class="resources-category">
                <h3 class="resources-category-title">Top Projects by Cost</h3>
                <div class="resources-section">
                    <div class="ai-session-list" id="ai-session-list">
                        <!-- Generated by JS -->
                    </div>
                </div>
            </div>

            <!-- Monthly Cost Table -->
            <div class="resources-category">
                <h3 class="resources-category-title">Monthly Summary</h3>
                <div class="resources-section">
                    <div class="resources-table-container">
                        <table class="resources-table">
                            <thead>
                                <tr>
                                    <th>Month</th>
                                    <th>Opus</th>
                                    <th>Sonnet</th>
                                    <th>Haiku</th>
                                    <th>Total</th>
                                    <th>Visual</th>
                                </tr>
                            </thead>
                            <tbody id="monthly-cost-table">
                                <tr>
                                    <td colspan="6" class="text-center text-muted">
                                        Loading monthly data...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Daily Cost Table with Visual Bars -->
            <div class="resources-category">
                <h3 class="resources-category-title">Daily Cost Log (Last 21 Days)</h3>
                <div class="resources-section">
                    <div class="resources-table-container">
                        <table class="resources-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Opus</th>
                                    <th>Sonnet</th>
                                    <th>Haiku</th>
                                    <th>Total</th>
                                    <th>Visual</th>
                                </tr>
                            </thead>
                            <tbody id="daily-cost-table">
                                <tr>
                                    <td colspan="6" class="text-center text-muted">
                                        Loading daily data...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>



            <!-- AI Model Pricing Reference -->
            <div class="resources-category">
                <h3 class="resources-category-title">AI Model Pricing Reference</h3>
                <div class="resources-section">
                    <div class="resources-table-container">
                        <table class="resources-table">
                            <thead>
                                <tr>
                                    <th>Provider</th>
                                    <th>Model</th>
                                    <th>Input $/1M</th>
                                    <th>Output $/1M</th>
                                    <th>Cache Read</th>
                                    <th>Type</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td colspan="7" class="table-group-header">Anthropic (Claude)</td></tr>
                                <tr>
                                    <td>Anthropic</td>
                                    <td><strong>Claude Opus 4.5</strong></td>
                                    <td>$15.00</td>
                                    <td>$75.00</td>
                                    <td>$1.50</td>
                                    <td>API</td>
                                    <td><span class="status-badge on">Active</span></td>
                                </tr>
                                <tr>
                                    <td>Anthropic</td>
                                    <td><strong>Claude Sonnet 4.5</strong></td>
                                    <td>$3.00</td>
                                    <td>$15.00</td>
                                    <td>$0.30</td>
                                    <td>API</td>
                                    <td><span class="status-badge on">Active</span></td>
                                </tr>
                                <tr>
                                    <td>Anthropic</td>
                                    <td><strong>Claude Haiku 4.5</strong></td>
                                    <td>$0.80</td>
                                    <td>$4.00</td>
                                    <td>$0.08</td>
                                    <td>API</td>
                                    <td><span class="status-badge on">Active</span></td>
                                </tr>
                                <tr><td colspan="7" class="table-group-header">Google (Gemini)</td></tr>
                                <tr>
                                    <td>Google</td>
                                    <td><strong>Gemini 2.0 Flash</strong></td>
                                    <td>$0.10</td>
                                    <td>$0.40</td>
                                    <td>$0.025</td>
                                    <td>API</td>
                                    <td><span class="status-badge pending">Planned</span></td>
                                </tr>
                                <tr><td colspan="7" class="table-group-header">Local (Self-hosted)</td></tr>
                                <tr>
                                    <td>Local</td>
                                    <td><strong>DeepSeek R1</strong></td>
                                    <td>$0.00</td>
                                    <td>$0.00</td>
                                    <td>-</td>
                                    <td>Local</td>
                                    <td><span class="status-badge dev">Dev</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            </div><!-- End AI Cost Sub-tab -->

        </div><!-- End Cost Tab -->

        <!-- Capacity Tab Content -->
        <div id="capacity-tab" class="tab-content">
            <div class="resources-category">
                <h3 class="resources-category-title">Capacity Management</h3>
                <p class="text-secondary mb-3">Resource allocation and capacity planning</p>
                <div class="resources-section">
                    <div class="resources-table-container">
                        <table class="resources-table">
                            <thead>
                                <tr>
                                    <th>VM</th>
                                    <th>CPU</th>
                                    <th>RAM</th>
                                    <th>Storage</th>
                                    <th>Usage</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>gcp-f-micro_1</strong></td>
                                    <td>0.25 vCPU</td>
                                    <td>1 GB</td>
                                    <td>30 GB</td>
                                    <td>~60%</td>
                                    <td><span class="status-badge on">OK</span></td>
                                </tr>
                                <tr>
                                    <td><strong>oci-f-micro_1</strong></td>
                                    <td>1 OCPU</td>
                                    <td>1 GB</td>
                                    <td>47 GB</td>
                                    <td>~40%</td>
                                    <td><span class="status-badge on">OK</span></td>
                                </tr>
                                <tr>
                                    <td><strong>oci-f-micro_2</strong></td>
                                    <td>1 OCPU</td>
                                    <td>1 GB</td>
                                    <td>47 GB</td>
                                    <td>~35%</td>
                                    <td><span class="status-badge on">OK</span></td>
                                </tr>
                                <tr>
                                    <td><strong>oci-p-flex_1</strong></td>
                                    <td>1 OCPU</td>
                                    <td>8 GB</td>
                                    <td>100 GB</td>
                                    <td>~25%</td>
                                    <td><span class="status-badge status-badge--dormant">DORMANT</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div><!-- End Capacity Tab -->

        <!-- Apps Tab Content -->
        <div id="apps-tab" class="tab-content">
            <div class="apps-cards-grid">
                <!-- Row 1: Cloud Monitor (Centered) -->
                <div class="apps-card-row--centered">
                    <div class="app-card">
                        <div class="app-card-header">
                            <div class="app-card-icon app-card-icon--green">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                                </svg>
                            </div>
                            <h3 class="app-card-title">Cloud Monitor</h3>
                        </div>
                        <div class="app-card-body">
                            <div class="app-card-section">
                                <h4 class="app-card-section-title">Infra</h4>
                                <ul class="app-card-list">
                                    <li><span class="app-card-dot healthy"></span>Health Status</li>
                                    <li><span class="app-card-dot perf"></span>Performance Metrics</li>
                                </ul>
                            </div>
                            <div class="app-card-section">
                                <h4 class="app-card-section-title">Security</h4>
                                <ul class="app-card-list">
                                    <li><span class="app-card-dot sync"></span>Sync Status</li>
                                    <li><span class="app-card-dot sauron"></span>Sauron (Intrusion Detection)</li>
                                </ul>
                            </div>
                        </div>
                        <div class="app-card-footer">
                            <span class="app-card-badge live">Live Data</span>
                            <span class="app-card-status">Coming Soon</span>
                        </div>
                    </div>
                </div>

                <!-- Row 2: Cloud Debug, Cloud Audit Sync, Cloud Collectors -->
                <!-- Cloud Debug Card -->
                <div class="app-card">
                    <div class="app-card-header">
                        <div class="app-card-icon app-card-icon--orange">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 20h9"/>
                                <path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
                            </svg>
                        </div>
                        <h3 class="app-card-title">Cloud Debug</h3>
                    </div>
                    <div class="app-card-body">
                        <div class="app-card-section">
                            <h4 class="app-card-section-title">Topology Tables</h4>
                            <p class="app-card-desc">Visual infrastructure topology with relationships</p>
                        </div>
                        <div class="app-card-section">
                            <h4 class="app-card-section-title">Library of Commands</h4>
                            <ul class="app-card-list">
                                <li><span class="app-card-dot ssh"></span>SSH Commands</li>
                                <li><span class="app-card-dot docker"></span>Docker Commands</li>
                                <li><span class="app-card-dot system"></span>System Commands</li>
                            </ul>
                        </div>
                    </div>
                    <div class="app-card-footer">
                        <span class="app-card-badge tools">Dev Tools</span>
                        <span class="app-card-status">Coming Soon</span>
                    </div>
                </div>

                <!-- Cloud Audit Sync Card -->
                <div class="app-card">
                    <div class="app-card-header">
                        <div class="app-card-icon app-card-icon--purple">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="17 8 12 3 7 8"/>
                                <line x1="12" y1="3" x2="12" y2="15"/>
                            </svg>
                        </div>
                        <h3 class="app-card-title">Cloud Audit Sync</h3>
                    </div>
                    <div class="app-card-body">
                        <div class="app-card-section">
                            <h4 class="app-card-section-title">Data Sync</h4>
                            <p class="app-card-desc">Automated infrastructure data synchronization</p>
                        </div>
                        <div class="app-card-section">
                            <h4 class="app-card-section-title">Consolidation</h4>
                            <ul class="app-card-list">
                                <li><span class="app-card-dot logs"></span>Log Aggregation</li>
                                <li><span class="app-card-dot info"></span>Info Consolidation</li>
                            </ul>
                        </div>
                    </div>
                    <div class="app-card-footer">
                        <span class="app-card-badge audit">Audit</span>
                        <span class="app-card-status">Coming Soon</span>
                    </div>
                </div>

                <!-- Cloud Collectors Card -->
                <div class="app-card">
                    <div class="app-card-header">
                        <div class="app-card-icon app-card-icon--blue">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                                <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                                <line x1="12" y1="22.08" x2="12" y2="12"/>
                            </svg>
                        </div>
                        <h3 class="app-card-title">Cloud Collectors</h3>
                    </div>
                    <div class="app-card-body">
                        <div class="app-card-section">
                            <h4 class="app-card-section-title">Data Agents</h4>
                            <ul class="app-card-list">
                                <li><span class="app-card-dot app-card-dot--emerald"></span>VM Metrics</li>
                                <li><span class="app-card-dot app-card-dot--amber"></span>Container Stats</li>
                            </ul>
                        </div>
                        <div class="app-card-section">
                            <h4 class="app-card-section-title">Sources</h4>
                            <ul class="app-card-list">
                                <li><span class="app-card-dot app-card-dot--blue"></span>Cloud APIs</li>
                                <li><span class="app-card-dot app-card-dot--violet"></span>SSH Probes</li>
                            </ul>
                        </div>
                    </div>
                    <div class="app-card-footer">
                        <span class="app-card-badge app-card-badge--blue">Collectors</span>
                        <span class="app-card-status">Coming Soon</span>
                    </div>
                </div>
            </div>
        </div><!-- End Apps Tab -->

        <!-- Monitor Security Tab Content -->
        <div id="security-tab" class="tab-content">
            <!-- VM Public Ports Audit -->
            <div class="resources-category">
                <h3 class="resources-category-title">Public Ports Audit</h3>
                <p class="text-muted mb-1">Open ports per VM - Firewall rules vs Docker published ports (Docker can bypass firewall!)</p>
                <div class="resources-section">
                    <div class="resources-table-container">
                        <table class="resources-table fs-sm">
                            <thead>
                                <tr>
                                    <th class="col-w-15">VM</th>
                                    <th class="col-w-30">Firewall Open Ports</th>
                                    <th class="col-w-35">Docker Published Ports</th>
                                    <th style="width: 10%;">Mismatch</th>
                                    <th style="width: 10%;">Risk</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><span class="vm-name-inline"><span class="vm-header-dot vm-header-dot--gcp"></span><strong>gcp-f-micro_1</strong></span></td>
                                    <td><code class="code-inline">22, 80, 443, 81, 9091</code></td>
                                    <td><code class="code-inline">80:80, 443:443, 81:81, 9091:9091</code></td>
                                    <td><span class="progress-value--green">None</span></td>
                                    <td><span class="status-badge on">LOW</span></td>
                                </tr>
                                <tr>
                                    <td><span class="vm-name-inline"><span class="vm-header-dot vm-header-dot--oracle"></span><strong>oci-p-flex_1</strong></span></td>
                                    <td><code class="code-inline">22, 51820</code></td>
                                    <td><code class="code-inline">51820:51820/udp, 127.0.0.1:2342:2342</code></td>
                                    <td><span class="progress-value--green">None</span></td>
                                    <td><span class="status-badge on">LOW</span></td>
                                </tr>
                                <tr>
                                    <td><span class="vm-name-inline"><span class="vm-header-dot vm-header-dot--oracle"></span><strong>oci-f-micro_1</strong></span></td>
                                    <td><code class="code-inline">22, 25, 465, 587, 993, 995</code></td>
                                    <td><code class="code-inline">25:25, 465:465, 587:587, 993:993, 995:995, 143:143</code></td>
                                    <td><span class="progress-value--yellow">143</span></td>
                                    <td><span class="status-badge status-badge--warn">MED</span></td>
                                </tr>
                                <tr>
                                    <td><span class="vm-name-inline"><span class="vm-header-dot vm-header-dot--oracle"></span><strong>oci-f-micro_2</strong></span></td>
                                    <td><code class="code-inline">22</code></td>
                                    <td><code class="code-inline">127.0.0.1:8080:80</code></td>
                                    <td><span class="progress-value--green">None</span></td>
                                    <td><span class="status-badge on">LOW</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="warning-box">
                        <strong class="text-warning">Warning:</strong> <span class="text-muted">Docker with <code>-p HOST:CONTAINER</code> publishes ports directly, bypassing iptables/firewalld rules. Always use <code>127.0.0.1:PORT:PORT</code> for internal services and proxy through NPM.</span>
                    </div>
                </div>
            </div>

            <!-- Security Services Section -->
            <div class="resources-category">
                <h3 class="resources-category-title">Security Services</h3>
                <p class="text-secondary mb-3">Security services status and monitoring</p>
                <div class="resources-section">
                    <div class="resources-table-container">
                        <table class="resources-table">
                            <thead>
                                <tr>
                                    <th>Service</th>
                                    <th>Type</th>
                                    <th>Description</th>
                                    <th>Location</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>MyVault</strong></td>
                                    <td>Password Manager</td>
                                    <td>Bitwarden EU - Secure credential storage</td>
                                    <td>vault.bitwarden.eu (SaaS)</td>
                                    <td><span class="status-badge on">ON</span></td>
                                </tr>
                                <tr>
                                    <td><strong>Authelia</strong></td>
                                    <td>2FA Gateway</td>
                                    <td>TOTP authentication for protected services</td>
                                    <td>GCP Micro 1 (34.55.55.234:9091)</td>
                                    <td><span class="status-badge on">ON</span></td>
                                </tr>
                                <tr>
                                    <td><strong>OAuth2 Proxy</strong></td>
                                    <td>Admin Auth</td>
                                    <td>GitHub OAuth2 for cloud_dash, photos, mail</td>
                                    <td>GCP Micro 1</td>
                                    <td><span class="status-badge on">ON</span></td>
                                </tr>
                                <tr>
                                    <td><strong>NPM + SSL</strong></td>
                                    <td>TLS Termination</td>
                                    <td>Let's Encrypt certificates with auto-renewal</td>
                                    <td>GCP Micro 1 (Central NPM)</td>
                                    <td><span class="status-badge on">ON</span></td>
                                </tr>
                                <tr>
                                    <td><strong>Docker Networks</strong></td>
                                    <td>Network Isolation</td>
                                    <td>Segmented: public_net, private_net, db_bridge</td>
                                    <td>OCI Flex 1</td>
                                    <td><span class="status-badge on">ON</span></td>
                                </tr>
                                <tr>
                                    <td><strong>SSH Keys</strong></td>
                                    <td>Access Control</td>
                                    <td>Key-based auth for all VMs - no passwords</td>
                                    <td>All VMs</td>
                                    <td><span class="status-badge on">ON</span></td>
                                </tr>
                                <tr>
                                    <td><strong>Cloud Firewalls</strong></td>
                                    <td>Network Security</td>
                                    <td>OCI Security Lists + GCP Firewall Rules</td>
                                    <td>OCI + GCP</td>
                                    <td><span class="status-badge on">ON</span></td>
                                </tr>
                                <tr>
                                    <td><strong>Gmail SMTP Relay</strong></td>
                                    <td>Notifications</td>
                                    <td>App Password auth for Authelia alerts</td>
                                    <td>Gmail (SaaS)</td>
                                    <td><span class="status-badge on">ON</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Security Layers Section -->
            <div class="resources-category">
                <h3 class="resources-category-title">Security Layers</h3>
                <div class="resources-section">
                    <div class="resources-table-container">
                        <table class="resources-table">
                            <thead>
                                <tr>
                                    <th>Layer</th>
                                    <th>Components</th>
                                    <th>Purpose</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>1. Network Edge</strong></td>
                                    <td>Cloud Firewalls, UFW, Fail2Ban</td>
                                    <td>Block unauthorized access at perimeter</td>
                                </tr>
                                <tr>
                                    <td><strong>2. Traffic Routing</strong></td>
                                    <td>NPM Proxy, TLS/SSL, Rate Limiting</td>
                                    <td>Secure transport and HTTPS termination</td>
                                </tr>
                                <tr>
                                    <td><strong>3. Authentication</strong></td>
                                    <td>Authelia 2FA, OAuth 2.0 (GitHub)</td>
                                    <td>Verify identity with multi-factor auth</td>
                                </tr>
                                <tr>
                                    <td><strong>4. Application</strong></td>
                                    <td>Docker Networks, Container Isolation</td>
                                    <td>Limit blast radius with segmentation</td>
                                </tr>
                                <tr>
                                    <td><strong>5. Data</strong></td>
                                    <td>Encrypted volumes, Separate DBs</td>
                                    <td>Protect data at rest</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Docker Networks Section -->
            <div class="resources-category">
                <h3 class="resources-category-title">Docker Network Segmentation</h3>
                <div class="resources-section">
                    <div class="resources-table-container">
                        <table class="resources-table">
                            <thead>
                                <tr>
                                    <th>VM</th>
                                    <th>Network Name</th>
                                    <th>Subnet</th>
                                    <th>Purpose</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>oci-f-micro_1</td>
                                    <td>mail_network</td>
                                    <td>172.20.0.0/24</td>
                                    <td>Mail services (Mailu)</td>
                                </tr>
                                <tr>
                                    <td>oci-f-micro_2</td>
                                    <td>matomo_network</td>
                                    <td>172.21.0.0/24</td>
                                    <td>Analytics stack</td>
                                </tr>
                                <tr>
                                    <td>gcp-f-micro_1</td>
                                    <td>proxy_network</td>
                                    <td>172.23.0.0/24</td>
                                    <td>NPM proxy + Authelia</td>
                                </tr>
                                <tr>
                                    <td>oci-p-flex_1</td>
                                    <td>dev_network</td>
                                    <td>172.24.0.0/24</td>
                                    <td>Services (photos, calendar)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- VPN Tunneling Section -->
            <div class="resources-category">
                <h3 class="resources-category-title">VPN & Tunneling</h3>
                <div class="resources-section">
                    <div class="resources-table-container">
                        <table class="resources-table">
                            <thead>
                                <tr>
                                    <th>Service</th>
                                    <th>Protocol</th>
                                    <th>Port</th>
                                    <th>Purpose</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>WireGuard Tunnel</strong></td>
                                    <td>WireGuard</td>
                                    <td>51820/UDP</td>
                                    <td>GCP to OCI secure tunnel for backend services</td>
                                    <td><span class="status-badge on">ON</span></td>
                                </tr>
                                <tr>
                                    <td><strong>OpenVPN</strong></td>
                                    <td>OpenVPN</td>
                                    <td>1194/UDP</td>
                                    <td>Client VPN for admin access</td>
                                    <td><span class="status-badge dev">DEV</span></td>
                                </tr>
                                <tr>
                                    <td><strong>Cloudflare Tunnel</strong></td>
                                    <td>cloudflared</td>
                                    <td>-</td>
                                    <td>Zero-trust access (alternative)</td>
                                    <td><span class="status-badge hold">HOLD</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Authelia 2FA Flow Section -->
            <div class="resources-category">
                <h3 class="resources-category-title">Authelia 2FA Flow</h3>
                <div class="resources-section resource-mono-section">Browser Request: photos.diegonmarcos.com
        |
        v
+-----------------+
|   CLOUDFLARE    |  DNS: 34.55.55.234 (GCP)
+-----------------+
        |
        v
+-----------------+
|   GCP NPM       |  Nginx Proxy Manager
|   auth_request  |---> Authelia (localhost:9091)
+-----------------+           |
        |                     v
        |            [No Session?]
        |                     |
        v                     v
  REDIRECT 302     auth.diegonmarcos.com
        |                (Login + TOTP)
        |                     |
        v                     v
[Cookie Set]      authelia_session cookie
        |          (domain: diegonmarcos.com)
        v
+-----------------+
|  WireGuard VPN  |  10.0.0.1 -> 10.0.0.2
+-----------------+
        |
        v
+-----------------+
|  OCI Photoprism |  Backend service (10.0.0.2:2342)
+-----------------+</div>
            </div>

            <!-- SSO Section -->
            <div class="resources-category">
                <h3 class="resources-category-title">SSO Across Subdomains</h3>
                <div class="resources-section">
                    <p class="text-muted mb-1">Single Sign-On via shared Authelia session cookie (domain: diegonmarcos.com)</p>
                    <div class="resources-table-container">
                        <table class="resources-table">
                            <thead>
                                <tr>
                                    <th>Protected Subdomain</th>
                                    <th>Service</th>
                                    <th>Auth Level</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>photos.diegonmarcos.com</td>
                                    <td>Photoprism Gallery</td>
                                    <td>2FA (TOTP)</td>
                                    <td><span class="status-badge on">Protected</span></td>
                                </tr>
                                <tr>
                                    <td>cloud.diegonmarcos.com</td>
                                    <td>Cloud Dashboard</td>
                                    <td>OAuth2 (GitHub)</td>
                                    <td><span class="status-badge on">Protected</span></td>
                                </tr>
                                <tr>
                                    <td>cal.diegonmarcos.com</td>
                                    <td>Calendar (Radicale)</td>
                                    <td>Basic Auth</td>
                                    <td><span class="status-badge on">Protected</span></td>
                                </tr>
                                                                <tr>
                                    <td>mail.diegonmarcos.com</td>
                                    <td>Mailu Admin</td>
                                    <td>2FA (TOTP)</td>
                                    <td><span class="status-badge on">Protected</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- API OAuth Section -->
            <div class="resources-category">
                <h3 class="resources-category-title">API OAuth Integration</h3>
                <div class="resources-section">
                    <div class="resources-table-container">
                        <table class="resources-table">
                            <thead>
                                <tr>
                                    <th>Application</th>
                                    <th>OAuth Provider</th>
                                    <th>Scopes</th>
                                    <th>Purpose</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Cloud Dashboard</strong></td>
                                    <td>GitHub OAuth2</td>
                                    <td>read:user, workflow</td>
                                    <td>Admin authentication, workflow dispatch</td>
                                </tr>
                                <tr>
                                    <td><strong>MyPhotos</strong></td>
                                    <td>GitHub OAuth2</td>
                                    <td>read:user</td>
                                    <td>Access control for photo gallery</td>
                                </tr>
                                <tr>
                                    <td><strong>MyMail</strong></td>
                                    <td>GitHub OAuth2</td>
                                    <td>read:user</td>
                                    <td>Admin panel authentication</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div><!-- End Security Tab -->

        <!-- Infrastructure Tab Content (Status View) -->
        <div id="infra-tab" class="tab-content">

        <!-- View Mode Controls (for App/Data/Containers/Security views) -->
        <div class="view-mode-controls" id="list-view-controls">
            <span class="view-mode-label">Group:</span>
            <div class="view-mode-group">
                <button class="view-mode-btn active" data-group-mode="by-vm" title="Group by VM">VM</button>
                <button class="view-mode-btn" data-group-mode="by-type" title="Group by Type">Type</button>
            </div>
        </div>


        <!-- BY VM VIEW -->
        <div id="infra-by-vm-view" class="infra-view-content active">
            <!-- VMs Section -->
            <div class="resources-category">
                <h3 class="resources-category-title">VMs</h3>
                <div class="resources-section">
                    <div class="resources-table-container">
                        <table class="resources-table status-table">
                            <thead><tr><th>Host</th><th>VM</th><th>IP</th><th>Docker Network</th><th>OS</th><th>Actions</th></tr></thead>
                            <tbody id="infra-vms-tbody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Services Section (Grouped by VM) -->
            <div class="resources-category">
                <h3 class="resources-category-title">Services</h3>
                <div id="infra-services-by-vm-container"></div>
            </div>
        </div>

        <!-- BY TYPE VIEW -->
        <div id="infra-by-type-view" class="infra-view-content view-hidden">
            <!-- A120) Security Services -->
            <div class="resources-category">
                <h3 class="resources-category-title">A120) Security Services</h3>
                <div class="resources-section">
                    <p class="section-description">Backup, security, and data protection services</p>
                    <div id="infra-type-security"></div>
                </div>
            </div>

            <!-- A120b) Auth & Proxy Services -->
            <div class="resources-category">
                <h3 class="resources-category-title">A120b) Auth & Proxy Services</h3>
                <div class="resources-section">
                    <p class="section-description">Web servers, OAuth2, Authelia 2FA, VPN, and reverse proxies</p>
                    <div id="infra-type-auth-proxy"></div>
                </div>
            </div>

            <!-- A121) Audit -->
            <div class="resources-category">
                <h3 class="resources-category-title">A121) Audit & Analytics</h3>
                <div class="resources-section">
                    <p class="section-description">Analytics, logging, and audit services</p>
                    <div id="infra-type-audit"></div>
                </div>
            </div>

            <!-- A122) Data & API & MCP -->
            <div class="resources-category">
                <h3 class="resources-category-title">A122) Data & API & MCP</h3>
                <div class="resources-section">
                    <p class="section-description">APIs, caching, databases, and Model Context Protocol services</p>
                    <div id="infra-type-data-api"></div>
                </div>
            </div>

            <!-- A123) Others -->
            <div class="resources-category">
                <h3 class="resources-category-title">A123) Other Services</h3>
                <div class="resources-section">
                    <p class="section-description">User-facing and miscellaneous services</p>
                    <div id="infra-type-others"></div>
                </div>
            </div>
        </div>

        <!-- GRAPH VIEW - RESOURCES (App Allocation + Database Design) -->
        <div id="infra-resource-graphs-view" class="infra-view-content view-hidden">
            <div class="graph-maps-grid">
                <div class="graph-map-section">
                    <div class="org-tree" id="graph-app-container">
                        <!-- App Allocation Map rendered by JS -->
                    </div>
                </div>
                <div class="graph-map-section">
                    <div class="org-tree" id="graph-database-container">
                        <!-- Database Design Map rendered by JS -->
                    </div>
                </div>
            </div>
        </div>

        <!-- GRAPH VIEW - SECURITY (6 Security Design Maps) -->
        <div id="infra-security-graphs-view" class="infra-view-content view-hidden">
            <div class="graph-maps-grid">
                <div class="graph-map-section">
                    <div class="org-tree" id="graph-auth-flow-container">
                        <!-- Authentication Flow rendered by JS -->
                    </div>
                </div>
                <div class="graph-map-section">
                    <div class="org-tree" id="graph-authz-flow-container">
                        <!-- Authorization Flow rendered by JS -->
                    </div>
                </div>
                <div class="graph-map-section">
                    <div class="org-tree" id="graph-network-protection-container">
                        <!-- Network Protection rendered by JS -->
                    </div>
                </div>
                <div class="graph-map-section">
                    <div class="org-tree" id="graph-data-protection-container">
                        <!-- Data Protection rendered by JS -->
                    </div>
                </div>
                <div class="graph-map-section">
                    <div class="org-tree" id="graph-threat-protection-container">
                        <!-- Threat Protection rendered by JS -->
                    </div>
                </div>
                <div class="graph-map-section">
                    <div class="org-tree" id="graph-observability-container">
                        <!-- Observability rendered by JS -->
                    </div>
                </div>
            </div>
        </div>

        <!-- SECURITY TABLE VIEW - Security Features List -->
        <div id="infra-security-table-view" class="infra-view-content view-hidden">
            <div class="resources-category">
                <h3 class="resources-category-title">Security Features</h3>
                <p class="text-secondary mb-3">Comprehensive list of security controls and features</p>
                <div class="resources-table-container">
                    <table class="resources-table fs-sm" id="security-features-table">
                        <!-- Rendered by JS -->
                    </table>
                </div>
            </div>
        </div>

        <!-- DATA VIEW - Database Allocations by VM -->
        <div id="infra-data-view" class="infra-view-content view-hidden">
            <div class="resources-category">
                <h3 class="resources-category-title">Database Allocations by VM</h3>
                <p class="text-secondary mb-3">Storage allocation and database instances per VM</p>

                <!-- GCP Free Micro 1 -->
                <div class="resources-section mb-lg">
                    <h4 class="section-h4">
                        <span class="vm-header-dot vm-header-dot--gcp"></span>
                        gcp-f-micro_1 (34.55.55.234)
                        <span class="vm-specs-text">10 GB Boot</span>
                    </h4>
                    <div class="resources-table-container">
                        <table class="resources-table fs-sm">
                            <thead>
                                <tr>
                                    <th>Database</th>
                                    <th>Type</th>
                                    <th>Service</th>
                                    <th>Size</th>
                                    <th>Path</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>authelia-db</strong></td>
                                    <td>SQLite</td>
                                    <td>Authelia</td>
                                    <td>~5 MB</td>
                                    <td><code class="code-sm">/data/authelia/db.sqlite3</code></td>
                                </tr>
                                <tr>
                                    <td><strong>npm-db</strong></td>
                                    <td>SQLite</td>
                                    <td>NPM</td>
                                    <td>~10 MB</td>
                                    <td><code class="code-sm">/data/npm/database.sqlite</code></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- OCI Paid Flex 1 -->
                <div class="resources-section mb-lg">
                    <h4 class="section-h4">
                        <span class="vm-header-dot vm-header-dot--oracle"></span>
                        oci-p-flex_1 (84.235.234.87)
                        <span class="vm-specs-text">242 GB Boot</span>
                    </h4>
                    <div class="resources-table-container">
                        <table class="resources-table fs-sm">
                            <thead>
                                <tr>
                                    <th>Database</th>
                                    <th>Type</th>
                                    <th>Service</th>
                                    <th>Size</th>
                                    <th>Path</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>photoprism-db</strong></td>
                                    <td>MariaDB</td>
                                    <td>PhotoPrism</td>
                                    <td>~2 GB</td>
                                    <td><code class="code-sm">/data/photoprism/database/</code></td>
                                </tr>
                                <tr>
                                    <td><strong>photoprism-sidecar</strong></td>
                                    <td>Files (YAML/JSON)</td>
                                    <td>PhotoPrism</td>
                                    <td>~5 GB</td>
                                    <td><code class="code-sm">/data/photoprism/storage/sidecar/</code></td>
                                </tr>
                                <tr>
                                    <td><strong>photoprism-originals</strong></td>
                                    <td>Files (Photos)</td>
                                    <td>PhotoPrism</td>
                                    <td>~100 GB</td>
                                    <td><code class="code-sm">/data/photoprism/originals/</code></td>
                                </tr>
                                                                <tr>
                                    <td><strong>radicale-db</strong></td>
                                    <td>Files (ICS/VCF)</td>
                                    <td>Radicale</td>
                                    <td>~50 MB</td>
                                    <td><code class="code-sm">/data/radicale/collections/</code></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- OCI Free Micro 1 -->
                <div class="resources-section mb-lg">
                    <h4 class="section-h4">
                        <span class="vm-header-dot vm-header-dot--oracle"></span>
                        oci-f-micro_1 (130.110.251.193)
                        <span class="vm-specs-text">47 GB Boot</span>
                    </h4>
                    <div class="resources-table-container">
                        <table class="resources-table fs-sm">
                            <thead>
                                <tr>
                                    <th>Database</th>
                                    <th>Type</th>
                                    <th>Service</th>
                                    <th>Size</th>
                                    <th>Path</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>mailu-db</strong></td>
                                    <td>SQLite</td>
                                    <td>Mailu</td>
                                    <td>~50 MB</td>
                                    <td><code class="code-sm">/mailu/data/main.db</code></td>
                                </tr>
                                <tr>
                                    <td><strong>mailu-mail</strong></td>
                                    <td>Maildir</td>
                                    <td>Mailu (Dovecot)</td>
                                    <td>~2 GB</td>
                                    <td><code class="code-sm">/mailu/mail/</code></td>
                                </tr>
                                <tr>
                                    <td><strong>mailu-dkim</strong></td>
                                    <td>Keys</td>
                                    <td>Mailu (DKIM)</td>
                                    <td>~1 MB</td>
                                    <td><code class="code-sm">/mailu/dkim/</code></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- OCI Free Micro 2 -->
                <div class="resources-section mb-lg">
                    <h4 class="section-h4">
                        <span class="vm-header-dot vm-header-dot--oracle"></span>
                        oci-f-micro_2 (129.151.228.66)
                        <span class="vm-specs-text">47 GB Boot</span>
                    </h4>
                    <div class="resources-table-container">
                        <table class="resources-table fs-sm">
                            <thead>
                                <tr>
                                    <th>Database</th>
                                    <th>Type</th>
                                    <th>Service</th>
                                    <th>Size</th>
                                    <th>Path</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>matomo-db</strong></td>
                                    <td>MariaDB</td>
                                    <td>Matomo</td>
                                    <td>~1 GB</td>
                                    <td><code class="code-sm">/data/matomo/db/</code></td>
                                </tr>
                                <tr>
                                    <td><strong>matomo-config</strong></td>
                                    <td>PHP Files</td>
                                    <td>Matomo</td>
                                    <td>~50 MB</td>
                                    <td><code class="code-sm">/data/matomo/config/</code></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Storage Summary -->
                <div class="resources-section">
                    <h4 class="section-header-sm">Storage Summary</h4>
                    <div class="grid-200">
                        <div class="card-box">
                            <div class="storage-summary-value stat-value-xl--blue">~190 GB</div>
                            <div class="fs-sm text-secondary">Total Data</div>
                        </div>
                        <div class="card-box">
                            <div class="storage-summary-value stat-value-xl--green">4</div>
                            <div class="fs-sm text-secondary">MariaDB/SQLite DBs</div>
                        </div>
                        <div class="card-box">
                            <div class="storage-summary-value stat-value-xl--purple">~180 GB</div>
                            <div class="fs-sm text-secondary">File Storage</div>
                        </div>
                        <div class="card-box">
                            <div class="data-stat-large">346 GB</div>
                            <div class="fs-sm text-secondary">Total Disk Capacity</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CONTAINERS VIEW - Docker containers by VM -->
        <div id="infra-containers-view" class="infra-view-content view-hidden">
            <div class="resources-category">
                <h3 class="resources-category-title">Docker Containers by VM</h3>
                <p class="text-secondary mb-3">Running containers and their configuration per VM</p>

                <!-- GCP Free Micro 1 -->
                <div class="resources-section mb-lg">
                    <h4 class="section-h4">
                        <span class="vm-header-dot vm-header-dot--gcp"></span>
                        gcp-f-micro_1 (34.55.55.234)
                        <span class="vm-specs-text">3 containers</span>
                    </h4>
                    <div class="resources-table-container">
                        <table class="resources-table fs-sm">
                            <thead>
                                <tr>
                                    <th>Container</th>
                                    <th>Image</th>
                                    <th>Ports</th>
                                    <th>Network</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>npm</strong></td>
                                    <td><code class="code-sm">jc21/nginx-proxy-manager:latest</code></td>
                                    <td><code class="code-sm">80, 443, 81</code></td>
                                    <td>proxy_network</td>
                                    <td><span class="status-badge on">UP</span></td>
                                </tr>
                                <tr>
                                    <td><strong>authelia</strong></td>
                                    <td><code class="code-sm">authelia/authelia:latest</code></td>
                                    <td><code class="code-sm">9091</code></td>
                                    <td>proxy_network</td>
                                    <td><span class="status-badge on">UP</span></td>
                                </tr>
                                <tr>
                                    <td><strong>cloud-api</strong></td>
                                    <td><code class="code-sm">python:3.11-slim</code></td>
                                    <td><code class="code-sm">5000</code></td>
                                    <td>proxy_network</td>
                                    <td><span class="status-badge on">UP</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- OCI Paid Flex 1 -->
                <div class="resources-section mb-lg">
                    <h4 class="section-h4">
                        <span class="vm-header-dot vm-header-dot--oracle"></span>
                        oci-p-flex_1 (84.235.234.87)
                        <span class="vm-specs-text">6 containers</span>
                    </h4>
                    <div class="resources-table-container">
                        <table class="resources-table fs-sm">
                            <thead>
                                <tr>
                                    <th>Container</th>
                                    <th>Image</th>
                                    <th>Ports</th>
                                    <th>Network</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>photoprism</strong></td>
                                    <td><code class="code-sm">photoprism/photoprism:latest</code></td>
                                    <td><code class="code-sm">127.0.0.1:2342</code></td>
                                    <td>dev_network</td>
                                    <td><span class="status-badge on">UP</span></td>
                                </tr>
                                <tr>
                                    <td><strong>photoprism-db</strong></td>
                                    <td><code class="code-sm">mariadb:10.11</code></td>
                                    <td><code class="fs-xs">-</code></td>
                                    <td>dev_network</td>
                                    <td><span class="status-badge on">UP</span></td>
                                </tr>
                                                                <tr>
                                    <td><strong>radicale</strong></td>
                                    <td><code class="code-sm">tomsquest/docker-radicale:latest</code></td>
                                    <td><code class="code-sm">127.0.0.1:5232</code></td>
                                    <td>dev_network</td>
                                    <td><span class="status-badge on">UP</span></td>
                                </tr>
                                <tr>
                                    <td><strong>wireguard</strong></td>
                                    <td><code class="code-sm">linuxserver/wireguard:latest</code></td>
                                    <td><code class="code-sm">51820/udp</code></td>
                                    <td>host</td>
                                    <td><span class="status-badge on">UP</span></td>
                                </tr>
                                <tr>
                                    <td><strong>redis</strong></td>
                                    <td><code class="code-sm">redis:alpine</code></td>
                                    <td><code class="fs-xs">-</code></td>
                                    <td>dev_network</td>
                                    <td><span class="status-badge on">UP</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- OCI Free Micro 1 -->
                <div class="resources-section mb-lg">
                    <h4 class="section-h4">
                        <span class="vm-header-dot vm-header-dot--oracle"></span>
                        oci-f-micro_1 (130.110.251.193)
                        <span class="vm-specs-text">8 containers</span>
                    </h4>
                    <div class="resources-table-container">
                        <table class="resources-table fs-sm">
                            <thead>
                                <tr>
                                    <th>Container</th>
                                    <th>Image</th>
                                    <th>Ports</th>
                                    <th>Network</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>mailu-front</strong></td>
                                    <td><code class="code-sm">mailu/nginx:2.0</code></td>
                                    <td><code class="code-sm">25, 465, 587, 993, 995, 143</code></td>
                                    <td>mail_network</td>
                                    <td><span class="status-badge on">UP</span></td>
                                </tr>
                                <tr>
                                    <td><strong>mailu-admin</strong></td>
                                    <td><code class="code-sm">mailu/admin:2.0</code></td>
                                    <td><code class="fs-xs">-</code></td>
                                    <td>mail_network</td>
                                    <td><span class="status-badge on">UP</span></td>
                                </tr>
                                <tr>
                                    <td><strong>mailu-imap</strong></td>
                                    <td><code class="code-sm">mailu/dovecot:2.0</code></td>
                                    <td><code class="fs-xs">-</code></td>
                                    <td>mail_network</td>
                                    <td><span class="status-badge on">UP</span></td>
                                </tr>
                                <tr>
                                    <td><strong>mailu-smtp</strong></td>
                                    <td><code class="code-sm">mailu/postfix:2.0</code></td>
                                    <td><code class="fs-xs">-</code></td>
                                    <td>mail_network</td>
                                    <td><span class="status-badge on">UP</span></td>
                                </tr>
                                <tr>
                                    <td><strong>mailu-antispam</strong></td>
                                    <td><code class="code-sm">mailu/rspamd:2.0</code></td>
                                    <td><code class="fs-xs">-</code></td>
                                    <td>mail_network</td>
                                    <td><span class="status-badge on">UP</span></td>
                                </tr>
                                <tr>
                                    <td><strong>mailu-webmail</strong></td>
                                    <td><code class="code-sm">mailu/webmail:2.0</code></td>
                                    <td><code class="fs-xs">-</code></td>
                                    <td>mail_network</td>
                                    <td><span class="status-badge on">UP</span></td>
                                </tr>
                                <tr>
                                    <td><strong>mailu-redis</strong></td>
                                    <td><code class="code-sm">redis:alpine</code></td>
                                    <td><code class="fs-xs">-</code></td>
                                    <td>mail_network</td>
                                    <td><span class="status-badge on">UP</span></td>
                                </tr>
                                <tr>
                                    <td><strong>mailu-resolver</strong></td>
                                    <td><code class="code-sm">mailu/unbound:2.0</code></td>
                                    <td><code class="fs-xs">-</code></td>
                                    <td>mail_network</td>
                                    <td><span class="status-badge on">UP</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- OCI Free Micro 2 -->
                <div class="resources-section mb-lg">
                    <h4 class="section-h4">
                        <span class="vm-header-dot vm-header-dot--oracle"></span>
                        oci-f-micro_2 (129.151.228.66)
                        <span class="vm-specs-text">2 containers</span>
                    </h4>
                    <div class="resources-table-container">
                        <table class="resources-table fs-sm">
                            <thead>
                                <tr>
                                    <th>Container</th>
                                    <th>Image</th>
                                    <th>Ports</th>
                                    <th>Network</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>matomo</strong></td>
                                    <td><code class="code-sm">matomo:fpm-alpine</code></td>
                                    <td><code class="code-sm">127.0.0.1:8080</code></td>
                                    <td>matomo_network</td>
                                    <td><span class="status-badge on">UP</span></td>
                                </tr>
                                <tr>
                                    <td><strong>matomo-db</strong></td>
                                    <td><code class="code-sm">mariadb:10.11</code></td>
                                    <td><code class="fs-xs">-</code></td>
                                    <td>matomo_network</td>
                                    <td><span class="status-badge on">UP</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Container Summary -->
                <div class="resources-section">
                    <h4 class="section-header-sm">Container Summary</h4>
                    <div class="grid-150">
                        <div class="card-box">
                            <div class="storage-summary-value stat-value-xl--green">19</div>
                            <div class="fs-sm text-secondary">Total Containers</div>
                        </div>
                        <div class="card-box">
                            <div class="storage-summary-value stat-value-xl--blue">4</div>
                            <div class="fs-sm text-secondary">Docker Networks</div>
                        </div>
                        <div class="card-box">
                            <div class="storage-summary-value stat-value-xl--purple">12</div>
                            <div class="fs-sm text-secondary">Unique Images</div>
                        </div>
                        <div class="card-box">
                            <div class="data-stat-large">4</div>
                            <div class="fs-sm text-secondary">VMs with Docker</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECURITY VIEW - Security Topology & Access Points -->
        <div id="infra-security-view" class="infra-view-content view-hidden">
            <!-- Security Layers Diagram -->
            <div class="resources-category">
                <h3 class="resources-category-title">Defense in Depth Model</h3>
                <p class="text-secondary mb-3">"Blast Radius Containment" - Assume any public-facing service can be compromised. Design so a breach cannot spread.</p>

                <div class="security-layers-diagram">
                    <!-- Layer 1: Network Edge -->
                    <div class="security-layer security-layer--red">
                        <div class="security-layer-header">
                            <div class="security-layer-badge">Layer 1</div>
                            <h4 class="security-layer-title">Network Edge</h4>
                        </div>
                        <div class="security-layer-content">
                            <div class="security-component">
                                <span class="security-dot security-dot--orange"></span>
                                <span>Oracle Cloud Security Lists</span>
                                <span class="security-tag">Firewall</span>
                            </div>
                            <div class="security-component">
                                <span class="security-dot security-dot--orange"></span>
                                <span>GCP Firewall Rules</span>
                                <span class="security-tag">Firewall</span>
                            </div>
                            <div class="security-component">
                                <span class="security-dot green"></span>
                                <span>UFW (Host Level)</span>
                                <span class="security-tag">Default: DROP</span>
                            </div>
                            <div class="security-component">
                                <span class="security-dot blue"></span>
                                <span>Fail2Ban</span>
                                <span class="security-tag">Brute Force Protection</span>
                            </div>
                        </div>
                    </div>

                    <!-- Layer 2: Traffic Routing -->
                    <div class="security-layer security-layer--orange">
                        <div class="security-layer-header">
                            <div class="security-layer-badge">Layer 2</div>
                            <h4 class="security-layer-title">Traffic Routing</h4>
                        </div>
                        <div class="security-layer-content">
                            <div class="security-component">
                                <span class="security-dot security-dot--purple"></span>
                                <span>Cloudflare DNS + DDoS</span>
                                <span class="security-tag">Edge Protection</span>
                            </div>
                            <div class="security-component">
                                <span class="security-dot green"></span>
                                <span>NPM TLS Termination</span>
                                <span class="security-tag">Let's Encrypt</span>
                            </div>
                            <div class="security-component">
                                <span class="security-dot blue"></span>
                                <span>HTTP → HTTPS Redirect</span>
                                <span class="security-tag">Forced SSL</span>
                            </div>
                            <div class="security-component">
                                <span class="security-dot security-dot--yellow"></span>
                                <span>Rate Limiting</span>
                                <span class="security-tag">Abuse Prevention</span>
                            </div>
                            <div class="security-component">
                                <span class="security-dot security-dot--cyan"></span>
                                <span>Security Headers</span>
                                <span class="security-tag">HSTS, CSP, X-Frame</span>
                            </div>
                        </div>
                    </div>

                    <!-- Layer 3: Application Isolation -->
                    <div class="security-layer security-layer--yellow">
                        <div class="security-layer-header">
                            <div class="security-layer-badge">Layer 3</div>
                            <h4 class="security-layer-title">Application Isolation</h4>
                        </div>
                        <div class="security-layer-content">
                            <div class="security-component">
                                <span class="security-dot blue"></span>
                                <span>Docker Networks</span>
                                <span class="security-tag">No Cross-Talk</span>
                            </div>
                            <div class="security-component">
                                <span class="security-dot security-dot--purple"></span>
                                <span>Container User Namespaces</span>
                                <span class="security-tag">UID Isolation</span>
                            </div>
                            <div class="security-component">
                                <span class="security-dot green"></span>
                                <span>127.0.0.1 Binding</span>
                                <span class="security-tag">UFW Bypass Prevention</span>
                            </div>
                            <div class="security-component">
                                <span class="security-dot security-dot--orange"></span>
                                <span>Resource Limits</span>
                                <span class="security-tag">CPU, Memory Caps</span>
                            </div>
                        </div>
                    </div>

                    <!-- Layer 4: Data Protection -->
                    <div class="security-layer security-layer--green">
                        <div class="security-layer-header">
                            <div class="security-layer-badge">Layer 4</div>
                            <h4 class="security-layer-title">Data Protection</h4>
                        </div>
                        <div class="security-layer-content">
                            <div class="security-component">
                                <span class="security-dot blue"></span>
                                <span>Separate Volumes per Service</span>
                                <span class="security-tag">Isolation</span>
                            </div>
                            <div class="security-component">
                                <span class="security-dot security-dot--purple"></span>
                                <span>Database per Service</span>
                                <span class="security-tag">No Shared DBs</span>
                            </div>
                            <div class="security-component">
                                <span class="security-dot green"></span>
                                <span>Encrypted Backups</span>
                                <span class="security-tag">At Rest</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Access Points -->
            <div class="resources-category mt-xl">
                <h3 class="resources-category-title">Access Points</h3>
                <div class="grid-400">

                    <!-- User Access -->
                    <div class="app-card">
                        <div class="app-card-header">
                            <div class="app-card-icon app-card-icon--blue">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                    <circle cx="12" cy="7" r="4"/>
                                </svg>
                            </div>
                            <h3 class="app-card-title">User Access</h3>
                        </div>
                        <div class="app-card-body">
                            <div class="app-card-section">
                                <h4 class="app-card-section-title">Public Services (HTTPS)</h4>
                                <ul class="app-card-list">
                                    <li><span class="app-card-dot app-card-dot--green"></span>Web Apps → Cloudflare → NPM → Service</li>
                                    <li><span class="app-card-dot app-card-dot--blue"></span>Protected Apps → + Authelia 2FA Gate</li>
                                    <li><span class="app-card-dot app-card-dot--violet"></span>Email → Webmail via SSO</li>
                                </ul>
                            </div>
                            <div class="app-card-section">
                                <h4 class="app-card-section-title">Authentication Flow</h4>
                                <ul class="app-card-list">
                                    <li><span class="app-card-dot app-card-dot--orange"></span>Password + TOTP (Authelia)</li>
                                    <li><span class="app-card-dot app-card-dot--cyan"></span>Session Cookie (*.diegonmarcos.com)</li>
                                </ul>
                            </div>
                        </div>
                        <div class="app-card-footer">
                            <span class="app-card-badge app-card-badge--blue">HTTPS Only</span>
                            <span class="app-card-status">auth.diegonmarcos.com</span>
                        </div>
                    </div>

                    <!-- Developer/Admin Access -->
                    <div class="app-card">
                        <div class="app-card-header">
                            <div class="app-card-icon app-card-icon--orange">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
                                    <line x1="8" y1="21" x2="16" y2="21"/>
                                    <line x1="12" y1="17" x2="12" y2="21"/>
                                </svg>
                            </div>
                            <h3 class="app-card-title">Developer/Admin Access</h3>
                        </div>
                        <div class="app-card-body">
                            <div class="app-card-section">
                                <h4 class="app-card-section-title">SSH Access (Key-Only)</h4>
                                <ul class="app-card-list">
                                    <li><span class="app-card-dot app-card-dot--green"></span>OCI VMs: ssh -i ~/.ssh/id_rsa ubuntu@IP</li>
                                    <li><span class="app-card-dot app-card-dot--blue"></span>GCP VMs: gcloud compute ssh arch-1</li>
                                    <li><span class="app-card-dot app-card-dot--red"></span>No Password Auth (Disabled)</li>
                                </ul>
                            </div>
                            <div class="app-card-section">
                                <h4 class="app-card-section-title">Admin Panels</h4>
                                <ul class="app-card-list">
                                    <li><span class="app-card-dot app-card-dot--violet"></span>NPM: proxy.diegonmarcos.com (2FA)</li>
                                    <li><span class="app-card-dot app-card-dot--orange"></span>Mailu Admin: mail.diegonmarcos.com/admin</li>
                                    <li><span class="app-card-dot app-card-dot--cyan"></span>Matomo: analytics.diegonmarcos.com</li>
                                </ul>
                            </div>
                        </div>
                        <div class="app-card-footer">
                            <span class="app-card-badge app-card-badge--orange">SSH + 2FA</span>
                            <span class="app-card-status">Key-based only</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Security Flow Diagram -->
            <div class="resources-category mt-xl">
                <h3 class="resources-category-title">Traffic Flow</h3>
                <div class="resources-section">
                    <div class="security-pre-container">
<pre class="security-pre">
┌─────────────────────────────────────────────────────────────────────────────┐
│                              INTERNET                                         │
│         HTTP(80) │ HTTPS(443) │ SSH(22) │ SMTP(25,465,587) │ IMAP(993)       │
└────────────────────────────────────────────────────────────────────────────-─┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                     CLOUDFLARE (DNS + DDoS + SSL)                            │
│                   *.diegonmarcos.com → Origin IPs                            │
└────────────────────────────────────────────────────────────────────────────-─┘
                                        │
            ┌───────────────────────────┼───────────────────────────┐
            ▼                           ▼                           ▼
┌───────────────────┐     ┌───────────────────┐     ┌───────────────────┐
│   OCI Firewall    │     │   GCP Firewall    │     │   OCI Firewall    │
│   (Security List) │     │   (VPC Rules)     │     │   (Security List) │
└─────────┬─────────┘     └─────────┬─────────┘     └─────────┬─────────┘
          │                         │                         │
          ▼                         ▼                         ▼
┌───────────────────┐     ┌───────────────────┐     ┌───────────────────┐
│   UFW (Host)      │     │   UFW (Host)      │     │   UFW (Host)      │
│   Default: DROP   │     │   Default: DROP   │     │   Default: DROP   │
└─────────┬─────────┘     └─────────┬─────────┘     └─────────┬─────────┘
          │                         │                         │
          ▼                         ▼                         ▼
┌───────────────────┐     ┌───────────────────┐     ┌───────────────────┐
│  oci-f-micro_1    │     │  gcp-f-micro_1    │     │  oci-f-micro_2    │
│  Mailu (Mail)     │     │  NPM + Authelia   │     │  Matomo           │
│  :443, :993, :465 │     │  :80, :443        │     │  :8080 (internal) │
└───────────────────┘     └─────────┬─────────┘     └───────────────────┘
                                    │
                          ┌─────────┴─────────┐
                          ▼                   ▼
                  ┌─────────────┐     ┌─────────────┐
                  │  Authelia   │     │  Services   │
                  │  2FA Check  │────▶│  (Docker)   │
                  │  TOTP/Pass  │     │  127.0.0.1  │
                  └─────────────┘     └─────────────┘
</pre>
                    </div>
                </div>
            </div>

            <!-- Security Checklist -->
            <div class="resources-category mt-xl">
                <h3 class="resources-category-title">Security Checklist</h3>
                <div class="resources-section">
                    <div class="resources-table-container">
                        <table class="resources-table fs-md">
                            <thead>
                                <tr>
                                    <th class="col-w-50">Security Control</th>
                                    <th class="col-w-15">Status</th>
                                    <th class="col-w-35">Notes</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>All containers bind to 127.0.0.1 or internal network</td>
                                    <td><span class="status-badge on">✓</span></td>
                                    <td>Prevents Docker UFW bypass</td>
                                </tr>
                                <tr>
                                    <td>WireGuard tunnel for cross-VM communication</td>
                                    <td><span class="status-badge on">✓</span></td>
                                    <td>GCP ↔ Oracle encrypted</td>
                                </tr>
                                <tr>
                                    <td>Authelia 2FA on sensitive services</td>
                                    <td><span class="status-badge on">✓</span></td>
                                    <td>Photoprism, admin panels</td>
                                </tr>
                                <tr>
                                    <td>UFW enabled with default deny</td>
                                    <td><span class="status-badge on">✓</span></td>
                                    <td>All VMs</td>
                                </tr>
                                <tr>
                                    <td>SSH key-only authentication</td>
                                    <td><span class="status-badge on">✓</span></td>
                                    <td>No passwords</td>
                                </tr>
                                <tr>
                                    <td>Let's Encrypt SSL on all domains</td>
                                    <td><span class="status-badge on">✓</span></td>
                                    <td>Auto-renewal via NPM</td>
                                </tr>
                                <tr>
                                    <td>Database ports never exposed publicly</td>
                                    <td><span class="status-badge on">✓</span></td>
                                    <td>Internal networks only</td>
                                </tr>
                                <tr>
                                    <td>Public DNS (Google/Cloudflare) on all VMs</td>
                                    <td><span class="status-badge on">✓</span></td>
                                    <td>Prevents ISP DNS poisoning</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        </div><!-- End Infrastructure Tab -->

    </div>

    <!-- Load local data as fallback (generated by c3/in-house converters) -->
    <script src="./monitor.js"></script>
    <script src="./costs.js"></script>
    <script src="./availability.js"></script>
    <script src="./security.js"></script>
    <script src="./performance.js"></script>
    <script src="./docker.js"></script>
    <script src="./web.js"></script>

    <!-- Adapter: Map exported variable names to what the code expects -->
    <script>
        // Map COSTS to CLOUD_COSTS_DATA format expected by the code
        if (typeof COSTS !== 'undefined') {
            window.CLOUD_COSTS_DATA = {
                lastUpdated: COSTS.date,
                gcp: COSTS.gcp || {},
                oci: COSTS.oci || {},
                totals: COSTS.summary || {},
                providers: { gcp: COSTS.gcp, oci: COSTS.oci }
            };
            // Also map AI costs from COSTS.claude
            if (COSTS.claude) {
                window.AI_COSTS_DATA = COSTS.claude;
            }
        }
        // Map additional monitoring data to window for easy access
        if (typeof AVAILABILITY !== 'undefined') window.AVAILABILITY_DATA = AVAILABILITY;
        if (typeof SECURITY !== 'undefined') window.SECURITY_DATA = SECURITY;
        if (typeof PERFORMANCE !== 'undefined') window.PERFORMANCE_DATA = PERFORMANCE;
        if (typeof DOCKER !== 'undefined') window.DOCKER_DATA = DOCKER;
        if (typeof WEB !== 'undefined') window.WEB_DATA = WEB;
    </script>

    <script>
        // =================================================================
        // CONFIGURATION
        // =================================================================
        const apiUrl = 'http://34.55.55.234:5000/api';
        const GITHUB_CLIENT_ID = 'Ov23liOg9JhezyYUCHmS';
        const GITHUB_REDIRECT_URI = window.location.href.split('?')[0];

        // =================================================================
        // STATE
        // =================================================================
        const isGitHubPages = window.location.hostname.includes('github.io');
        let autoRefreshInterval = null;
        let isLoading = false;
        let isLoggedIn = false;
        let githubUser = null;

        // =================================================================
        // DATA SOURCE: Try API first, fallback to local .js files
        // =================================================================

        // Static fallback infrastructure data (used when API is offline)
        const FALLBACK_INFRASTRUCTURE = {
            providers: {
                oracle: { id: 'oracle', name: 'Oracle Cloud', consoleUrl: 'https://cloud.oracle.com' },
                gcloud: { id: 'gcloud', name: 'Google Cloud', consoleUrl: 'https://console.cloud.google.com' }
            },
            virtualMachines: {
                'oci-f-micro_1': {
                    id: 'oci-f-micro_1', name: 'OCI Free Micro 1', provider: 'oracle', status: 'active',
                    network: { publicIp: '130.110.251.193' },
                    os: { name: 'Ubuntu', version: '24.04 LTS' },
                    ssh: { user: 'ubuntu', command: 'ssh -i ~/.ssh/id_rsa ubuntu@130.110.251.193' },
                    ociInstanceId: 'ocid1.instance.oc1.eu-marseille-1.anwxeljruadvczacbwylmkqr253ay7binepapgsyopllfayovkzaky6oigbq'
                },
                'oci-f-micro_2': {
                    id: 'oci-f-micro_2', name: 'OCI Free Micro 2', provider: 'oracle', status: 'active',
                    network: { publicIp: '129.151.228.66' },
                    os: { name: 'Ubuntu', version: '24.04 LTS' },
                    ssh: { user: 'ubuntu', command: 'ssh -i ~/.ssh/id_rsa ubuntu@129.151.228.66' },
                    ociInstanceId: 'ocid1.instance.oc1.eu-marseille-1.anwxeljruadvczacgwg5rkrjyomuxvjtvtuk5xrbmy7hmslwn4pse4kw5jkq'
                },
                'gcp-f-micro_1': {
                    id: 'gcp-f-micro_1', name: 'GCP Arch 1', provider: 'gcloud', status: 'active',
                    network: { publicIp: '34.55.55.234' },
                    os: { name: 'Arch Linux', version: 'rolling' },
                    ssh: { user: 'diego', command: 'gcloud compute ssh arch-1 --zone us-central1-a' }
                },
                'oci-p-flex_1': {
                    id: 'oci-p-flex_1', name: 'OCI Paid Flex 1', provider: 'oracle', status: 'active',
                    network: { publicIp: '84.235.234.87' },
                    os: { name: 'Ubuntu', version: '22.04 Minimal' },
                    ssh: { user: 'ubuntu', command: 'ssh -i ~/.ssh/id_rsa ubuntu@84.235.234.87' },
                    ociInstanceId: 'ocid1.instance.oc1.eu-marseille-1.anwxeljruadvczachwpa3qrh7n25vfez3smidz4o7gpmtj4ga4d7zqlja5yq'
                }
            },
            services: {
                'npm-gcloud': { id: 'npm-gcloud', name: 'NPM', displayName: 'Nginx Proxy Manager', vmId: 'gcp-f-micro_1', status: 'on', urls: { gui: 'https://proxy.diegonmarcos.com' }, network: { port: 81 }, description: 'Central reverse proxy' },
                'authelia': { id: 'authelia', name: 'Authelia', displayName: 'Authelia 2FA', vmId: 'gcp-f-micro_1', status: 'on', urls: { gui: 'https://auth.diegonmarcos.com' }, network: { port: 9091 }, description: 'Authentication portal' },
                'matomo-app': { id: 'matomo-app', name: 'Matomo', displayName: 'Matomo Analytics', vmId: 'oci-f-micro_2', status: 'on', urls: { gui: 'https://analytics.diegonmarcos.com' }, network: { port: 8080 }, description: 'Privacy-focused analytics' },
                'mail-app': { id: 'mail-app', name: 'Mailu', displayName: 'Mailu Mail', vmId: 'oci-f-micro_1', status: 'on', urls: { gui: 'https://mail.diegonmarcos.com' }, network: { port: 443 }, description: 'Email server suite' },
                'calendar-app': { id: 'calendar-app', name: 'Radicale', displayName: 'Calendar', vmId: 'oci-p-flex_1', status: 'on', urls: { gui: 'https://cal.diegonmarcos.com' }, network: { port: 5232 }, description: 'CalDAV/CardDAV server' },
                                'photoprism-app': { id: 'photoprism-app', name: 'PhotoPrism', displayName: 'Photo Gallery', vmId: 'oci-p-flex_1', status: 'on', urls: { gui: 'https://photos.diegonmarcos.com' }, network: { port: 2342 }, description: 'AI-powered photo management' },
                'cloud-app': { id: 'cloud-app', name: 'Cloud API', displayName: 'Cloud Control API', vmId: 'gcp-f-micro_1', status: 'on', urls: { api: 'https://api.diegonmarcos.com' }, network: { port: 5000 }, description: 'Infrastructure API' },
                'wireguard': { id: 'wireguard', name: 'WireGuard', displayName: 'WireGuard VPN', vmId: 'gcp-f-micro_1', status: 'on', urls: {}, network: { port: 51820 }, description: 'VPN mesh hub (OS-native)' }
            }
        };

        // =================================================================
        // RENDER TABLES FROM INFRASTRUCTURE DATA (JSON is source of truth!)
        // =================================================================
        function renderTablesFromConfig() {
            // Use INFRASTRUCTURE if available, fallback to CONFIG, then FALLBACK_INFRASTRUCTURE
            let DATA = (typeof INFRASTRUCTURE !== 'undefined') ? INFRASTRUCTURE : (typeof CONFIG !== 'undefined') ? CONFIG : null;

            if (!DATA) {
                console.warn('INFRASTRUCTURE/CONFIG not loaded from API, using static fallback');
                DATA = FALLBACK_INFRASTRUCTURE;
                window.CONFIG = DATA; // Make it available globally
            }

            if (!DATA) {
                console.error('No infrastructure data available');
                return;
            }

            // Transform INFRASTRUCTURE format (arrays) to CONFIG format (objects keyed by ID)
            // INFRASTRUCTURE has: vms[], services[]
            // CONFIG expects: virtualMachines{}, services{}
            if (DATA.vms && Array.isArray(DATA.vms)) {
                DATA.virtualMachines = {};
                DATA.vms.forEach(vm => {
                    DATA.virtualMachines[vm.id] = vm;
                });
                console.log('Transformed vms[] to virtualMachines{}:', Object.keys(DATA.virtualMachines));
            }
            if (DATA.services && Array.isArray(DATA.services)) {
                const servicesObj = {};
                DATA.services.forEach(svc => {
                    servicesObj[svc.id] = svc;
                });
                DATA.services = servicesObj;
                console.log('Transformed services[] to services{}:', Object.keys(DATA.services));
            }

            // For convenience, also expose as CONFIG
            window.CONFIG = DATA;

            // ===== RENDER VMs TABLE =====
            const vmsTbody = document.getElementById('vms-tbody');
            if (vmsTbody) {
                vmsTbody.innerHTML = '';
                Object.values(CONFIG.virtualMachines || {}).forEach(vm => {
                    const statusBadge = vm.status === 'active' ? 'on' : vm.status === 'pending' ? 'tbd' : vm.status === 'hold' ? 'hold' : 'dev';
                    const provider = CONFIG.providers?.[vm.provider];
                    const hostName = provider?.name || vm.provider || 'Unknown';
                    const ip = vm.network?.publicIp || 'pending';

                    // Actions column with SSH copy and URL open buttons
                    const sshCommand = vm.ssh?.command || `ssh ${vm.ssh?.user || 'root'}@${ip}`;
                    const consoleUrl = vm.ociInstanceId ? `https://cloud.oracle.com/compute/instances/${vm.ociInstanceId}` : (provider?.consoleUrl || '');

                    vmsTbody.innerHTML += `
                        <tr class="vm-row">
                            <td><span class="status-badge ${statusBadge}">${statusBadge.toUpperCase()}</span></td>
                            <td>${hostName}</td>
                            <td><strong>${vm.name}</strong></td>
                            <td><code class="ip-address">${ip}</code></td>
                            <td><span class="live-status checking" data-vm="${vm.id}"><span class="live-dot"></span>Checking...</span></td>
                            <td>
                                <div class="vm-actions-inline">
                                    <button class="vm-action-btn btn-ssh" onclick="copyToClipboard('${sshCommand.replace(/'/g, "\\'")}', 'SSH command copied!')" title="Copy SSH command">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                                        </svg>
                                    </button>
                                    <button class="vm-action-btn btn-url" onclick="window.open('${consoleUrl}', '_blank')" ${!consoleUrl ? 'disabled' : ''} title="Open cloud console">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                                            <polyline points="15 3 21 3 21 9"/>
                                            <line x1="10" y1="14" x2="21" y2="3"/>
                                        </svg>
                                    </button>
                                    <button class="vm-action-btn btn-reset" data-vm-reset="${vm.id}" onclick="resetVM('${vm.id}')" title="Reset VM (reboot if running, start if stopped)">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M23 4v6h-6M1 20v-6h6"/>
                                            <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                                        </svg>
                                    </button>
                                </div>
                            </td>
                        </tr>`;
                });
            }

            // ===== RENDER SERVICES TABLE (UNIFIED HIERARCHICAL) =====
            const servicesTbody = document.getElementById('services-tbody');
            const backlogTbody = document.getElementById('backlog-tbody');

            if (servicesTbody && backlogTbody) {
                servicesTbody.innerHTML = '';
                backlogTbody.innerHTML = '';

                // Get all parent services (those without parentService property)
                const parentServices = Object.values(CONFIG.services || {})
                    .filter(svc => !svc.parentService);

                parentServices.forEach(parent => {
                    // Skip if DEV/HOLD - goes to backlog
                    if (parent.status === 'dev' || parent.status === 'hold') {
                        const vm = CONFIG.virtualMachines?.[parent.vmId];
                        backlogTbody.innerHTML += `
                            <tr>
                                <td><strong>${parent.displayName || parent.name}</strong></td>
                                <td><span class="status-badge ${parent.status}">${parent.status.toUpperCase()}</span></td>
                                <td>${vm?.name || 'TBD'}</td>
                                <td>${parent.notes || '-'}</td>
                            </tr>
                        `;
                        return;
                    }

                    // Get child services
                    const children = Object.values(CONFIG.services || {})
                        .filter(svc => svc.parentService === parent.id);

                    const vm = CONFIG.virtualMachines?.[parent.vmId];
                    const vmName = vm?.name || '-';

                    // Find the NPM proxy serving this service
                    const npmService = Object.values(CONFIG.services || {})
                        .find(svc => svc.vmId === vm?.id && svc.id.includes('npm'));
                    const proxyName = npmService?.displayName || npmService?.name || '-';

                    const url = parent.urls?.gui || parent.urls?.api || parent.network?.domain || '-';
                    const ip = vm?.network?.publicIp || '-';

                    // Parent row
                    const appChild = children.find(c => c.id.endsWith('-app'));
                    const statusServiceId = appChild?.id || parent.id;

                    servicesTbody.innerHTML += `
                        <tr class="service-parent-row">
                            <td><strong>${vmName}</strong></td>
                            <td><strong>${parent.displayName || parent.name}</strong></td>
                            <td>${url !== '-' ? `<a href="${url}" target="_blank" style="color: var(--accent-blue)">${url}</a>` : '-'}</td>
                            <td>-</td>
                            <td>${proxyName}</td>
                            <td><span class="live-status checking" data-service="${statusServiceId}"><span class="live-dot"></span>Checking...</span></td>
                        </tr>
                    `;

                    // Child rows (indented)
                    children.forEach(child => {
                        const port = child.network?.proxyAddress?.split(':')[1] || '-';
                        const ipPort = port !== '-' ? `${ip}:${port}` : '-';

                        servicesTbody.innerHTML += `
                            <tr class="service-child-row">
                                <td></td>
                                <td class="child-service-name">↳ ${child.displayName || child.name}</td>
                                <td>-</td>
                                <td><code>${ipPort}</code></td>
                                <td>-</td>
                                <td><span class="status-badge ${child.status}">${child.status.toUpperCase()}</span></td>
                            </tr>
                        `;
                    });
                });
            }

            console.log('Tables rendered from CONFIG');
        }

        function copyToClipboard(text, message) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification(message || 'Copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy:', err);
            });
        }

        // =================================================================
        // REFRESH FUNCTION
        // Single mode: Try API first, fallback to local .js files on error
        // =================================================================
        function refreshAll() {
            fetchFromAPI();  // Always try API first, falls back to local on error
        }

        function fetchFromLocal() {
            console.log('fetchFromLocal() called');
            const connectionStatus = document.getElementById('connection-status');
            connectionStatus.classList.add('disconnected');

            if (typeof MONITOR === 'undefined') {
                console.error('MONITOR not loaded - monitor.js missing');
                document.getElementById('last-updated').textContent = 'No local data';
                return;
            }

            console.log('MONITOR loaded:', MONITOR);

            // MONITOR already has the correct format matching the API response
            // Format: { vms: [{category, vms: [{id, status}]}], services: [{category, services: [{id, health_status}]}] }
            const data = MONITOR;

            console.log('Data for updateDashboard:', JSON.stringify(data, null, 2));
            try {
                updateDashboard(data);
            } catch (e) {
                console.error('updateDashboard ERROR:', e);
            }
            // Show timestamp from MONITOR data if available
            const timestamp = MONITOR.timestamp || new Date().toLocaleTimeString();
            document.getElementById('last-updated').textContent = timestamp + ' (local)';
            console.log('fetchFromLocal() completed');
        }

        // Fetch full config from API and render tables (for API mode without local JS file)
        async function fetchConfigFromAPI() {
            try {
                const response = await fetch(`${apiUrl}/cloud_control/infrastructure`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                const data = await response.json();
                // Map API response to match INFRASTRUCTURE format
                window.INFRASTRUCTURE = data;
                window.CONFIG = data; // Keep for backwards compatibility
                renderTablesFromConfig();
            } catch (error) {
                console.error('Failed to fetch infrastructure from API:', error);
            }
        }

        async function fetchFromAPI() {
            if (isLoading) return;
            isLoading = true;

            const refreshBtn = document.getElementById('refresh-btn');
            const connectionStatus = document.getElementById('connection-status');
            refreshBtn.classList.add('loading');

            try {
                const response = await fetch(`${apiUrl}/cloud_control/monitor`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                const apiData = await response.json();

                // API already returns data in the correct format for updateDashboard()
                // Format: { vms: [{category, vms: [{id, status}]}], services: [{category, services: [{id, health_status}]}] }
                connectionStatus.classList.remove('disconnected');
                updateDashboard(apiData);
                document.getElementById('last-updated').textContent = new Date().toLocaleTimeString();
            } catch (error) {
                console.error('API Error:', error);
                console.log('Falling back to local .js files...');
                connectionStatus.classList.add('disconnected');
                // Fallback to local data on API error
                fetchFromLocal();
            } finally {
                refreshBtn.classList.remove('loading');
                isLoading = false;
            }
        }

        function updateDashboard(data) {
            console.log('updateDashboard() called with', data.vms[0]?.vms?.length, 'VMs and', data.services[0]?.services?.length, 'services');

            // Update VM statuses
            data.vms.forEach(cat => {
                cat.vms.forEach(vm => {
                    const el = document.querySelector(`[data-vm="${vm.id}"]`);
                    console.log(`VM ${vm.id}: element found = ${!!el}, status = ${vm.status}`);
                    if (el) {
                        const status = vm.status.toLowerCase().replace(' ', '-');
                        const statusMap = {
                            'online': { class: 'online', label: 'Online' },
                            'offline': { class: 'offline', label: 'Offline' },
                            'dormant': { class: 'dormant', label: 'Dormant' },
                            'no-ssh': { class: 'pending', label: 'No SSH' },
                            'pending': { class: 'pending', label: 'Pending' },
                            'hold': { class: 'hold', label: 'Hold' },
                            'tbd': { class: 'pending', label: 'TBD' },
                            'unknown': { class: 'pending', label: 'Unknown' }
                        };
                        const s = statusMap[status] || { class: 'checking', label: vm.status };
                        el.className = 'live-status ' + s.class;
                        el.innerHTML = `<span class="live-dot"></span>${s.label}`;
                    }
                });
            });

            // Update Service statuses
            data.services.forEach(cat => {
                cat.services.forEach(svc => {
                    const el = document.querySelector(`[data-service="${svc.id}"]`);
                    console.log(`Service ${svc.id}: element found = ${!!el}, status = ${svc.health_status}`);
                    if (el) {
                        const statusMap = {
                            'healthy': { class: 'online', label: 'Healthy' },
                            'error': { class: 'offline', label: 'Error' },
                            'development': { class: 'dev', label: 'Dev' },
                            'hold': { class: 'hold', label: 'Hold' },
                            'tbd': { class: 'pending', label: 'TBD' },
                            'no_url': { class: 'pending', label: 'N/A' }
                        };
                        const s = statusMap[svc.health_status] || { class: 'checking', label: svc.health_status };
                        el.className = 'live-status ' + s.class;
                        el.innerHTML = `<span class="live-dot"></span>${s.label}`;
                    }
                });
            });
            console.log('updateDashboard() completed');
        }

        // =================================================================
        // AUTO-REFRESH
        // API mode: fetch every 30s
        // Local mode: reload page every 30s
        // =================================================================
        function initAutoRefresh() {
            const autoRefreshEl = document.getElementById('auto-refresh');
            if (autoRefreshEl) {
                autoRefreshEl.addEventListener('change', function() {
                    if (this.checked) {
                        autoRefreshInterval = setInterval(refreshAll, 30000);
                    } else {
                        clearInterval(autoRefreshInterval);
                        autoRefreshInterval = null;
                    }
                });
            }
        }


        // =================================================================
        // GitHub OAuth Functions
        // =================================================================
        function handleGitHubLogin() {
            if (isLoggedIn) {
                // Logout
                logout();
            } else {
                // Login - redirect to GitHub OAuth
                const authUrl = `https://github.com/login/oauth/authorize?client_id=${GITHUB_CLIENT_ID}&redirect_uri=${encodeURIComponent(GITHUB_REDIRECT_URI)}&scope=read:user`;
                window.location.href = authUrl;
            }
        }

        function logout() {
            isLoggedIn = false;
            githubUser = null;
            localStorage.removeItem('github_token');
            localStorage.removeItem('github_user');
            updateLoginUI();
            updateRebootButtons();
        }

        function updateLoginUI() {
            const btn = document.getElementById('github-login-btn');
            const text = document.getElementById('github-login-text');

            if (isLoggedIn && githubUser) {
                btn.classList.add('logged-in');
                btn.innerHTML = `
                    <img src="${githubUser.avatar_url}" alt="" class="user-avatar">
                    <span>${githubUser.login}</span>
                    <button class="logout-btn" onclick="event.stopPropagation(); logout();">Logout</button>
                `;
            } else {
                btn.classList.remove('logged-in');
                btn.innerHTML = `
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/>
                    </svg>
                    <span>Login</span>
                `;
            }
        }

        function updateRebootButtons() {
            const buttons = document.querySelectorAll('.reboot-btn');
            buttons.forEach(btn => {
                if (isLoggedIn) {
                    btn.disabled = false;
                    btn.classList.add('enabled');
                } else {
                    btn.disabled = true;
                    btn.classList.remove('enabled');
                }
            });
        }

        async function handleOAuthCallback() {
            // Check for error in URL
            const urlParams = new URLSearchParams(window.location.search);
            const error = urlParams.get('error');

            if (error) {
                window.history.replaceState({}, document.title, window.location.pathname);
                alert('GitHub login failed: ' + error);
                return;
            }

            // The backend callback already stored token in localStorage via JavaScript redirect
            // Just clean up the URL if there's a code param (shouldn't happen but just in case)
            const code = urlParams.get('code');
            if (code) {
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        }

        function checkExistingLogin() {
            const token = localStorage.getItem('github_token');
            const user = localStorage.getItem('github_user');

            if (token && user) {
                try {
                    githubUser = JSON.parse(user);
                    isLoggedIn = true;
                    updateLoginUI();
                    updateRebootButtons();
                } catch (e) {
                    logout();
                }
            }
        }

        // Reboot VM function
        async function rebootVM(vmId) {
            if (!isLoggedIn) {
                alert('Please login with GitHub to reboot VMs');
                return;
            }

            const btn = document.querySelector(`[data-vm-reboot="${vmId}"]`);
            if (!btn || btn.classList.contains('loading')) return;

            if (!confirm(`Are you sure you want to reboot ${vmId}?`)) return;

            btn.classList.add('loading');
            btn.disabled = true;

            try {
                const token = localStorage.getItem('github_token');
                const response = await fetch(`${apiUrl}/vms/${vmId}/reboot`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    btn.classList.remove('loading');
                    btn.classList.add('success');
                    btn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>Rebooting`;

                    setTimeout(() => {
                        btn.classList.remove('success');
                        btn.classList.add('enabled');
                        btn.disabled = false;
                        btn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>Reboot`;
                    }, 3000);
                } else {
                    throw new Error(await response.text());
                }
            } catch (error) {
                console.error('Reboot error:', error);
                alert(`Reboot failed: ${error.message}`);
                btn.classList.remove('loading');
                btn.disabled = false;
            }
        }

        // Add click handlers to reboot buttons
        function initRebootButtons() {
            document.querySelectorAll('.reboot-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const vmId = btn.getAttribute('data-vm-reboot');
                    if (vmId) rebootVM(vmId);
                });
            });
        }

        // Reset VM function (reboot if running, start if stopped)
        async function resetVM(vmId) {
            if (!isLoggedIn) {
                alert('Please login with GitHub to reset VMs');
                return;
            }

            const btn = document.querySelector(`[data-vm-reset="${vmId}"]`);
            if (!btn || btn.classList.contains('loading')) return;

            if (!confirm(`Reset ${vmId}?\n\nThis will reboot if running, or start if stopped.`)) return;

            btn.classList.add('loading');

            try {
                const token = localStorage.getItem('github_token');
                const response = await fetch(`${apiUrl}/vms/${vmId}/reset`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (response.ok) {
                    btn.classList.remove('loading');
                    btn.classList.add('success');

                    // Show appropriate message based on action taken
                    const action = data.action || 'reset';
                    setTimeout(() => {
                        btn.classList.remove('success');
                        alert(`VM ${vmId}: ${action === 'started' ? 'Starting up...' : 'Rebooting...'}`);
                    }, 500);
                } else {
                    throw new Error(data.error || 'Reset failed');
                }
            } catch (error) {
                console.error('Reset error:', error);
                alert(`Reset failed: ${error.message}`);
                btn.classList.remove('loading');
            }
        }

        // Shutdown VM function (stop VM)
        async function shutdownVM(vmId) {
            if (!isLoggedIn) {
                alert('Please login with GitHub to shutdown VMs');
                return;
            }

            const btn = document.querySelector(`[onclick*="shutdownVM('${vmId}')"]`);
            if (!btn || btn.classList.contains('loading')) return;

            if (!confirm(`Shutdown ${vmId}?\n\nThis will stop the VM.`)) return;

            btn.classList.add('loading');

            try {
                const token = localStorage.getItem('github_token');
                const response = await fetch(`${apiUrl}/vms/${vmId}/stop`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (response.ok) {
                    btn.classList.remove('loading');
                    btn.classList.add('success');
                    setTimeout(() => {
                        btn.classList.remove('success');
                        alert(`VM ${vmId}: Shutting down...`);
                    }, 500);
                } else {
                    throw new Error(data.error || 'Shutdown failed');
                }
            } catch (error) {
                console.error('Shutdown error:', error);
                alert(`Shutdown failed: ${error.message}`);
                btn.classList.remove('loading');
            }
        }

        // Restart container function
        async function restartContainer(vmId, containerName) {
            if (!isLoggedIn) {
                alert('Please login with GitHub to restart containers');
                return;
            }

            const btn = event.target.closest('.vm-action-btn');
            if (!btn || btn.classList.contains('loading')) return;

            if (!confirm(`Restart container "${containerName}" on ${vmId}?`)) return;

            btn.classList.add('loading');

            try {
                const token = localStorage.getItem('github_token');
                const response = await fetch(`${apiUrl}/vms/${vmId}/containers/${containerName}/restart`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (response.ok) {
                    btn.classList.remove('loading');
                    btn.classList.add('success');
                    setTimeout(() => {
                        btn.classList.remove('success');
                        alert(`Container ${containerName} restarted successfully`);
                    }, 500);
                } else {
                    throw new Error(data.error || 'Restart failed');
                }
            } catch (error) {
                console.error('Container restart error:', error);
                alert(`Restart failed: ${error.message}`);
                btn.classList.remove('loading');
            }
        }

        // ============================================
        // WAKE-ON-DEMAND FUNCTIONS (uses Cloud Control API)
        // VM: oci-p-flex_1 (Photoprism/Syncthing/Radicale server)
        // ============================================
        const WAKE_VM_ID = 'oci-p-flex_1';

        async function checkDevServerStatus() {
            try {
                const resp = await fetch(`${apiUrl}/vms/${WAKE_VM_ID}/status`);
                const data = await resp.json();

                const statusEl = document.getElementById('dev-server-status');
                const textEl = document.getElementById('dev-server-status-text');
                const wakeBtn = document.getElementById('wake-dev-btn');

                // API returns state from OCI: RUNNING, STOPPED, STARTING, STOPPING, etc.
                const state = data.state || data.status || 'UNKNOWN';

                if (state === 'RUNNING') {
                    statusEl.className = 'live-status online';
                    textEl.textContent = 'Running';
                    wakeBtn.disabled = true;
                    wakeBtn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>Running';
                } else if (state === 'STOPPED') {
                    statusEl.className = 'live-status offline';
                    textEl.textContent = 'Sleeping';
                    wakeBtn.disabled = false;
                    wakeBtn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>Wake';
                } else if (state === 'STARTING') {
                    statusEl.className = 'live-status checking';
                    textEl.textContent = 'Starting...';
                    wakeBtn.disabled = true;
                    wakeBtn.innerHTML = '<span class="spinner"></span> Starting...';
                } else if (state === 'STOPPING') {
                    statusEl.className = 'live-status checking';
                    textEl.textContent = 'Stopping...';
                    wakeBtn.disabled = true;
                } else {
                    statusEl.className = 'live-status checking';
                    textEl.textContent = state;
                }
            } catch (e) {
                console.error('Failed to check dev server status:', e);
            }
        }

        async function wakeDevServer() {
            const wakeBtn = document.getElementById('wake-dev-btn');
            const statusEl = document.getElementById('dev-server-status');
            const textEl = document.getElementById('dev-server-status-text');

            wakeBtn.disabled = true;
            wakeBtn.innerHTML = '<span class="spinner"></span> Waking...';
            statusEl.className = 'live-status checking';
            textEl.textContent = 'Starting VM...';

            try {
                const token = localStorage.getItem('github_token');
                const headers = { 'Content-Type': 'application/json' };
                if (token) headers['Authorization'] = `Bearer ${token}`;

                const resp = await fetch(`${apiUrl}/vms/${WAKE_VM_ID}/start`, {
                    method: 'POST',
                    headers: headers
                });
                const data = await resp.json();

                if (resp.ok || data.success) {
                    textEl.textContent = 'VM Starting...';
                    // Poll for running status
                    let attempts = 0;
                    const maxAttempts = 24; // 2 minutes (24 * 5s)

                    const checkInterval = setInterval(async () => {
                        attempts++;
                        textEl.textContent = `Starting... (${attempts * 5}s)`;

                        try {
                            const statusResp = await fetch(`${apiUrl}/vms/${WAKE_VM_ID}/status`);
                            const statusData = await statusResp.json();
                            const state = statusData.state || statusData.status;

                            if (state === 'RUNNING') {
                                clearInterval(checkInterval);
                                statusEl.className = 'live-status online';
                                textEl.textContent = 'Running';
                                wakeBtn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>Running';
                            } else if (attempts >= maxAttempts) {
                                clearInterval(checkInterval);
                                statusEl.className = 'live-status checking';
                                textEl.textContent = 'Timeout';
                                wakeBtn.disabled = false;
                                wakeBtn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>Wake';
                            }
                        } catch (pollError) {
                            console.error('Poll error:', pollError);
                        }
                    }, 5000);
                } else {
                    throw new Error(data.error || data.message || 'Start failed');
                }
            } catch (e) {
                console.error('Failed to wake dev server:', e);
                alert(`Failed to start VM: ${e.message}`);
                wakeBtn.disabled = false;
                wakeBtn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>Wake';
                statusEl.className = 'live-status offline';
                textEl.textContent = 'Sleeping';
            }
        }

        // ============================================
        // COST TAB FUNCTIONS
        // ============================================

        async function loadCostData() {
            // Use CCUSAGE_DATA if available (local JSON export)
            if (typeof CCUSAGE_DATA !== 'undefined') {
                loadCostDataFromCcusage();
                return;
            }
            // Fallback to API
            try {
                const [aiDailyResp, aiMonthlyResp] = await Promise.all([
                    fetch(`${apiUrl}/costs/ai/daily`),
                    fetch(`${apiUrl}/costs/ai/monthly`)
                ]);
                const aiDailyData = await aiDailyResp.json();
                const aiMonthlyData = await aiMonthlyResp.json();
                if (!aiDailyData.error && Array.isArray(aiDailyData)) updateDailyTable(aiDailyData);
                if (!aiMonthlyData.error && Array.isArray(aiMonthlyData)) updateMonthlyTable(aiMonthlyData);
            } catch (error) {
                console.error('Error loading cost data:', error);
            }
        }

        function loadCostDataFromCcusage() {
            const data = CCUSAGE_DATA;

            // Update hero section totals
            const heroValue = document.querySelector('.ai-cost-hero-value');
            if (heroValue) heroValue.textContent = `$${data.totals.totalCost.toFixed(2)}`;

            // Update hero cards
            const today = data.daily[0];
            const thisMonth = data.monthly[0];
            const lastMonth = data.monthly[1];

            updateHeroCards(today, thisMonth, lastMonth);
            updateDonutChart(data.modelStats, data.totals.totalCost);
            updateTokenStats(data.totals);
            updateDailyBarChart(data.daily.slice(0, 14));
            updateWeeklyBars(data.weekly);
            updateSessionList(data.sessions);
            updateDailyTableFromCcusage(data.daily.slice(0, 14));
            updateMonthlyTableFromCcusage(data.monthly);

            // Also load cloud infrastructure costs
            if (typeof CLOUD_COSTS_DATA !== 'undefined') {
                loadCloudCostsData();
            }
        }

        function updateHeroCards(today, thisMonth, lastMonth) {
            const cards = document.querySelectorAll('.ai-cost-card');
            if (cards[0]) {
                cards[0].querySelector('.ai-cost-card-value').textContent = `$${today?.totalCost?.toFixed(2) || '0.00'}`;
            }
            if (cards[1]) {
                cards[1].querySelector('.ai-cost-card-value').textContent = `$${thisMonth?.totalCost?.toFixed(2) || '0.00'}`;
            }
            if (cards[2] && lastMonth) {
                cards[2].querySelector('.ai-cost-card-value').textContent = `$${lastMonth?.totalCost?.toFixed(2) || '0.00'}`;
            }
            if (cards[3]) {
                const avgDaily = thisMonth ? (thisMonth.totalCost / new Date().getDate()) : 0;
                cards[3].querySelector('.ai-cost-card-value').textContent = `$${avgDaily.toFixed(2)}`;
            }
        }

        function updateDonutChart(modelStats, total) {
            // Update SVG donut segments
            const circumference = 251; // 2 * PI * 40
            let offset = 0;

            const opus = modelStats['claude-opus-4-5-20251101'];
            const sonnet = modelStats['claude-sonnet-4-5-20250929'];
            const haiku = modelStats['claude-haiku-4-5-20251001'];

            const opusPct = opus ? opus.percentOfTotal / 100 : 0;
            const sonnetPct = sonnet ? sonnet.percentOfTotal / 100 : 0;
            const haikuPct = haiku ? haiku.percentOfTotal / 100 : 0;

            const opusCircle = document.querySelector('.ai-donut-opus');
            const sonnetCircle = document.querySelector('.ai-donut-sonnet');
            const haikuCircle = document.querySelector('.ai-donut-haiku');

            if (opusCircle) {
                opusCircle.setAttribute('stroke-dasharray', `${opusPct * circumference} ${circumference}`);
                opusCircle.setAttribute('stroke-dashoffset', `${-offset}`);
                offset += opusPct * circumference;
            }
            if (sonnetCircle) {
                sonnetCircle.setAttribute('stroke-dasharray', `${sonnetPct * circumference} ${circumference}`);
                sonnetCircle.setAttribute('stroke-dashoffset', `${-offset}`);
                offset += sonnetPct * circumference;
            }
            if (haikuCircle) {
                haikuCircle.setAttribute('stroke-dasharray', `${haikuPct * circumference} ${circumference}`);
                haikuCircle.setAttribute('stroke-dashoffset', `${-offset}`);
            }

            // Update center
            const centerValue = document.querySelector('.ai-donut-value');
            if (centerValue) centerValue.textContent = `$${total.toFixed(0)}`;

            // Update legend
            const legendItems = document.querySelectorAll('.ai-donut-legend-item');
            if (legendItems[0] && opus) {
                legendItems[0].querySelector('.ai-donut-legend-value').textContent = `$${opus.totalCost.toFixed(2)}`;
                legendItems[0].querySelector('.ai-donut-legend-pct').textContent = `${opus.percentOfTotal.toFixed(1)}%`;
            }
            if (legendItems[1] && sonnet) {
                legendItems[1].querySelector('.ai-donut-legend-value').textContent = `$${sonnet.totalCost.toFixed(2)}`;
                legendItems[1].querySelector('.ai-donut-legend-pct').textContent = `${sonnet.percentOfTotal.toFixed(1)}%`;
            }
            if (legendItems[2] && haiku) {
                legendItems[2].querySelector('.ai-donut-legend-value').textContent = `$${haiku.totalCost.toFixed(2)}`;
                legendItems[2].querySelector('.ai-donut-legend-pct').textContent = `${haiku.percentOfTotal.toFixed(1)}%`;
            }
        }

        function updateTokenStats(totals) {
            const formatTokens = (n) => {
                if (n >= 1e9) return (n / 1e9).toFixed(2) + 'B';
                if (n >= 1e6) return (n / 1e6).toFixed(2) + 'M';
                if (n >= 1e3) return (n / 1e3).toFixed(2) + 'K';
                return n.toString();
            };

            const total = totals.totalTokens || 1;
            const inputPct = (totals.inputTokens / total) * 100;
            const outputPct = (totals.outputTokens / total) * 100;
            const cacheCreatePct = (totals.cacheCreationTokens / total) * 100;
            const cacheReadPct = (totals.cacheReadTokens / total) * 100;

            const tokenCards = document.querySelectorAll('.ai-token-card');
            if (tokenCards[0]) {
                tokenCards[0].querySelector('.ai-token-value').textContent = formatTokens(totals.inputTokens);
                tokenCards[0].querySelector('.ai-token-bar-fill').style.width = `${Math.min(inputPct * 10, 100)}%`;
            }
            if (tokenCards[1]) {
                tokenCards[1].querySelector('.ai-token-value').textContent = formatTokens(totals.outputTokens);
                tokenCards[1].querySelector('.ai-token-bar-fill').style.width = `${Math.min(outputPct * 10, 100)}%`;
            }
            if (tokenCards[2]) {
                tokenCards[2].querySelector('.ai-token-value').textContent = formatTokens(totals.cacheCreationTokens);
                tokenCards[2].querySelector('.ai-token-bar-fill').style.width = `${Math.min(cacheCreatePct, 100)}%`;
            }
            if (tokenCards[3]) {
                tokenCards[3].querySelector('.ai-token-value').textContent = formatTokens(totals.cacheReadTokens);
                tokenCards[3].querySelector('.ai-token-label').textContent = `Cache Read (${cacheReadPct.toFixed(0)}%)`;
                tokenCards[3].querySelector('.ai-token-bar-fill').style.width = `${Math.min(cacheReadPct, 100)}%`;
            }
        }

        function updateDailyBarChart(dailyData) {
            const container = document.querySelector('.ai-bar-chart');
            if (!container) return;

            const maxCost = Math.max(...dailyData.map(d => d.totalCost));
            container.innerHTML = dailyData.map(day => {
                const height = maxCost > 0 ? (day.totalCost / maxCost) * 160 : 4;
                const dateShort = new Date(day.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                return `<div class="ai-bar">
                    <div class="ai-bar-value">$${day.totalCost.toFixed(0)}</div>
                    <div class="ai-bar-fill" style="height: ${height}px;"></div>
                    <div class="ai-bar-label">${dateShort}</div>
                </div>`;
            }).reverse().join('');
        }

        function updateWeeklyBars(weeklyData) {
            const container = document.querySelector('.ai-weekly-bars');
            if (!container) return;

            const maxCost = Math.max(...weeklyData.map(w => w.totalCost));
            container.innerHTML = weeklyData.map(week => {
                const width = maxCost > 0 ? (week.totalCost / maxCost) * 100 : 0;
                const weekLabel = `Week ${new Date(week.week).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}`;
                return `<div class="ai-weekly-row">
                    <div class="ai-weekly-label">${weekLabel}</div>
                    <div class="ai-weekly-bar"><div class="ai-weekly-bar-fill" style="width: ${width}%;"></div></div>
                    <div class="ai-weekly-value">$${week.totalCost.toFixed(2)}</div>
                </div>`;
            }).join('');
        }

        function updateSessionList(sessions) {
            const container = document.querySelector('.ai-session-list');
            if (!container) return;

            const formatTokens = (n) => {
                if (n >= 1e9) return (n / 1e9).toFixed(1) + 'B';
                if (n >= 1e6) return (n / 1e6).toFixed(1) + 'M';
                if (n >= 1e3) return (n / 1e3).toFixed(1) + 'K';
                return n.toString();
            };

            container.innerHTML = sessions.sort((a, b) => b.totalCost - a.totalCost).map(s => {
                return `<div class="ai-session-item">
                    <div class="ai-session-name" title="${s.sessionId}">${s.projectPath || s.sessionId}</div>
                    <div class="ai-session-tokens">${formatTokens(s.totalTokens)}</div>
                    <div class="ai-session-cost">$${s.totalCost.toFixed(2)}</div>
                </div>`;
            }).join('');
        }

        function updateDailyTableFromCcusage(dailyData) {
            const tbody = document.getElementById('daily-cost-table');
            if (!tbody || !dailyData) return;

            const maxCost = Math.max(...dailyData.map(d => d.totalCost));
            tbody.innerHTML = dailyData.map((day, idx) => {
                const opusCost = day.modelBreakdowns?.find(m => m.modelName.includes('opus'))?.cost || 0;
                const sonnetCost = day.modelBreakdowns?.find(m => m.modelName.includes('sonnet'))?.cost || 0;
                const haikuCost = day.modelBreakdowns?.find(m => m.modelName.includes('haiku'))?.cost || 0;
                const barWidth = maxCost > 0 ? (day.totalCost / maxCost) * 100 : 0;
                const trend = idx < dailyData.length - 1 ? (day.totalCost > dailyData[idx + 1].totalCost ? '▲' : '▼') : '-';
                return `<tr>
                    <td>${day.date}</td>
                    <td>$${opusCost.toFixed(2)}</td>
                    <td>$${sonnetCost.toFixed(2)}</td>
                    <td>$${haikuCost.toFixed(2)}</td>
                    <td class="cost">$${day.totalCost.toFixed(2)}</td>
                    <td><div class="ai-mini-bar"><div class="ai-mini-bar-fill" style="width: ${barWidth}%;"></div></div></td>
                    <td>${trend}</td>
                </tr>`;
            }).join('');
        }

        function updateMonthlyTableFromCcusage(monthlyData) {
            const tbody = document.getElementById('monthly-cost-table');
            if (!tbody || !monthlyData) return;

            const maxCost = Math.max(...monthlyData.map(m => m.totalCost));
            tbody.innerHTML = monthlyData.map(month => {
                const opusCost = month.modelBreakdowns?.find(m => m.modelName.includes('opus'))?.cost || 0;
                const sonnetCost = month.modelBreakdowns?.find(m => m.modelName.includes('sonnet'))?.cost || 0;
                const haikuCost = month.modelBreakdowns?.find(m => m.modelName.includes('haiku'))?.cost || 0;
                const barWidth = maxCost > 0 ? (month.totalCost / maxCost) * 100 : 0;
                return `<tr>
                    <td>${month.month}</td>
                    <td>$${opusCost.toFixed(2)}</td>
                    <td>$${sonnetCost.toFixed(2)}</td>
                    <td>$${haikuCost.toFixed(2)}</td>
                    <td class="cost">$${month.totalCost.toFixed(2)}</td>
                    <td><div class="ai-mini-bar"><div class="ai-mini-bar-fill" style="width: ${barWidth}%;"></div></div></td>
                </tr>`;
            }).join('');
        }

        function updateDailyTable(data) {
            const tbody = document.getElementById('daily-cost-table');
            if (!tbody || !data || data.length === 0) return;
            tbody.innerHTML = data.map((day, idx) => {
                const trend = idx < data.length - 1 ? (day.total > data[idx + 1].total ? '▲' : '▼') : '-';
                return `<tr><td>${day.date || 'N/A'}</td><td>$${day.opus?.toFixed(2) || '0.00'}</td><td>$${day.sonnet?.toFixed(2) || '0.00'}</td><td>$${day.haiku?.toFixed(2) || '0.00'}</td><td><strong>$${day.total?.toFixed(2) || '0.00'}</strong></td><td>${trend}</td></tr>`;
            }).join('');
        }

        function updateMonthlyTable(data) {
            const tbody = document.getElementById('monthly-cost-table');
            if (!data || data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">No data available</td></tr>';
                return;
            }
            tbody.innerHTML = data.map(month => `<tr><td><strong>${month.month || 'N/A'}</strong></td><td>$${month.opus?.toFixed(2) || '0.00'}</td><td>$${month.sonnet?.toFixed(2) || '0.00'}</td><td>$${month.haiku?.toFixed(2) || '0.00'}</td><td><strong>$${month.total?.toFixed(2) || '0.00'}</strong></td></tr>`).join('');
        }

        // ============================================
        // CLOUD INFRASTRUCTURE COSTS FUNCTIONS
        // ============================================

        function loadCloudCostsData() {
            const data = CLOUD_COSTS_DATA;
            if (!data) return;

            // Update last updated timestamp
            const updatedEl = document.getElementById('cloud-costs-updated');
            if (updatedEl && data.lastUpdated) {
                const date = new Date(data.lastUpdated);
                updatedEl.textContent = `Updated: ${date.toLocaleDateString()}`;
            }

            // Use totals (new structure) or summary (old structure) for backwards compatibility
            const totals = data.totals || data.summary || {};

            // Update hero cards
            const totalMonth = document.getElementById('cloud-total-month');
            const projected = document.getElementById('cloud-projected');
            const ytd = document.getElementById('cloud-ytd');
            const savings = document.getElementById('cloud-savings');
            const monthLabel = document.getElementById('cloud-month-label');

            if (totalMonth) totalMonth.textContent = `€${(totals.totalMonthly || 0).toFixed(2)}`;
            if (projected) projected.textContent = `€${(totals.projectedMonthly || 0).toFixed(2)}`;
            if (ytd) ytd.textContent = `€${(totals.totalYTD || 0).toFixed(2)}`;
            if (savings) savings.textContent = `€${(totals.freeTierSavings || 0).toFixed(2)}`;
            if (monthLabel) {
                const currentMonth = new Date().toLocaleString('en-US', { month: 'long', year: 'numeric' });
                monthLabel.textContent = currentMonth;
            }

            // Update donut chart
            renderCloudDonut(data.providers, totals.totalMonthly || 0);

            // Render provider breakdown cards
            renderCloudProviderCards(data.providers);

            // Render monthly trend bars
            renderCloudMonthlyBars(data.monthly || []);

            // Render service details table
            renderCloudServicesTable(data.providers);

            // Render free tier usage
            renderFreeTierUsage(data.providers);

            // Render market comparison
            renderMarketComparison(data.marketComparison);
        }

        function renderCloudDonut(providers, total) {
            const ociCircle = document.querySelector('.cloud-donut-oci');
            const gcpCircle = document.querySelector('.cloud-donut-gcp');
            const donutTotal = document.getElementById('cloud-donut-total');

            if (!ociCircle || !gcpCircle) return;

            // Calculate provider costs
            const ociCost = providers?.oci?.monthly?.[0]?.totalCost || 0;
            const gcpCost = providers?.gcloud?.monthly?.[0]?.totalCost || 0;
            const actualTotal = ociCost + gcpCost || 0.01; // Prevent division by zero

            // Calculate percentages
            const ociPercent = (ociCost / actualTotal) * 100;
            const gcpPercent = (gcpCost / actualTotal) * 100;

            // SVG circle properties (circumference = 2 * PI * 40 ≈ 251)
            const circumference = 251;
            const ociDash = (ociPercent / 100) * circumference;
            const gcpDash = (gcpPercent / 100) * circumference;

            // Set OCI segment
            ociCircle.style.strokeDasharray = `${ociDash} ${circumference}`;
            ociCircle.style.strokeDashoffset = '0';

            // Set GCP segment (starts where OCI ends)
            gcpCircle.style.strokeDasharray = `${gcpDash} ${circumference}`;
            gcpCircle.style.strokeDashoffset = `-${ociDash}`;

            // Update center value
            if (donutTotal) {
                donutTotal.textContent = `€${actualTotal.toFixed(2)}`;
            }
        }

        function renderCloudProviderCards(providers) {
            const container = document.getElementById('cloud-providers-container');
            if (!container) return;

            let html = '';
            for (const [key, provider] of Object.entries(providers)) {
                const currentMonth = provider.monthly[0];
                const prevMonth = provider.monthly[1];
                const trend = prevMonth ? (currentMonth.totalCost - prevMonth.totalCost) : 0;
                const trendIcon = trend > 0 ? '▲' : trend < 0 ? '▼' : '—';
                const trendColor = trend > 0 ? 'var(--accent-red)' : trend < 0 ? 'var(--accent-green)' : 'var(--text-secondary)';
                const instanceCount = provider.instances?.length || 0;
                const region = provider.region || 'N/A';

                html += `
                <div style="background: var(--bg-secondary); border-radius: 12px; padding: 1.25rem; border-left: 4px solid ${provider.color}; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                        <div>
                            <div style="font-weight: 700; font-size: 1.1rem; color: var(--text-primary);">${provider.shortName || provider.name}</div>
                            <div style="font-size: 0.7rem; color: var(--text-secondary);">${provider.name}</div>
                        </div>
                        ${provider.freeTier ? `<span class="status-badge on" style="font-size: 0.65rem;">${provider.freeTierLabel || 'Free Tier'}</span>` : ''}
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 0.75rem;">
                        <div style="font-size: 2rem; font-weight: bold; color: ${provider.color};">€${currentMonth.totalCost.toFixed(2)}</div>
                        <div style="font-size: 0.8rem; color: ${trendColor}; font-weight: 600;">${trendIcon} €${Math.abs(trend).toFixed(2)}</div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; font-size: 0.75rem; color: var(--text-secondary); padding-top: 0.75rem; border-top: 1px solid var(--border-color);">
                        <div><strong>${instanceCount}</strong> instance${instanceCount !== 1 ? 's' : ''}</div>
                        <div style="text-align: right;">${region}</div>
                        <div><strong>${currentMonth.services.length}</strong> services</div>
                        <div style="text-align: right;">${currentMonth.month}</div>
                    </div>
                    ${provider.authRequired ? '<div style="margin-top: 0.75rem; font-size: 0.7rem; color: var(--accent-yellow); background: rgba(255,200,0,0.1); padding: 0.4rem 0.6rem; border-radius: 6px;">⚠️ ${provider.authMessage || "Requires auth for live data"}</div>' : ''}
                </div>
                `;
            }
            container.innerHTML = html;
        }

        function renderCloudMonthlyBars(monthly) {
            const container = document.getElementById('cloud-monthly-bars');
            if (!container || !monthly || !monthly.length) return;

            // Get last 6 months or available data
            const months = monthly.slice(0, 6).reverse();
            const maxCost = Math.max(...months.map(m => m.totalCost), 1);

            let html = '';
            months.forEach((month, i) => {
                const heightPercent = (month.totalCost / maxCost) * 100;
                const ociPercent = month.breakdown?.oci ? (month.breakdown.oci / month.totalCost) * 100 : 100;
                const gcpPercent = month.breakdown?.gcloud ? (month.breakdown.gcloud / month.totalCost) * 100 : 0;

                html += `
                <div class="ai-bar-group" style="flex: 1; display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
                    <div style="width: 100%; height: 100%; position: relative; display: flex; flex-direction: column; justify-content: flex-end;">
                        <div style="height: ${Math.max(heightPercent, 5)}%; min-height: 4px; display: flex; flex-direction: column; border-radius: 4px 4px 0 0; overflow: hidden;">
                            <div style="height: ${ociPercent}%; background: linear-gradient(180deg, #F80000, #cc0000);"></div>
                            <div style="height: ${gcpPercent}%; background: linear-gradient(180deg, #4285F4, #2a5db0);"></div>
                        </div>
                    </div>
                    <div style="font-size: 0.7rem; color: var(--text-secondary);">${month.label?.split(' ')[0]?.substring(0,3) || month.month}</div>
                    <div style="font-size: 0.75rem; font-weight: 600; color: var(--text-primary);">€${month.totalCost.toFixed(2)}</div>
                </div>
                `;
            });

            container.innerHTML = html;
        }

        function renderCloudServicesTable(providers) {
            const tbody = document.getElementById('cloud-services-tbody');
            if (!tbody) return;

            let html = '';
            for (const [key, provider] of Object.entries(providers)) {
                const currentMonth = provider.monthly[0];

                for (const service of currentMonth.services) {
                    const freeTierBadge = service.freeUsed
                        ? '<span class="status-badge on" style="font-size: 0.65rem;">Free</span>'
                        : '<span class="status-badge" style="font-size: 0.65rem; background: rgba(255,100,100,0.15); color: var(--accent-red); border: 1px solid var(--accent-red);">Paid</span>';

                    const costDisplay = service.cost > 0
                        ? `<span class="progress-value--orange">€${service.cost.toFixed(2)}</span>`
                        : '<span class="progress-value--green">€0.00</span>';

                    html += `
                    <tr>
                        <td><span style="color: ${provider.color}; font-weight: 600;">${provider.shortName || key.toUpperCase()}</span></td>
                        <td style="font-weight: 500;">${service.name}</td>
                        <td class="fs-sm text-secondary">${service.description || '—'}</td>
                        <td><code style="background: var(--bg-tertiary); padding: 0.2rem 0.4rem; border-radius: 4px; font-size: 0.75rem;">${service.usage?.toFixed(2) || 0} ${service.unit || ''}</code></td>
                        <td style="font-weight: 600;">${costDisplay}</td>
                        <td>${freeTierBadge}</td>
                    </tr>
                    `;
                }
            }
            tbody.innerHTML = html || '<tr><td colspan="6" style="text-align: center;">No data available</td></tr>';
        }

        function renderFreeTierUsage(providers) {
            const container = document.getElementById('cloud-free-tier-container');
            if (!container) return;

            let html = '';
            for (const [key, provider] of Object.entries(providers)) {
                if (!provider.freeTierLimits) continue;

                html += `<div style="background: var(--bg-secondary); border-radius: 12px; padding: 1.25rem; border-left: 4px solid ${provider.color};">
                    <div style="font-weight: 700; font-size: 1rem; color: ${provider.color}; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <span>${provider.shortName || provider.name}</span>
                        <span style="font-size: 0.7rem; color: var(--text-secondary); font-weight: normal;">${provider.freeTierLabel || 'Free Tier'}</span>
                    </div>`;

                for (const [service, limits] of Object.entries(provider.freeTierLimits)) {
                    const percent = limits.percentage || 0;
                    const barColor = percent >= 90 ? 'var(--accent-red)' : percent >= 70 ? 'var(--accent-yellow)' : 'var(--accent-green)';

                    html += `
                    <div class="cost-comparison-item">
                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 0.4rem;">
                            <span style="color: var(--text-primary); font-weight: 500;">${service}</span>
                            <span class="text-muted">${limits.used} / ${limits.limit}</span>
                        </div>
                        <div style="height: 8px; background: var(--bg-tertiary); border-radius: 4px; overflow: hidden;">
                            <div style="height: 100%; width: ${percent}%; background: ${barColor}; border-radius: 4px; transition: width 0.3s ease;"></div>
                        </div>
                        ${limits.note ? `<div class="free-tier-note">${limits.note}</div>` : ''}
                    </div>`;
                }

                html += `</div>`;
            }
            container.innerHTML = html || '<div style="color: var(--text-secondary);">No free tier data available</div>';
        }

        function renderMarketComparison(comparison) {
            const container = document.getElementById('cloud-market-comparison');
            if (!container || !comparison) return;

            const actualCost = comparison.actualCost || 0;
            const awsCost = comparison.equivalentAWS?.monthly || 0;
            const azureCost = comparison.equivalentAzure?.monthly || 0;
            const savings = comparison.savings || 0;
            const savingsPercent = comparison.savingsPercent || 0;

            container.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
                    <div style="text-align: center; padding: 1rem; background: var(--bg-tertiary); border-radius: 8px;">
                        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Your Cost</div>
                        <div style="font-size: 2rem; font-weight: bold; color: var(--accent-green);">€${actualCost.toFixed(2)}</div>
                        <div style="font-size: 0.7rem; color: var(--text-secondary);">OCI + GCP Free Tiers</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: var(--bg-tertiary); border-radius: 8px;">
                        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.5rem;">AWS Equivalent</div>
                        <div style="font-size: 2rem; font-weight: bold; color: var(--accent-orange);">€${awsCost.toFixed(2)}</div>
                        <div style="font-size: 0.7rem; color: var(--text-secondary);">${comparison.equivalentAWS?.description || 't3.medium + EBS'}</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: var(--bg-tertiary); border-radius: 8px;">
                        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Azure Equivalent</div>
                        <div style="font-size: 2rem; font-weight: bold; color: var(--accent-blue);">€${azureCost.toFixed(2)}</div>
                        <div style="font-size: 0.7rem; color: var(--text-secondary);">${comparison.equivalentAzure?.description || 'B2s + SSD'}</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: linear-gradient(135deg, rgba(0,200,100,0.1), rgba(0,150,80,0.1)); border-radius: 8px; border: 1px solid var(--accent-green);">
                        <div style="font-size: 0.75rem; color: var(--accent-green); margin-bottom: 0.5rem;">Your Savings</div>
                        <div style="font-size: 2rem; font-weight: bold; color: var(--accent-green);">€${savings.toFixed(2)}</div>
                        <div style="font-size: 0.8rem; font-weight: 600; color: var(--accent-green);">${savingsPercent}% saved</div>
                    </div>
                </div>
            `;
        }

        // ============================================
        // RESOURCES TAB FUNCTIONS (htop-style)
        // ============================================

        async function loadResourcesData() {
            const monitor = document.getElementById('resources-monitor');
            if (!monitor) return;

            try {
                if (typeof CONFIG === 'undefined' || !CONFIG.virtualMachines) {
                    monitor.innerHTML = '<div class="htop-loading">No configuration data available</div>';
                    return;
                }

                const vms = Object.values(CONFIG.virtualMachines);
                const services = CONFIG.services || {};

                // Group services by VM
                const servicesByVM = {};
                Object.values(services).forEach(svc => {
                    if (svc.vmId) {
                        if (!servicesByVM[svc.vmId]) {
                            servicesByVM[svc.vmId] = [];
                        }
                        servicesByVM[svc.vmId].push(svc);
                    }
                });

                // Sort services by RAM usage (descending) within each VM
                Object.keys(servicesByVM).forEach(vmId => {
                    servicesByVM[vmId].sort((a, b) => {
                        const ramA = parseResourceValue(a.resources?.ram?.max || a.resources?.ram?.min || '0');
                        const ramB = parseResourceValue(b.resources?.ram?.max || b.resources?.ram?.min || '0');
                        return ramB - ramA;
                    });
                });

                // Render htop-style VM cards
                let html = '';
                vms.forEach(vm => {
                    const vmServices = servicesByVM[vm.id] || [];
                    const specs = vm.specs || {};

                    // Parse VM specs
                    const cpuText = specs.cpu || 'N/A';
                    const ramText = specs.ram || 'N/A';
                    const storageText = specs.storage || 'N/A';
                    const vramText = specs.vram || null;

                    // Calculate service usage totals
                    const ramTotal = parseResourceValue(ramText);
                    let ramUsed = 0;
                    let storageUsed = 0;

                    vmServices.forEach(svc => {
                        ramUsed += parseResourceValue(svc.resources?.ram?.max || svc.resources?.ram?.min || '0');
                        storageUsed += parseResourceValue(svc.resources?.storage?.max || svc.resources?.storage?.min || '0');
                    });

                    const storageTotal = parseResourceValue(storageText);
                    const ramPercent = ramTotal > 0 ? Math.min((ramUsed / ramTotal) * 100, 100) : 0;
                    const storagePercent = storageTotal > 0 ? Math.min((storageUsed / storageTotal) * 100, 100) : 0;

                    // CPU is simulated as core count for display
                    const cpuMatch = cpuText.match(/(\d+)/);
                    const cpuCores = cpuMatch ? parseInt(cpuMatch[1]) : 1;

                    html += `
                        <div class="htop-vm-card">
                            <div class="htop-vm-header">
                                <div class="htop-vm-title">
                                    <span class="htop-vm-name">${vm.name}</span>
                                    <span class="htop-vm-specs">${cpuText} • ${ramText} • ${storageText}</span>
                                </div>
                                <div class="htop-vm-status">
                                    <span class="htop-vm-badge ${vm.availability === 'wake-on-demand' ? 'dormant' : (vm.status === 'active' ? 'active' : 'stopped')}">${vm.availability === 'wake-on-demand' ? 'dormant' : (vm.status || 'unknown')}</span>
                                </div>
                            </div>

                            <div class="htop-bars-grid">
                                <div class="htop-bar-item">
                                    <div class="htop-bar-label">
                                        <span class="htop-bar-name">CPU</span>
                                        <span class="htop-bar-value">${cpuCores} core${cpuCores > 1 ? 's' : ''}</span>
                                    </div>
                                    <div class="htop-bar">
                                        <div class="htop-bar-fill cpu" style="width: ${vmServices.length > 0 ? 30 : 5}%"></div>
                                    </div>
                                </div>

                                <div class="htop-bar-item">
                                    <div class="htop-bar-label">
                                        <span class="htop-bar-name">RAM</span>
                                        <span class="htop-bar-value">${formatBytesCompact(ramUsed)} / ${ramText}</span>
                                    </div>
                                    <div class="htop-bar">
                                        <div class="htop-bar-fill ram ${getBarLevel(ramPercent)}" style="width: ${Math.max(ramPercent, 2)}%"></div>
                                    </div>
                                </div>

                                <div class="htop-bar-item">
                                    <div class="htop-bar-label">
                                        <span class="htop-bar-name">Storage</span>
                                        <span class="htop-bar-value">${formatBytesCompact(storageUsed)} / ${storageText}</span>
                                    </div>
                                    <div class="htop-bar">
                                        <div class="htop-bar-fill storage ${getBarLevel(storagePercent)}" style="width: ${Math.max(storagePercent, 2)}%"></div>
                                    </div>
                                </div>

                                ${vramText ? `
                                <div class="htop-bar-item">
                                    <div class="htop-bar-label">
                                        <span class="htop-bar-name">VRAM</span>
                                        <span class="htop-bar-value">${vramText}</span>
                                    </div>
                                    <div class="htop-bar">
                                        <div class="htop-bar-fill vram" style="width: 0%"></div>
                                    </div>
                                </div>
                                ` : ''}
                            </div>

                            <div class="htop-services">
                                <div class="htop-services-title">Services (${vmServices.length}) — sorted by RAM</div>
                                ${vmServices.length > 0 ? `
                                <div class="htop-service-list">
                                    ${vmServices.map(svc => {
                                        const svcRam = parseResourceValue(svc.resources?.ram?.max || svc.resources?.ram?.min || '0');
                                        const svcStorage = parseResourceValue(svc.resources?.storage?.max || svc.resources?.storage?.min || '0');
                                        const svcRamPercent = ramTotal > 0 ? (svcRam / ramTotal) * 100 : 0;
                                        const svcStoragePercent = storageTotal > 0 ? (svcStorage / storageTotal) * 100 : 0;

                                        return `
                                        <div class="htop-service-row">
                                            <span class="htop-service-name">${svc.displayName || svc.name}</span>
                                            <div class="htop-service-bar" title="RAM: ${formatBytesCompact(svcRam)}">
                                                <div class="htop-service-bar-fill ram" style="width: ${Math.max(svcRamPercent, 2)}%"></div>
                                            </div>
                                            <span class="htop-service-value">${formatBytesCompact(svcRam)}</span>
                                        </div>
                                        `;
                                    }).join('')}
                                </div>
                                ` : '<div class="htop-no-services">No services deployed</div>'}
                            </div>
                        </div>
                    `;
                });

                monitor.innerHTML = html;

            } catch (error) {
                console.error('Error loading resources data:', error);
                monitor.innerHTML = `<div class="htop-loading" style="color: var(--accent-red);">Error: ${error.message}</div>`;
            }
        }

        function getBarLevel(percent) {
            if (percent < 60) return '';
            if (percent < 80) return 'warning';
            return 'danger';
        }

        function formatBytesCompact(bytes) {
            if (!bytes || bytes === 0) return '0';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            const value = bytes / Math.pow(k, i);
            return value < 10 ? value.toFixed(1) + ' ' + sizes[i] : Math.round(value) + ' ' + sizes[i];
        }

        function getGaugeColor(percent) {
            if (percent < 70) return '#51cf66';
            if (percent < 90) return '#ffc107';
            return '#ff6b6b';
        }

        async function killService(serviceId) {
            const isLoggedIn = localStorage.getItem('github_token');
            if (!isLoggedIn) {
                alert('Please login to kill services');
                return;
            }

            if (!confirm(`Are you sure you want to kill ${serviceId}? This will stop the container.`)) {
                return;
            }

            try {
                const token = localStorage.getItem('github_token');
                const response = await fetch(`${apiUrl}/service/${serviceId}/kill`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    showNotification(`${serviceId} killed successfully`);
                    setTimeout(() => loadResourcesData(), 1000);
                } else {
                    const error = await response.text();
                    throw new Error(error);
                }
            } catch (error) {
                alert(`Failed to kill service: ${error.message}`);
            }
        }

        function formatBytes(bytes) {
            if (!bytes || bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round((bytes / Math.pow(k, i)) * 100) / 100 + ' ' + sizes[i];
        }

        function parseResourceValue(value) {
            if (!value) return 0;
            if (typeof value === 'number') return value;
            const match = value.match(/(\d+(?:\.\d+)?)\s*([KMGT]?B)/i);
            if (!match) return 0;
            const num = parseFloat(match[1]);
            const unit = match[2].toUpperCase();
            const multipliers = { 'B': 1, 'KB': 1024, 'MB': 1024*1024, 'GB': 1024*1024*1024, 'TB': 1024*1024*1024*1024 };
            return num * (multipliers[unit] || 1);
        }

        function getUsageLevel(percent) {
            const p = parseFloat(percent);
            if (p < 60) return 'ok';
            if (p < 80) return 'warning';
            return 'danger';
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.classList.add('closing');
                setTimeout(() => notification.remove(), 300);
            }, 2000);
        }

        // ============================================
        // INFRASTRUCTURE TAB (Status View)
        // ============================================
        function loadInfraData() {
            console.log('loadInfraData() CALLED');
            try {
            // Use CONFIG if available, otherwise use FALLBACK_INFRASTRUCTURE
            if (typeof CONFIG === 'undefined' || !CONFIG.virtualMachines) {
                console.warn('loadInfraData: CONFIG not available, using FALLBACK_INFRASTRUCTURE');
                window.CONFIG = FALLBACK_INFRASTRUCTURE;
            }
            console.log('loadInfraData: CONFIG.virtualMachines =', CONFIG.virtualMachines);
            console.log('loadInfraData: CONFIG.services =', CONFIG.services);

            // Populate VMs table
            const vmsTbody = document.getElementById('infra-vms-tbody');
            console.log('loadInfraData: vmsTbody element =', vmsTbody);
            if (vmsTbody) {
                vmsTbody.innerHTML = '';
                Object.values(CONFIG.virtualMachines || {}).forEach(vm => {
                    const statusBadge = vm.status === 'active' ? 'on' : vm.status === 'pending' ? 'tbd' : vm.status === 'hold' ? 'hold' : 'dev';
                    const provider = CONFIG.providers?.[vm.provider];
                    const hostName = provider?.name || vm.provider || 'Unknown';
                    const ip = vm.network?.publicIp || 'pending';
                    // Handle os as object {name, version} or string
                    const osObj = vm.os || {};
                    const os = typeof osObj === 'string' ? osObj : (osObj.name ? `${osObj.name} ${osObj.version || ''}`.trim() : '-');
                    const sshCommand = vm.ssh?.command || `ssh ${vm.ssh?.user || 'root'}@${ip}`;
                    const consoleUrl = vm.ociInstanceId ? `https://cloud.oracle.com/compute/instances/${vm.ociInstanceId}` : (provider?.consoleUrl || '');

                    const dockerNetwork = vm.network?.dockerNetwork || vm.dockerNetwork || 'bridge';
                    vmsTbody.innerHTML += `
                        <tr class="vm-row">
                            <td>${hostName}</td>
                            <td><strong>${vm.name}</strong></td>
                            <td><code class="ip-address">${ip}</code></td>
                            <td><code>${dockerNetwork}</code></td>
                            <td>${os}</td>
                            <td>
                                <div class="vm-actions-inline">
                                    <button class="vm-action-btn btn-ssh" onclick="copyToClipboard('${sshCommand.replace(/'/g, "\\'")}', 'SSH command copied!')" title="Copy SSH command">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                                    </button>
                                    <button class="vm-action-btn btn-url" onclick="window.open('${consoleUrl}', '_blank')" ${!consoleUrl ? 'disabled' : ''} title="Open cloud console">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
                                    </button>
                                </div>
                            </td>
                        </tr>`;
                });
            }

            // Populate Services by VM
            const servicesContainer = document.getElementById('infra-services-by-vm-container');
            if (servicesContainer) {
                servicesContainer.innerHTML = '';
                const vms = Object.values(CONFIG.virtualMachines || {});
                const services = Object.values(CONFIG.services || {});

                vms.forEach(vm => {
                    const vmServices = services.filter(svc => svc.vmId === vm.id && svc.status === 'on');
                    if (vmServices.length === 0) return;

                    const vmIp = vm.network?.publicIp || '-';

                    let html = `
                        <div class="resources-section mb-lg">
                            <h4 class="section-header-sm">${vm.name}</h4>
                            <div class="resources-table-container">
                                <table class="resources-table status-table" style="font-size: 0.85rem;">
                                    <thead><tr><th>Service</th><th>URL</th><th>IP:PORT</th><th>Docker Network</th><th>Container</th><th>Brief</th></tr></thead>
                                    <tbody>`;

                    vmServices.forEach(svc => {
                        const url = svc.urls?.gui || svc.urls?.api || '-';
                        const port = svc.network?.port || '-';
                        const ipPort = port !== '-' ? `${vmIp}:${port}` : '-';
                        const dockerNetwork = svc.network?.dockerNetwork || vm.network?.dockerNetwork || 'bridge';
                        const container = svc.container || svc.containerName || svc.id || '-';
                        const brief = svc.description || svc.brief || '-';
                        html += `
                            <tr>
                                <td><strong>${svc.displayName || svc.name}</strong></td>
                                <td>${url !== '-' ? `<a href="${url}" target="_blank" style="color: var(--accent-blue);">${url}</a>` : '-'}</td>
                                <td><code>${ipPort}</code></td>
                                <td><code>${dockerNetwork}</code></td>
                                <td><code>${container}</code></td>
                                <td style="color: var(--text-secondary); font-size: 0.8rem;">${brief}</td>
                            </tr>`;
                    });

                    html += `</tbody></table></div></div>`;
                    servicesContainer.innerHTML += html;
                });
            }
            console.log('loadInfraData() COMPLETED');
            } catch (e) {
                console.error('loadInfraData() ERROR:', e);
            }
        }

        // Populate Infrastructure By Type view
        function loadInfraByTypeData() {
            // Use FALLBACK_INFRASTRUCTURE if CONFIG not available
            if (typeof CONFIG === 'undefined' || !CONFIG.virtualMachines) {
                window.CONFIG = FALLBACK_INFRASTRUCTURE;
            }

            const services = Object.values(CONFIG.services || {});
            const vms = CONFIG.virtualMachines || {};

            // Define service type categories
            const typeCategories = {
                'security': {
                    container: 'infra-type-security',
                    match: svc => ['backup', 'security', 'vault', 'encryption'].some(k =>
                        (svc.category || '').toLowerCase().includes(k) ||
                        (svc.name || '').toLowerCase().includes(k) ||
                        (svc.displayName || '').toLowerCase().includes(k)
                    )
                },
                'auth-proxy': {
                    container: 'infra-type-auth-proxy',
                    match: svc => ['proxy', 'npm', 'nginx', 'authelia', 'auth', 'oauth', 'vpn', 'tunnel'].some(k =>
                        (svc.category || '').toLowerCase().includes(k) ||
                        (svc.name || '').toLowerCase().includes(k) ||
                        (svc.displayName || '').toLowerCase().includes(k) ||
                        (svc.id || '').toLowerCase().includes(k)
                    )
                },
                'audit': {
                    container: 'infra-type-audit',
                    match: svc => ['matomo', 'analytics', 'audit', 'log', 'monitor'].some(k =>
                        (svc.category || '').toLowerCase().includes(k) ||
                        (svc.name || '').toLowerCase().includes(k) ||
                        (svc.displayName || '').toLowerCase().includes(k)
                    )
                },
                'data-api': {
                    container: 'infra-type-data-api',
                    match: svc => ['api', 'flask', 'cache', 'redis', 'db', 'database', 'mcp', 'postgres', 'mysql', 'maria'].some(k =>
                        (svc.category || '').toLowerCase().includes(k) ||
                        (svc.name || '').toLowerCase().includes(k) ||
                        (svc.displayName || '').toLowerCase().includes(k) ||
                        (svc.technology?.type || '').toLowerCase().includes(k)
                    )
                }
            };

            // Categorize services
            const categorized = {
                'security': [],
                'auth-proxy': [],
                'audit': [],
                'data-api': [],
                'others': []
            };

            services.forEach(svc => {
                if (svc.status !== 'on') return; // Only active services

                let matched = false;
                for (const [catKey, catDef] of Object.entries(typeCategories)) {
                    if (catDef.match(svc)) {
                        categorized[catKey].push(svc);
                        matched = true;
                        break;
                    }
                }
                if (!matched) {
                    categorized['others'].push(svc);
                }
            });

            // Render each category
            function renderTypeTable(containerId, serviceList) {
                const container = document.getElementById(containerId);
                if (!container) return;

                if (serviceList.length === 0) {
                    container.innerHTML = '<p style="color: var(--text-secondary); font-style: italic;">No services in this category</p>';
                    return;
                }

                let html = `
                    <div class="infra-type-table-wrapper">
                        <table class="infra-type-table">
                            <thead><tr><th>Service</th><th>VM</th><th>URL</th><th>IP:Port</th><th>Docker Network</th><th>Container</th><th>Brief</th></tr></thead>
                            <tbody>`;

                serviceList.forEach(svc => {
                    const vm = vms[svc.vmId];
                    const vmName = vm?.name || svc.vmId || '-';
                    const vmIp = vm?.network?.publicIp || '-';
                    const port = svc.network?.internalPort || svc.network?.port || '-';
                    const ipPort = (vmIp !== '-' && port !== '-') ? `${vmIp}:${port}` : '-';
                    const url = svc.urls?.gui || svc.urls?.api || svc.urls?.admin || '-';
                    const dockerNetwork = svc.network?.dockerNetwork || vm?.network?.dockerNetwork || 'bridge';
                    const container = svc.technology?.image || svc.container || svc.id || '-';
                    const brief = svc.description || svc.brief || svc.notes || '-';

                    html += `
                        <tr>
                            <td><strong>${svc.displayName || svc.name}</strong></td>
                            <td>${vmName}</td>
                            <td>${url !== '-' ? `<a href="${url}" target="_blank" style="color: var(--accent-blue);">${url}</a>` : '-'}</td>
                            <td><code>${ipPort}</code></td>
                            <td><code>${dockerNetwork}</code></td>
                            <td><code style="font-size: 0.75rem;">${container}</code></td>
                            <td style="color: var(--text-secondary); font-size: 0.8rem;">${brief}</td>
                        </tr>`;
                });

                html += '</tbody></table></div>';
                container.innerHTML = html;
            }

            renderTypeTable('infra-type-security', categorized['security']);
            renderTypeTable('infra-type-auth-proxy', categorized['auth-proxy']);
            renderTypeTable('infra-type-audit', categorized['audit']);
            renderTypeTable('infra-type-data-api', categorized['data-api']);
            renderTypeTable('infra-type-others', categorized['others']);
        }

        // Infrastructure view toggle (Category + Group Mode)
        let currentCategory = 'resource'; // 'resource' or 'security'
        let currentGroupMode = 'by-vm'; // 'by-vm' or 'by-type'
        let byTypeLoaded = false;

        function initInfraViewToggle() {
            // Category toggle in nav-level3 (Resource / Security)
            const categoryBtns = document.querySelectorAll('[data-topology-cat]');
            // Group mode controls (By VM / By Type) for tables
            const groupBtns = document.querySelectorAll('.view-mode-btn[data-group-mode]');
            // Control panels
            const listViewControls = document.getElementById('list-view-controls');

            // Category toggle (Resource / Security) - from nav-level3
            categoryBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    currentCategory = this.dataset.topologyCat;
                    categoryBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    // Toggle control panels visibility (only for Resource/Tables/App)
                    if (currentCategory === 'resource' && currentResourceView === 'tables' && currentTableView === 'app') {
                        listViewControls.style.display = 'flex';
                    } else {
                        listViewControls.style.display = 'none';
                    }
                    updateInfraView();
                });
            });

            // Group mode toggle (By VM / By Type)
            groupBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    currentGroupMode = this.dataset.groupMode;
                    groupBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updateInfraView();
                });
            });

            // Resource view toggle (Graphs / Tables)
            const resourceViewBtns = document.querySelectorAll('[data-resource-view]');
            resourceViewBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    currentResourceView = this.dataset.resourceView;
                    resourceViewBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    // Show table sub-nav when Tables is selected
                    const navResourceTables = document.getElementById('nav-resource-tables');
                    if (navResourceTables) {
                        navResourceTables.style.display = currentResourceView === 'tables' ? 'flex' : 'none';
                    }
                    // Show list controls only for App table
                    const listViewControls = document.getElementById('list-view-controls');
                    if (listViewControls) {
                        listViewControls.style.display = (currentResourceView === 'tables' && currentTableView === 'app') ? 'flex' : 'none';
                    }
                    updateInfraView();
                });
            });

            // Table view toggle (App / Data / Containers) under Resource/Tables
            const tableViewBtns = document.querySelectorAll('[data-table-view]');
            tableViewBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    currentTableView = this.dataset.tableView;
                    tableViewBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    // Show list controls only for App table
                    const listViewControls = document.getElementById('list-view-controls');
                    if (listViewControls) {
                        listViewControls.style.display = currentTableView === 'app' ? 'flex' : 'none';
                    }
                    updateInfraView();
                });
            });

            // Security view toggle (Graphs / Table)
            const securityViewBtns = document.querySelectorAll('[data-security-view]');
            securityViewBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    currentSecurityView = this.dataset.securityView;
                    securityViewBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updateInfraView();
                });
            });
        }

        // Track current views
        let currentResourceView = 'graphs'; // 'graphs' or 'tables'
        let currentTableView = 'app'; // 'app', 'data', 'containers'
        let currentSecurityView = 'graphs'; // 'graphs' or 'table'
        let resourceGraphsLoaded = false;
        let securityGraphsLoaded = false;
        let securityTableLoaded = false;

        function updateInfraView() {
            // Resource Graphs views
            const resourceGraphsView = document.getElementById('infra-resource-graphs-view');
            // Resource Tables views
            const byVmView = document.getElementById('infra-by-vm-view');
            const byTypeView = document.getElementById('infra-by-type-view');
            const dataView = document.getElementById('infra-data-view');
            const containersView = document.getElementById('infra-containers-view');
            // Security views
            const securityGraphsView = document.getElementById('infra-security-graphs-view');
            const securityTableView = document.getElementById('infra-security-table-view');
            // Nav level 4
            const navResource = document.getElementById('nav-resource');
            const navSecurityTopo = document.getElementById('nav-security-topo');
            const navResourceTables = document.getElementById('nav-resource-tables');

            // Hide all views
            [resourceGraphsView, byVmView, byTypeView, dataView, containersView, securityGraphsView, securityTableView].forEach(v => {
                if (v) {
                    v.style.display = 'none';
                    v.classList.remove('active');
                }
            });

            // Show/hide nav-level4 based on category
            if (navResource) navResource.style.display = currentCategory === 'resource' ? 'flex' : 'none';
            if (navSecurityTopo) navSecurityTopo.style.display = currentCategory === 'security' ? 'flex' : 'none';
            if (navResourceTables) navResourceTables.style.display = (currentCategory === 'resource' && currentResourceView === 'tables') ? 'flex' : 'none';

            // Show the appropriate view based on category
            if (currentCategory === 'resource') {
                if (currentResourceView === 'graphs') {
                    resourceGraphsView.style.display = 'block';
                    resourceGraphsView.classList.add('active');
                    if (!resourceGraphsLoaded) {
                        renderAppAllocationMap();
                        renderDatabaseDesignMap();
                        resourceGraphsLoaded = true;
                    }
                } else if (currentResourceView === 'tables') {
                    // Show table based on currentTableView
                    if (currentTableView === 'app') {
                        if (currentGroupMode === 'by-vm') {
                            byVmView.style.display = 'block';
                            byVmView.classList.add('active');
                        } else {
                            byTypeView.style.display = 'block';
                            byTypeView.classList.add('active');
                            if (!byTypeLoaded) {
                                loadInfraByTypeData();
                                byTypeLoaded = true;
                            }
                        }
                    } else if (currentTableView === 'data') {
                        dataView.style.display = 'block';
                        dataView.classList.add('active');
                    } else if (currentTableView === 'containers') {
                        containersView.style.display = 'block';
                        containersView.classList.add('active');
                    }
                }
            } else if (currentCategory === 'security') {
                if (currentSecurityView === 'graphs') {
                    securityGraphsView.style.display = 'block';
                    securityGraphsView.classList.add('active');
                    if (!securityGraphsLoaded) {
                        renderAuthenticationFlowGraph();
                        renderAuthorizationFlowGraph();
                        renderNetworkProtectionGraph();
                        renderDataProtectionGraph();
                        renderThreatProtectionGraph();
                        renderObservabilityGraph();
                        securityGraphsLoaded = true;
                    }
                } else if (currentSecurityView === 'table') {
                    securityTableView.style.display = 'block';
                    securityTableView.classList.add('active');
                    if (!securityTableLoaded) {
                        renderSecurityFeaturesTable();
                        securityTableLoaded = true;
                    }
                }
            }
        }

        // Render App Allocation Map (Org Chart Box Style)
        function renderAppAllocationMap() {
            if (typeof CONFIG === 'undefined' || !CONFIG.virtualMachines) {
                window.CONFIG = FALLBACK_INFRASTRUCTURE;
            }

            const container = document.getElementById('graph-app-container');
            if (!container) return;

            const vms = Object.values(CONFIG.virtualMachines || {});
            const services = Object.values(CONFIG.services || {});
            const databases = Object.values(CONFIG.databases || {});
            const providers = CONFIG.providers || {};

            // Group VMs by provider
            const vmsByProvider = {};
            vms.forEach(vm => {
                const key = vm.provider || 'unknown';
                if (!vmsByProvider[key]) vmsByProvider[key] = [];
                vmsByProvider[key].push(vm);
            });

            let html = `
            <div class="ot-level ot-root-level">
                <div class="ot-node ot-root">
                    <div class="ot-node-title">☁️ APP ALLOCATION</div>
                </div>
            </div>
            <div class="ot-connector-down"></div>
            <div class="ot-level ot-provider-level">`;

            const providerKeys = Object.keys(vmsByProvider);
            providerKeys.forEach((providerKey, pIdx) => {
                const provider = providers[providerKey];
                const providerName = provider?.name || providerKey;
                const providerIcon = providerKey === 'oracle' ? '🟠' : providerKey === 'gcloud' ? '🔵' : '⚪';

                html += `
                <div class="ot-branch">
                    <div class="ot-node ot-provider">
                        <div class="ot-node-title">${providerIcon} ${providerName.toUpperCase()}</div>
                    </div>
                    <div class="ot-connector-down"></div>
                    <div class="ot-level ot-vm-level">`;

                const providerVms = vmsByProvider[providerKey];
                providerVms.forEach(vm => {
                    const vmServices = services.filter(svc => svc.vmId === vm.id && svc.status === 'on');
                    const vmDatabases = databases.filter(db => db.vmId === vm.id);
                    const ip = vm.network?.publicIp || 'pending';

                    html += `
                        <div class="ot-node ot-vm">
                            <div class="ot-node-title">🖥️ ${vm.name}</div>
                            <div class="ot-node-sub">${ip}</div>
                            <div class="ot-node-items">`;

                    vmServices.forEach(svc => {
                        const url = svc.urls?.gui || svc.urls?.api || '';
                        html += `<div class="ot-item ot-svc">⚡ ${svc.displayName || svc.name}${url ? ` <a href="${url}" target="_blank">↗</a>` : ''}</div>`;
                    });

                    vmDatabases.forEach(db => {
                        html += `<div class="ot-item ot-db">🗄️ ${db.displayName || db.name || db.type}</div>`;
                    });

                    if (vmServices.length === 0 && vmDatabases.length === 0) {
                        html += `<div class="ot-item ot-empty">No services</div>`;
                    }

                    html += `</div></div>`;
                });

                html += `</div></div>`;
            });

            html += `</div>`;
            container.innerHTML = html;
        }

        // Render Database Design Map (Org Chart Box Style)
        function renderDatabaseDesignMap() {
            const container = document.getElementById('graph-database-container');
            if (!container) return;

            // Static database configuration
            const dbData = {
                sqlite: [
                    { name: 'authelia-db', vm: 'gcp-f-micro_1', path: '/data/authelia/db.sqlite3', size: '~5 MB', service: 'Authelia' },
                    { name: 'npm-db', vm: 'gcp-f-micro_1', path: '/data/npm/database.sqlite', size: '~10 MB', service: 'NPM' }
                ],
                mysql: [
                    { name: 'matomo-db', vm: 'oci-f-micro_2', path: '/data/mysql/', size: '~500 MB', service: 'Matomo' },
                    { name: 'photoprism-db', vm: 'oci-p-flex_1', path: '/data/photoprism/mysql/', size: '~2 GB', service: 'Photoprism' }
                ],
                redis: [
                    { name: 'authelia-redis', vm: 'gcp-f-micro_1', path: 'in-memory', size: '~50 MB', service: 'Authelia' }
                ]
            };

            let html = `
            <div class="ot-level ot-root-level">
                <div class="ot-node ot-root">
                    <div class="ot-node-title">🗄️ DATABASE DESIGN</div>
                </div>
            </div>
            <div class="ot-connector-down"></div>
            <div class="ot-level ot-provider-level">`;

            // SQLite
            html += `
            <div class="ot-branch">
                <div class="ot-node ot-provider">
                    <div class="ot-node-title">📄 SQLITE</div>
                    <div class="ot-node-sub">${dbData.sqlite.length} databases</div>
                </div>
                <div class="ot-connector-down"></div>
                <div class="ot-level ot-vm-level">`;
            dbData.sqlite.forEach(db => {
                html += `
                    <div class="ot-node ot-vm">
                        <div class="ot-node-title">${db.name}</div>
                        <div class="ot-node-sub">${db.vm}</div>
                        <div class="ot-node-items">
                            <div class="ot-item ot-db">📍 ${db.path}</div>
                            <div class="ot-item ot-svc">📏 ${db.size}</div>
                            <div class="ot-item ot-svc">⚡ ${db.service}</div>
                        </div>
                    </div>`;
            });
            html += `</div></div>`;

            // MySQL
            html += `
            <div class="ot-branch">
                <div class="ot-node ot-provider">
                    <div class="ot-node-title">🐬 MYSQL</div>
                    <div class="ot-node-sub">${dbData.mysql.length} databases</div>
                </div>
                <div class="ot-connector-down"></div>
                <div class="ot-level ot-vm-level">`;
            dbData.mysql.forEach(db => {
                html += `
                    <div class="ot-node ot-vm">
                        <div class="ot-node-title">${db.name}</div>
                        <div class="ot-node-sub">${db.vm}</div>
                        <div class="ot-node-items">
                            <div class="ot-item ot-db">📍 ${db.path}</div>
                            <div class="ot-item ot-svc">📏 ${db.size}</div>
                            <div class="ot-item ot-svc">⚡ ${db.service}</div>
                        </div>
                    </div>`;
            });
            html += `</div></div>`;

            // Redis
            html += `
            <div class="ot-branch">
                <div class="ot-node ot-provider">
                    <div class="ot-node-title">🔴 REDIS</div>
                    <div class="ot-node-sub">${dbData.redis.length} instance</div>
                </div>
                <div class="ot-connector-down"></div>
                <div class="ot-level ot-vm-level">`;
            dbData.redis.forEach(db => {
                html += `
                    <div class="ot-node ot-vm">
                        <div class="ot-node-title">${db.name}</div>
                        <div class="ot-node-sub">${db.vm}</div>
                        <div class="ot-node-items">
                            <div class="ot-item ot-db">📍 ${db.path}</div>
                            <div class="ot-item ot-svc">📏 ${db.size}</div>
                            <div class="ot-item ot-svc">⚡ ${db.service}</div>
                        </div>
                    </div>`;
            });
            html += `</div></div>`;

            html += `</div>`;
            container.innerHTML = html;
        }

        // ==========================================
        // SECURITY DESIGN GRAPHS (6 Purpose-Based)
        // ==========================================

        // 1. AUTHENTICATION FLOW - "Who are you?"
        function renderAuthenticationFlowGraph() {
            const container = document.getElementById('graph-auth-flow-container');
            if (!container) return;

            const html = `
            <div class="ot-level ot-root-level">
                <div class="ot-node ot-root">
                    <div class="ot-node-title">🔑 AUTHENTICATION FLOW</div>
                    <div class="ot-node-sub">"Who are you?"</div>
                </div>
            </div>
            <div class="ot-connector-down"></div>
            <div class="ot-level ot-provider-level">
                <div class="ot-branch">
                    <div class="ot-node ot-provider">
                        <div class="ot-node-title">📥 REQUEST</div>
                        <div class="ot-node-sub">User Access</div>
                    </div>
                    <div class="ot-connector-down"></div>
                    <div class="ot-level ot-vm-level">
                        <div class="ot-node ot-vm">
                            <div class="ot-node-title">🔀 NPM</div>
                            <div class="ot-node-sub">Forward Auth</div>
                            <div class="ot-node-items">
                                <div class="ot-item ot-svc">🚦 Auth Check</div>
                                <div class="ot-item ot-svc">🔄 Redirect</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ot-branch">
                    <div class="ot-node ot-provider">
                        <div class="ot-node-title">🛡️ AUTHELIA</div>
                        <div class="ot-node-sub">gcp-f-micro_1</div>
                    </div>
                    <div class="ot-connector-down"></div>
                    <div class="ot-level ot-vm-level">
                        <div class="ot-node ot-vm">
                            <div class="ot-node-title">🔐 Login Portal</div>
                            <div class="ot-node-items">
                                <div class="ot-item ot-svc">👤 Username/Password</div>
                                <div class="ot-item ot-svc">📱 2FA/TOTP</div>
                                <div class="ot-item ot-svc">🔑 WebAuthn</div>
                            </div>
                        </div>
                        <div class="ot-node ot-vm">
                            <div class="ot-node-title">🎫 Session</div>
                            <div class="ot-node-items">
                                <div class="ot-item ot-db">🍪 Cookie</div>
                                <div class="ot-item ot-db">🔗 JWT Token</div>
                                <div class="ot-item ot-db">⏱️ TTL Expiry</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ot-branch">
                    <div class="ot-node ot-provider">
                        <div class="ot-node-title">🔗 SSO/OIDC</div>
                        <div class="ot-node-sub">Single Sign-On</div>
                    </div>
                    <div class="ot-connector-down"></div>
                    <div class="ot-level ot-vm-level">
                        <div class="ot-node ot-vm">
                            <div class="ot-node-title">🌐 Providers</div>
                            <div class="ot-node-items">
                                <div class="ot-item ot-svc">🔐 OIDC Flow</div>
                                <div class="ot-item ot-svc">📜 ID Token</div>
                                <div class="ot-item ot-svc">🔄 Refresh Token</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>`;
            container.innerHTML = html;
        }

        // 2. AUTHORIZATION FLOW - "What can you access?"
        function renderAuthorizationFlowGraph() {
            const container = document.getElementById('graph-authz-flow-container');
            if (!container) return;

            const html = `
            <div class="ot-level ot-root-level">
                <div class="ot-node ot-root">
                    <div class="ot-node-title">🎫 AUTHORIZATION FLOW</div>
                    <div class="ot-node-sub">"What can you access?"</div>
                </div>
            </div>
            <div class="ot-connector-down"></div>
            <div class="ot-level ot-provider-level">
                <div class="ot-branch">
                    <div class="ot-node ot-provider">
                        <div class="ot-node-title">📋 ACCESS POLICY</div>
                        <div class="ot-node-sub">Authelia Rules</div>
                    </div>
                    <div class="ot-connector-down"></div>
                    <div class="ot-level ot-vm-level">
                        <div class="ot-node ot-vm">
                            <div class="ot-node-title">🔒 Protection Levels</div>
                            <div class="ot-node-items">
                                <div class="ot-item ot-svc">🟢 bypass (public)</div>
                                <div class="ot-item ot-svc">🟡 one_factor</div>
                                <div class="ot-item ot-svc">🔴 two_factor</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ot-branch">
                    <div class="ot-node ot-provider">
                        <div class="ot-node-title">👥 RBAC</div>
                        <div class="ot-node-sub">Role-Based</div>
                    </div>
                    <div class="ot-connector-down"></div>
                    <div class="ot-level ot-vm-level">
                        <div class="ot-node ot-vm">
                            <div class="ot-node-title">🏷️ User Groups</div>
                            <div class="ot-node-items">
                                <div class="ot-item ot-svc">👑 admins</div>
                                <div class="ot-item ot-svc">👤 users</div>
                                <div class="ot-item ot-svc">🔧 dev</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ot-branch">
                    <div class="ot-node ot-provider">
                        <div class="ot-node-title">🌐 DOMAIN RULES</div>
                        <div class="ot-node-sub">Per-Service</div>
                    </div>
                    <div class="ot-connector-down"></div>
                    <div class="ot-level ot-vm-level">
                        <div class="ot-node ot-vm">
                            <div class="ot-node-title">🔐 Protected</div>
                            <div class="ot-node-items">
                                <div class="ot-item ot-svc">📸 photos.app → 2FA</div>
                                <div class="ot-item ot-svc">🔀 proxy → admins</div>
                                <div class="ot-item ot-svc">📊 analytics → 2FA</div>
                            </div>
                        </div>
                        <div class="ot-node ot-vm">
                            <div class="ot-node-title">🌍 Public</div>
                            <div class="ot-node-items">
                                <div class="ot-item ot-svc">📧 mail → bypass</div>
                                <div class="ot-item ot-svc">🔔 ntfy → bypass</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>`;
            container.innerHTML = html;
        }

        // 3. NETWORK PROTECTION - "How is traffic secured?"
        function renderNetworkProtectionGraph() {
            const container = document.getElementById('graph-network-protection-container');
            if (!container) return;

            const html = `
            <div class="ot-level ot-root-level">
                <div class="ot-node ot-root">
                    <div class="ot-node-title">🌐 NETWORK PROTECTION</div>
                    <div class="ot-node-sub">"How is traffic secured?"</div>
                </div>
            </div>
            <div class="ot-connector-down"></div>
            <div class="ot-level ot-provider-level">
                <div class="ot-branch">
                    <div class="ot-node ot-provider">
                        <div class="ot-node-title">☁️ EDGE</div>
                        <div class="ot-node-sub">Cloudflare</div>
                    </div>
                    <div class="ot-connector-down"></div>
                    <div class="ot-level ot-vm-level">
                        <div class="ot-node ot-vm">
                            <div class="ot-node-title">🛡️ WAF</div>
                            <div class="ot-node-items">
                                <div class="ot-item ot-svc">🚫 DDoS Protection</div>
                                <div class="ot-item ot-svc">🤖 Bot Management</div>
                                <div class="ot-item ot-svc">🔒 SSL/TLS</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ot-branch">
                    <div class="ot-node ot-provider">
                        <div class="ot-node-title">🧱 FIREWALL</div>
                        <div class="ot-node-sub">Cloud + UFW</div>
                    </div>
                    <div class="ot-connector-down"></div>
                    <div class="ot-level ot-vm-level">
                        <div class="ot-node ot-vm">
                            <div class="ot-node-title">📋 Ingress Rules</div>
                            <div class="ot-node-items">
                                <div class="ot-item ot-svc">🔹 22 SSH</div>
                                <div class="ot-item ot-svc">🔹 80/443 HTTP/S</div>
                                <div class="ot-item ot-svc">🔹 51820 WireGuard</div>
                            </div>
                        </div>
                        <div class="ot-node ot-vm">
                            <div class="ot-node-title">📋 Egress Rules</div>
                            <div class="ot-node-items">
                                <div class="ot-item ot-svc">🔸 Default Allow</div>
                                <div class="ot-item ot-svc">🔸 DNS (53)</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ot-branch">
                    <div class="ot-node ot-provider">
                        <div class="ot-node-title">🔗 VPN MESH</div>
                        <div class="ot-node-sub">WireGuard</div>
                    </div>
                    <div class="ot-connector-down"></div>
                    <div class="ot-level ot-vm-level">
                        <div class="ot-node ot-vm">
                            <div class="ot-node-title">🌟 GCP Hub</div>
                            <div class="ot-node-sub">10.0.0.1</div>
                            <div class="ot-node-items">
                                <div class="ot-item ot-svc">🔹 OCI Dev (10.0.0.2)</div>
                                <div class="ot-item ot-svc">🔹 OCI Web (10.0.0.3)</div>
                                <div class="ot-item ot-svc">🔹 OCI Svc (10.0.0.4)</div>
                                <div class="ot-item ot-svc">🔹 Local (10.0.0.5)</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ot-branch">
                    <div class="ot-node ot-provider">
                        <div class="ot-node-title">🏗️ SEGMENTATION</div>
                        <div class="ot-node-sub">Docker Networks</div>
                    </div>
                    <div class="ot-connector-down"></div>
                    <div class="ot-level ot-vm-level">
                        <div class="ot-node ot-vm">
                            <div class="ot-node-title">🔒 Isolated Subnets</div>
                            <div class="ot-node-items">
                                <div class="ot-item ot-db">proxy (172.23.0.0/24)</div>
                                <div class="ot-item ot-db">mail (172.20.0.0/24)</div>
                                <div class="ot-item ot-db">matomo (172.21.0.0/24)</div>
                                <div class="ot-item ot-db">dev (172.24.0.0/24)</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>`;
            container.innerHTML = html;
        }

        // 4. DATA PROTECTION - "How is data secured?"
        function renderDataProtectionGraph() {
            const container = document.getElementById('graph-data-protection-container');
            if (!container) return;

            const html = `
            <div class="ot-level ot-root-level">
                <div class="ot-node ot-root">
                    <div class="ot-node-title">🔒 DATA PROTECTION</div>
                    <div class="ot-node-sub">"How is data secured?"</div>
                </div>
            </div>
            <div class="ot-connector-down"></div>
            <div class="ot-level ot-provider-level">
                <div class="ot-branch">
                    <div class="ot-node ot-provider">
                        <div class="ot-node-title">🔐 IN TRANSIT</div>
                        <div class="ot-node-sub">TLS Encryption</div>
                    </div>
                    <div class="ot-connector-down"></div>
                    <div class="ot-level ot-vm-level">
                        <div class="ot-node ot-vm">
                            <div class="ot-node-title">📜 Let's Encrypt</div>
                            <div class="ot-node-items">
                                <div class="ot-item ot-svc">🔒 TLS 1.3</div>
                                <div class="ot-item ot-svc">🔄 Auto-Renew</div>
                                <div class="ot-item ot-svc">🌐 Wildcard Certs</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ot-branch">
                    <div class="ot-node ot-provider">
                        <div class="ot-node-title">💾 AT REST</div>
                        <div class="ot-node-sub">Storage Encryption</div>
                    </div>
                    <div class="ot-connector-down"></div>
                    <div class="ot-level ot-vm-level">
                        <div class="ot-node ot-vm">
                            <div class="ot-node-title">🗄️ Volumes</div>
                            <div class="ot-node-items">
                                <div class="ot-item ot-db">🔐 Block Storage (OCI)</div>
                                <div class="ot-item ot-db">🔐 Persistent Disk (GCP)</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ot-branch">
                    <div class="ot-node ot-provider">
                        <div class="ot-node-title">🔄 SYNC</div>
                        <div class="ot-node-sub">Syncthing</div>
                    </div>
                    <div class="ot-connector-down"></div>
                    <div class="ot-level ot-vm-level">
                        <div class="ot-node ot-vm">
                            <div class="ot-node-title">📁 File Sync</div>
                            <div class="ot-node-items">
                                <div class="ot-item ot-svc">🔒 E2E Encrypted</div>
                                <div class="ot-item ot-svc">🔑 Device Keys</div>
                                <div class="ot-item ot-svc">📋 Version History</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ot-branch">
                    <div class="ot-node ot-provider">
                        <div class="ot-node-title">💼 BACKUP</div>
                        <div class="ot-node-sub">Recovery</div>
                    </div>
                    <div class="ot-connector-down"></div>
                    <div class="ot-level ot-vm-level">
                        <div class="ot-node ot-vm">
                            <div class="ot-node-title">📦 Strategy</div>
                            <div class="ot-node-items">
                                <div class="ot-item ot-svc">🗓️ Daily Snapshots</div>
                                <div class="ot-item ot-svc">🔄 DB Dumps</div>
                                <div class="ot-item ot-svc">☁️ Off-site Copy</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>`;
            container.innerHTML = html;
        }

        // 5. THREAT PROTECTION - "How do we stop attacks?"
        function renderThreatProtectionGraph() {
            const container = document.getElementById('graph-threat-protection-container');
            if (!container) return;

            const html = `
            <div class="ot-level ot-root-level">
                <div class="ot-node ot-root">
                    <div class="ot-node-title">🛡️ THREAT PROTECTION</div>
                    <div class="ot-node-sub">"How do we stop attacks?"</div>
                </div>
            </div>
            <div class="ot-connector-down"></div>
            <div class="ot-level ot-provider-level">
                <div class="ot-branch">
                    <div class="ot-node ot-provider">
                        <div class="ot-node-title">🦠 ANTIVIRUS</div>
                        <div class="ot-node-sub">YARA Rules</div>
                    </div>
                    <div class="ot-connector-down"></div>
                    <div class="ot-level ot-vm-level">
                        <div class="ot-node ot-vm">
                            <div class="ot-node-title">👁️ Sauron</div>
                            <div class="ot-node-items">
                                <div class="ot-item ot-svc">📡 inotify Watch</div>
                                <div class="ot-item ot-svc">🔍 Pattern Match</div>
                                <div class="ot-item ot-svc">🚨 Alert & Quarantine</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ot-branch">
                    <div class="ot-node ot-provider">
                        <div class="ot-node-title">🔬 CONTAINER SCAN</div>
                        <div class="ot-node-sub">Image Security</div>
                    </div>
                    <div class="ot-connector-down"></div>
                    <div class="ot-level ot-vm-level">
                        <div class="ot-node ot-vm">
                            <div class="ot-node-title">🐳 Docker</div>
                            <div class="ot-node-items">
                                <div class="ot-item ot-svc">📋 Official Images</div>
                                <div class="ot-item ot-svc">🔒 Non-root User</div>
                                <div class="ot-item ot-svc">📌 Pinned Versions</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ot-branch">
                    <div class="ot-node ot-provider">
                        <div class="ot-node-title">🚫 RATE LIMITING</div>
                        <div class="ot-node-sub">Abuse Prevention</div>
                    </div>
                    <div class="ot-connector-down"></div>
                    <div class="ot-level ot-vm-level">
                        <div class="ot-node ot-vm">
                            <div class="ot-node-title">⏱️ Limits</div>
                            <div class="ot-node-items">
                                <div class="ot-item ot-svc">🔄 Cloudflare Rules</div>
                                <div class="ot-item ot-svc">🔐 Auth Attempts</div>
                                <div class="ot-item ot-svc">📧 SMTP Throttle</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ot-branch">
                    <div class="ot-node ot-provider">
                        <div class="ot-node-title">🔐 SECRETS</div>
                        <div class="ot-node-sub">Credential Safety</div>
                    </div>
                    <div class="ot-connector-down"></div>
                    <div class="ot-level ot-vm-level">
                        <div class="ot-node ot-vm">
                            <div class="ot-node-title">🔑 Management</div>
                            <div class="ot-node-items">
                                <div class="ot-item ot-svc">📁 .env Files</div>
                                <div class="ot-item ot-svc">🔒 Docker Secrets</div>
                                <div class="ot-item ot-svc">🚫 No Git Commits</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>`;
            container.innerHTML = html;
        }

        // 6. OBSERVABILITY - "How do we see what's happening?"
        function renderObservabilityGraph() {
            const container = document.getElementById('graph-observability-container');
            if (!container) return;

            const html = `
            <div class="ot-level ot-root-level">
                <div class="ot-node ot-root">
                    <div class="ot-node-title">📊 OBSERVABILITY</div>
                    <div class="ot-node-sub">"How do we see what's happening?"</div>
                </div>
            </div>
            <div class="ot-connector-down"></div>
            <div class="ot-level ot-provider-level">
                <div class="ot-branch">
                    <div class="ot-node ot-provider">
                        <div class="ot-node-title">📋 LOGGING</div>
                        <div class="ot-node-sub">Centralized</div>
                    </div>
                    <div class="ot-connector-down"></div>
                    <div class="ot-level ot-vm-level">
                        <div class="ot-node ot-vm">
                            <div class="ot-node-title">📝 Sources</div>
                            <div class="ot-node-items">
                                <div class="ot-item ot-svc">🐳 Docker Logs</div>
                                <div class="ot-item ot-svc">🖥️ Syslog</div>
                                <div class="ot-item ot-svc">🔀 NPM Access Logs</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ot-branch">
                    <div class="ot-node ot-provider">
                        <div class="ot-node-title">📈 ANALYTICS</div>
                        <div class="ot-node-sub">Matomo</div>
                    </div>
                    <div class="ot-connector-down"></div>
                    <div class="ot-level ot-vm-level">
                        <div class="ot-node ot-vm">
                            <div class="ot-node-title">📊 oci-f-micro_2</div>
                            <div class="ot-node-items">
                                <div class="ot-item ot-svc">👁️ Page Views</div>
                                <div class="ot-item ot-svc">👤 Visitors</div>
                                <div class="ot-item ot-svc">🌍 Geo Data</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ot-branch">
                    <div class="ot-node ot-provider">
                        <div class="ot-node-title">🔔 ALERTING</div>
                        <div class="ot-node-sub">ntfy</div>
                    </div>
                    <div class="ot-connector-down"></div>
                    <div class="ot-level ot-vm-level">
                        <div class="ot-node ot-vm">
                            <div class="ot-node-title">📱 Push Notifications</div>
                            <div class="ot-node-items">
                                <div class="ot-item ot-svc">🚨 Security Events</div>
                                <div class="ot-item ot-svc">⚠️ System Alerts</div>
                                <div class="ot-item ot-svc">📧 Email Fallback</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ot-branch">
                    <div class="ot-node ot-provider">
                        <div class="ot-node-title">📊 METRICS</div>
                        <div class="ot-node-sub">Health Checks</div>
                    </div>
                    <div class="ot-connector-down"></div>
                    <div class="ot-level ot-vm-level">
                        <div class="ot-node ot-vm">
                            <div class="ot-node-title">💓 Uptime</div>
                            <div class="ot-node-items">
                                <div class="ot-item ot-svc">🔄 Service Status</div>
                                <div class="ot-item ot-svc">💾 Resource Usage</div>
                                <div class="ot-item ot-svc">📉 Response Times</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>`;
            container.innerHTML = html;
        }

        // Render Security Features Table
        function renderSecurityFeaturesTable() {
            const table = document.getElementById('security-features-table');
            if (!table) return;

            const securityFeatures = [
                { category: 'Authentication', feature: 'Authelia 2FA', description: 'Multi-factor authentication gateway', location: 'gcp-f-micro_1', status: 'Active' },
                { category: 'Authentication', feature: 'OIDC/SSO', description: 'Single Sign-On via OpenID Connect', location: 'gcp-f-micro_1', status: 'Active' },
                { category: 'Authentication', feature: 'Session Management', description: 'Encrypted session tokens with Redis', location: 'gcp-f-micro_1', status: 'Active' },
                { category: 'Authorization', feature: 'RBAC Policies', description: 'Role-based access control rules', location: 'Authelia Config', status: 'Active' },
                { category: 'Authorization', feature: 'Domain-based Rules', description: 'Per-domain access policies', location: 'NPM/Authelia', status: 'Active' },
                { category: 'Network', feature: 'Cloudflare Proxy', description: 'Edge DDoS protection and CDN', location: 'Cloud Edge', status: 'Active' },
                { category: 'Network', feature: 'Cloud Firewalls', description: 'OCI/GCP ingress rules', location: 'All VMs', status: 'Active' },
                { category: 'Network', feature: 'UFW Host Firewall', description: 'Local iptables rules', location: 'All VMs', status: 'Active' },
                { category: 'Network', feature: 'Docker Network Isolation', description: 'Bridge network segmentation', location: 'All VMs', status: 'Active' },
                { category: 'Network', feature: 'TLS/SSL Termination', description: 'Let\'s Encrypt certificates via NPM', location: 'gcp-f-micro_1', status: 'Active' },
                { category: 'Data Protection', feature: 'TLS 1.3 In Transit', description: 'Encrypted data transmission', location: 'All Services', status: 'Active' },
                { category: 'Data Protection', feature: 'Database Encryption', description: 'SQLite/PostgreSQL encryption at rest', location: 'All VMs', status: 'Active' },
                { category: 'Data Protection', feature: 'Syncthing E2E', description: 'End-to-end file sync encryption', location: 'oci-p-flex_1', status: 'Active' },
                { category: 'Threat Protection', feature: 'NPM Block Exploits', description: 'Common exploit pattern blocking', location: 'gcp-f-micro_1', status: 'Active' },
                { category: 'Threat Protection', feature: 'Rate Limiting', description: 'Request throttling per IP', location: 'NPM/Cloudflare', status: 'Active' },
                { category: 'Threat Protection', feature: 'Secrets Management', description: 'Environment variables isolation', location: 'Docker Compose', status: 'Active' },
                { category: 'Observability', feature: 'Matomo Analytics', description: 'Privacy-focused web analytics', location: 'oci-f-micro_2', status: 'Active' },
                { category: 'Observability', feature: 'ntfy Alerting', description: 'Push notification for events', location: 'gcp-f-micro_1', status: 'Active' },
                { category: 'Observability', feature: 'Docker Logging', description: 'Container log aggregation', location: 'All VMs', status: 'Active' },
                { category: 'Observability', feature: 'Access Logs', description: 'NPM request logging', location: 'gcp-f-micro_1', status: 'Active' }
            ];

            let html = `
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Feature</th>
                        <th>Description</th>
                        <th>Location</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>`;

            securityFeatures.forEach(item => {
                const statusClass = item.status === 'Active' ? 'status-active' : 'status-inactive';
                html += `
                    <tr>
                        <td><span class="category-badge">${item.category}</span></td>
                        <td>${item.feature}</td>
                        <td>${item.description}</td>
                        <td><code>${item.location}</code></td>
                        <td><span class="${statusClass}">${item.status}</span></td>
                    </tr>`;
            });

            html += '</tbody>';
            table.innerHTML = html;
        }

        // Tab Switching with Lazy Loading
        function initTabs() {
            const headerButtons = document.querySelectorAll('[data-dash-tab]');
            const parentButtons = document.querySelectorAll('[data-dash-parent]');
            const tabContents = document.querySelectorAll('.tab-content');
            const loadedTabs = { resources: true };
            const validTabs = ['status', 'resources', 'cost', 'apps', 'security', 'infra', 'audit-analytics', 'audit-logs', 'capacity', 'profiling'];
            // Map legacy tab names to new names
            const tabAliases = { 'performance': 'resources' };
            // Map tabs to their parent groups
            const tabToParent = {
                'infra': 'topology',
                'resources': 'health',
                'profiling': 'health',
                'security': 'security',
                'audit-analytics': 'security',
                'audit-logs': 'security',
                'cost': 'ops',
                'capacity': 'ops'
            };

            function hideAllLevel3Navs() {
                const navTopology = document.getElementById('nav-topology');
                const navHealth = document.getElementById('nav-health');
                const navSecurity = document.getElementById('nav-security');
                const navOps = document.getElementById('nav-ops');
                const navApps = document.getElementById('nav-apps');
                const navGraph = document.getElementById('nav-graph');
                const navResource = document.getElementById('nav-resource');
                const navSecurityTopo = document.getElementById('nav-security-topo');
                const navResourceTables = document.getElementById('nav-resource-tables');
                const navCostSubtabs = document.getElementById('nav-cost-subtabs');
                if (navTopology) navTopology.style.display = 'none';
                if (navHealth) navHealth.style.display = 'none';
                if (navSecurity) navSecurity.style.display = 'none';
                if (navOps) navOps.style.display = 'none';
                if (navApps) navApps.style.display = 'none';
                if (navGraph) navGraph.style.display = 'none';
                if (navResource) navResource.style.display = 'none';
                if (navSecurityTopo) navSecurityTopo.style.display = 'none';
                if (navResourceTables) navResourceTables.style.display = 'none';
                if (navCostSubtabs) navCostSubtabs.style.display = 'none';
            }

            function switchTab(targetTab) {
                try {
                    // Handle legacy tab names
                    if (tabAliases[targetTab]) targetTab = tabAliases[targetTab];

                    // Find the target tab content
                    const targetTabEl = document.getElementById(`${targetTab}-tab`);
                    if (!targetTabEl) {
                        console.error(`Tab content not found: ${targetTab}-tab`);
                        return;
                    }

                    // Update header buttons and tab contents
                    headerButtons.forEach(b => b.classList.remove('active'));
                    parentButtons.forEach(b => b.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));

                    // Activate the selected tab
                    document.querySelectorAll(`[data-dash-tab="${targetTab}"]`).forEach(b => b.classList.add('active'));
                    targetTabEl.classList.add('active');

                    // Handle level 3 navigation visibility
                    hideAllLevel3Navs();

                    // Show appropriate level 3 nav and activate parent button
                    const parentGroup = tabToParent[targetTab];
                    if (parentGroup === 'topology') {
                        const navTopology = document.getElementById('nav-topology');
                        if (navTopology) navTopology.style.display = 'flex';
                        document.querySelector('[data-dash-parent="topology"]')?.classList.add('active');
                        // Show Level 4 navigation based on current category
                        if (currentCategory === 'resource') {
                            const navResource = document.getElementById('nav-resource');
                            if (navResource) navResource.style.display = 'flex';
                            // Show Level 5 if Tables is selected
                            if (currentResourceView === 'tables') {
                                const navResourceTables = document.getElementById('nav-resource-tables');
                                if (navResourceTables) navResourceTables.style.display = 'flex';
                            }
                        } else if (currentCategory === 'security') {
                            const navSecurityTopo = document.getElementById('nav-security-topo');
                            if (navSecurityTopo) navSecurityTopo.style.display = 'flex';
                        }
                        // Trigger view update
                        updateInfraView();
                    } else if (parentGroup === 'health') {
                        const navHealth = document.getElementById('nav-health');
                        if (navHealth) navHealth.style.display = 'flex';
                        document.querySelector('[data-dash-parent="health"]')?.classList.add('active');
                    } else if (parentGroup === 'security') {
                        const navSecurity = document.getElementById('nav-security');
                        if (navSecurity) navSecurity.style.display = 'flex';
                        document.querySelector('[data-dash-parent="security"]')?.classList.add('active');
                    } else if (parentGroup === 'ops') {
                        const navOps = document.getElementById('nav-ops');
                        if (navOps) navOps.style.display = 'flex';
                        document.querySelector('[data-dash-parent="ops"]')?.classList.add('active');
                        // Show cost sub-tabs if cost tab is selected
                        if (targetTab === 'cost') {
                            const navCostSubtabs = document.getElementById('nav-cost-subtabs');
                            if (navCostSubtabs) navCostSubtabs.style.display = 'flex';
                        }
                    } else if (targetTab === 'apps') {
                        const navApps = document.getElementById('nav-apps');
                        if (navApps) navApps.style.display = 'flex';
                        document.querySelector('[data-dash-tab="apps"]')?.classList.add('active');
                    }

                    // Update URL hash
                    window.history.replaceState(null, null, `#${targetTab}`);

                    if (!loadedTabs[targetTab]) {
                        loadedTabs[targetTab] = true;
                        if (targetTab === 'cost') loadCostData();
                        else if (targetTab === 'resources') loadResourcesData();
                        else if (targetTab === 'infra') loadInfraData();
                    }
                } catch (error) {
                    console.error('Error switching tab:', error);
                }
            }

            // Handle parent buttons (Topology, Health, Security, Ops) - click switches to first child tab
            parentButtons.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    const parentGroup = btn.getAttribute('data-dash-parent');
                    // Switch to the first tab in this group
                    if (parentGroup === 'topology') switchTab('infra');
                    else if (parentGroup === 'health') switchTab('resources');
                    else if (parentGroup === 'security') switchTab('security');
                    else if (parentGroup === 'ops') switchTab('cost');
                });
            });

            // Handle header monitoring buttons
            console.log('Setting up tab buttons, found:', headerButtons.length);
            headerButtons.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetTab = btn.getAttribute('data-dash-tab');
                    console.log('Tab clicked:', targetTab);
                    switchTab(targetTab);
                });
            });

            // Handle URL hash on page load
            const hash = window.location.hash.slice(1);
            if (hash && (validTabs.includes(hash) || tabAliases[hash])) {
                switchTab(hash);
            }

            // Handle hash changes (browser back/forward)
            window.addEventListener('hashchange', () => {
                const newHash = window.location.hash.slice(1);
                if (newHash && (validTabs.includes(newHash) || tabAliases[newHash])) {
                    switchTab(newHash);
                }
            });
        }

        // Cost Sub-tab Switching
        function initCostSubtabs() {
            const subtabButtons = document.querySelectorAll('#nav-cost-subtabs [data-subtab]');
            const subtabContents = document.querySelectorAll('.cost-subtab-content');

            subtabButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const targetSubtab = btn.getAttribute('data-subtab');
                    subtabButtons.forEach(b => b.classList.remove('active'));
                    subtabContents.forEach(c => c.classList.remove('active'));
                    btn.classList.add('active');
                    document.getElementById(targetSubtab).classList.add('active');
                });
            });
        }

        // Status Sub-tab Switching (Frontend/Backend)
        function initStatusSubtabs() {
            const subtabButtons = document.querySelectorAll('.status-subtab-btn');
            const subtabContents = document.querySelectorAll('.status-subtab-content');

            subtabButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const targetSubtab = btn.getAttribute('data-subtab');
                    subtabButtons.forEach(b => b.classList.remove('active'));
                    subtabContents.forEach(c => c.classList.remove('active'));
                    btn.classList.add('active');
                    document.getElementById(targetSubtab).classList.add('active');
                });
            });
        }

        // View Toggle (Cards/List) - Note: This is a placeholder
        // Actual cards view implementation would require additional HTML structure
        function initViewToggles() {
            const toggleGroups = document.querySelectorAll('.view-toggle-inline');

            toggleGroups.forEach(group => {
                const buttons = group.querySelectorAll('.view-toggle-btn');
                buttons.forEach(btn => {
                    btn.addEventListener('click', () => {
                        buttons.forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        // View switching logic would go here
                        // For now, just toggle the active state
                    });
                });
            });
        }

        // App Card Tilt Effect (water board physics)
        function initAppCardTilt() {
            const appCards = document.querySelectorAll('.app-card');
            const intensity = 8;
            const scale = 1.01;
            const lift = 8;

            appCards.forEach(card => {
                card.style.transition = 'transform 0.15s ease-out';

                card.addEventListener('mouseenter', () => {
                    card.style.zIndex = '10';
                });

                card.addEventListener('mouseleave', () => {
                    card.style.zIndex = '1';
                    card.style.transform = 'translateY(0) scale(1) rotateX(0) rotateY(0)';
                });

                card.addEventListener('mousemove', (e) => {
                    const rect = card.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    const centerX = rect.width / 2;
                    const centerY = rect.height / 2;
                    const rotateX = (y - centerY) / intensity;
                    const rotateY = (centerX - x) / intensity;

                    card.style.transform = `
                        translateY(-${lift}px)
                        scale(${scale})
                        perspective(1000px)
                        rotateX(${rotateX}deg)
                        rotateY(${rotateY}deg)
                    `;
                });
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            checkExistingLogin();
            handleOAuthCallback();
            initRebootButtons();

            // Render tables from CONFIG/INFRASTRUCTURE FIRST (before initTabs which may switch tabs)
            // This ensures CONFIG is set before any tab tries to use it
            if (typeof INFRASTRUCTURE !== 'undefined' || typeof CONFIG !== 'undefined') {
                renderTablesFromConfig();
            }

            initTabs();
            initCostSubtabs();
            initInfraViewToggle();
            initAutoRefresh();
            initAppCardTilt();

            // Check dev server status if not on GitHub Pages
            if (!isGitHubPages) {
                checkDevServerStatus();
            }

            // Refresh data: tries API first, falls back to local .js files on error
            refreshAll();

            // Start auto-refresh if enabled
            const autoRefreshCheckbox = document.getElementById('auto-refresh');
            if (autoRefreshCheckbox && autoRefreshCheckbox.checked) {
                autoRefreshInterval = setInterval(refreshAll, 30000);
            }
        });
    </script>

    <!-- Live Monitoring Bar (Bottom) -->
    <div class="dashboard-header" style="position: fixed; bottom: 0; left: 0; right: 0; z-index: 100; border-top: 1px solid var(--border-color); border-radius: 0; margin: 0; padding: 0.5rem 1rem;">
        <div class="dashboard-title">
            <div class="status-dot" id="connection-status"></div>
            <h2 style="font-size: 0.85rem;">Live Monitoring</h2>
        </div>
        <div class="dashboard-controls">
            <span class="last-updated">Last: <span id="last-updated">--:--:--</span></span>
            <label class="auto-refresh-toggle">
                <input type="checkbox" id="auto-refresh" checked>
                Auto (30s)
            </label>
            <button class="refresh-btn" id="refresh-btn" onclick="refreshAll()">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M23 4v6h-6M1 20v-6h6"/>
                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                </svg>
                Refresh
            </button>
            <div class="auth-buttons">
                <a href="https://auth.diegonmarcos.com/oauth2/start?rd=https://cloud.diegonmarcos.com/cloud_dash.html" class="github-login-btn" title="Login with GitHub SSO">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/>
                    </svg>
                    <span>SSO</span>
                </a>
                <a href="https://auth.diegonmarcos.com/authelia/" class="authelia-login-btn" title="Backup: Local TOTP 2FA">
                    <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                        <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/>
                    </svg>
                    <span>TOTP</span>
                </a>
            </div>
        </div>
    </div>

    <!-- Mobile Desktop Mode -->
    <script>
        (function() {
            function applyMobileScaling() {
                const desktopWidth = 1200;
                const screenWidth = window.innerWidth;

                if (screenWidth < desktopWidth) {
                    const scale = screenWidth / desktopWidth;
                    document.body.style.width = desktopWidth + 'px';
                    document.body.style.minWidth = desktopWidth + 'px';
                    document.body.style.transform = 'scale(' + scale + ')';
                    document.body.style.transformOrigin = 'top left';
                    document.documentElement.style.width = screenWidth + 'px';
                    document.documentElement.style.overflowX = 'hidden';
                } else {
                    document.body.style.width = '';
                    document.body.style.minWidth = '';
                    document.body.style.transform = '';
                    document.body.style.transformOrigin = '';
                    document.documentElement.style.width = '';
                    document.documentElement.style.overflowX = '';
                }
            }
            applyMobileScaling();
            window.addEventListener('resize', applyMobileScaling);
        })();
    </script>

    <!-- TypeScript compiled bundle (zoom, theme, card effects) -->
    <script src="script.js"></script>
</body>
</html>
