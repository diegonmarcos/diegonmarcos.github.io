{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/diego/Documents/Git/front-Github_io/mymaps/src/components/CityMap.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState, useRef } from 'react';\nimport { MapContainer, TileLayer, Marker, Popup, useMap } from 'react-leaflet';\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\nimport * as toGeoJSON from '@mapbox/togeojson';\n\n// Fix for Leaflet default marker icons\nconst iconRetinaUrl = 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png';\nconst iconUrl = 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png';\nconst shadowUrl = 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png';\n\ndelete (L.Icon.Default.prototype as any)._getIconUrl;\nL.Icon.Default.mergeOptions({\n  iconRetinaUrl,\n  iconUrl,\n  shadowUrl,\n});\n\nfunction LocationMarker() {\n  const [position, setPosition] = useState<L.LatLng | null>(null);\n  const map = useMap();\n  const initializedRef = useRef(false);\n\n  useEffect(() => {\n    map.locate({ watch: true, enableHighAccuracy: true });\n\n    const onLocationFound = (e: L.LocationEvent) => {\n      setPosition(e.latlng);\n      if (!initializedRef.current) {\n        map.flyTo(e.latlng, 13); // Zoom level 13 for city view\n        initializedRef.current = true;\n      }\n    };\n\n    const onLocationError = (e: L.ErrorEvent) => {\n      console.error(\"Location access denied or failed:\", e.message);\n    };\n\n    map.on(\"locationfound\", onLocationFound);\n    map.on(\"locationerror\", onLocationError);\n\n    return () => {\n      map.off(\"locationfound\", onLocationFound);\n      map.off(\"locationerror\", onLocationError);\n      map.stopLocate();\n    };\n  }, [map]);\n\n  return position === null ? null : (\n    <Marker position={position}>\n      <Popup>You are here</Popup>\n    </Marker>\n  );\n}\n\nconst BASE_PATH = '/mymaps';\n\nexport default function CityMap() {\n  const [geoJsonData, setGeoJsonData] = useState<any>(null);\n\n  useEffect(() => {\n    fetch(`${BASE_PATH}/city_map/doc.kml`)\n      .then((response) => {\n        if (!response.ok) {\n          throw new Error(`Failed to fetch KML: ${response.statusText}`);\n        }\n        return response.text();\n      })\n      .then((text) => {\n        const parser = new DOMParser();\n        const kml = parser.parseFromString(text, 'text/xml');\n        const geojson = toGeoJSON.kml(kml);\n        setGeoJsonData(geojson);\n      })\n      .catch((error) => {\n        console.error('Error loading KML:', error);\n      });\n  }, []);\n\n  // Custom Icons defined inside component to access BASE_PATH if it were dynamic, \n  // but here it is static. defining them here for clarity.\n  const visitedIcon = new L.Icon({\n    iconUrl: `${BASE_PATH}/city_map/images/icon-1.png`,\n    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',\n    iconSize: [25, 41],\n    iconAnchor: [12, 41],\n    popupAnchor: [1, -34],\n    shadowSize: [41, 41]\n  });\n\n  const plannedIcon = new L.Icon({\n    iconUrl: `${BASE_PATH}/city_map/images/icon-2.png`,\n    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',\n    iconSize: [25, 41],\n    iconAnchor: [12, 41],\n    popupAnchor: [1, -34],\n    shadowSize: [41, 41]\n  });\n\n  const getIcon = (styleUrl: string) => {\n    if (styleUrl && styleUrl.includes('icon-1501')) {\n      return visitedIcon; // Gone / Visited\n    }\n    if (styleUrl && styleUrl.includes('icon-1502')) {\n      return plannedIcon; // Planned\n    }\n    return new L.Icon.Default();\n  };\n\n  return (\n    <div className=\"city-map-container\">\n      <MapContainer\n        center={[0, 0]} // Default center\n        zoom={2}\n        style={{ height: '100%', width: '100%' }}\n      >\n        <TileLayer\n          attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n          url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n        />\n        \n        <LocationMarker />\n\n        {geoJsonData && (\n          geoJsonData.features.map((feature: any, index: number) => {\n            if (feature.geometry.type === 'Point') {\n               const [lng, lat] = feature.geometry.coordinates;\n               const icon = getIcon(feature.properties.styleUrl);\n               \n               return (\n                 <Marker key={index} position={[lat, lng]} icon={icon}>\n                   <Popup>\n                     <h3>{feature.properties.name}</h3>\n                     <div dangerouslySetInnerHTML={{ __html: feature.properties.description || '' }} />\n                   </Popup>\n                 </Marker>\n               );\n            }\n            return null;\n          })\n        )}\n      </MapContainer>\n      \n      {/* Legend Overlay */}\n      <div className=\"city-map-legend\">\n        <h4>Legend</h4>\n        <div className=\"legend-item\">\n          <img src={`${BASE_PATH}/city_map/images/icon-1.png`} alt=\"Visited\" />\n          <span>Visited (Gone)</span>\n        </div>\n        <div className=\"legend-item\">\n          <img src={`${BASE_PATH}/city_map/images/icon-2.png`} alt=\"Planned\" />\n          <span>Planned</span>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}