{
  "$schema": "cloud-api-spec",
  "version": "1.0.0",
  "title": "Cloud Architecture API",
  "description": "REST API endpoints for cloud_architecture.json - static infrastructure definitions (VMs, services, domains, networks)",
  "lastUpdated": "2025-12-23",

  "_meta": {
    "generator": "flask-app",
    "vmId": "gcp-f-micro_1",
    "source": "cloud_architecture.json",
    "related": "cloud_control_api.json"
  },

  "server": {
    "production": {
      "baseUrl": "https://api.diegonmarcos.com",
      "description": "Production API via NPM proxy"
    },
    "internal": {
      "baseUrl": "http://127.0.0.1:5000",
      "description": "Direct Flask access (internal only)"
    },
    "dev": {
      "baseUrl": "http://localhost:5000",
      "description": "Local development"
    }
  },

  "auth": {
    "type": "bearer",
    "provider": "authelia",
    "tokenEndpoint": "https://auth.diegonmarcos.com/api/oidc/token",
    "header": "Authorization: Bearer <token>",
    "scopes": {
      "read": "Read-only access to all data",
      "write": "Modify runtime status and trigger actions",
      "admin": "Full access including VM control"
    }
  },

  "endpoints": {

    "health": {
      "_description": "API health and status checks",

      "ping": {
        "method": "GET",
        "path": "/health",
        "auth": "none",
        "description": "Simple health check",
        "response": {
          "status": "ok",
          "timestamp": "2025-12-23T15:30:00Z",
          "version": "1.0.0"
        },
        "curl": "curl https://api.diegonmarcos.com/health"
      },

      "ready": {
        "method": "GET",
        "path": "/health/ready",
        "auth": "none",
        "description": "Readiness check (DB, cache connections)",
        "response": {
          "ready": true,
          "checks": {
            "database": "ok",
            "cache": "ok",
            "fileSystem": "ok"
          }
        }
      }
    },

    "architecture": {
      "_description": "Access cloud_architecture.json data (static infrastructure definitions)",
      "_source": "cloud_architecture.json",

      "full": {
        "method": "GET",
        "path": "/architecture",
        "auth": "read",
        "description": "Get complete architecture.json",
        "response": "cloud_architecture.json (entire file)",
        "curl": "curl -H 'Authorization: Bearer $TOKEN' https://api.diegonmarcos.com/architecture"
      },

      "overview": {
        "method": "GET",
        "path": "/architecture/overview",
        "auth": "read",
        "description": "Get partI_overview section",
        "response": "cloud_architecture.partI_overview",
        "fields": ["providers", "activeServicesSummary", "proxyAdmin"]
      },

      "infrastructure": {
        "method": "GET",
        "path": "/architecture/infrastructure",
        "auth": "read",
        "description": "Get partII_infrastructure section",
        "response": "cloud_architecture.partII_infrastructure",
        "fields": ["vmCategories", "virtualMachines", "serviceCategories", "services", "dockerNetworks"]
      },

      "security": {
        "method": "GET",
        "path": "/architecture/security",
        "auth": "read",
        "description": "Get partIII_security section",
        "response": "cloud_architecture.partIII_security",
        "fields": ["domains", "firewallRules", "authentication"]
      },

      "data": {
        "method": "GET",
        "path": "/architecture/data",
        "auth": "read",
        "description": "Get partIV_data section",
        "response": "cloud_architecture.partIV_data",
        "fields": ["databases", "objectStorage", "rcloneRemotes"]
      },

      "operations": {
        "method": "GET",
        "path": "/architecture/operations",
        "auth": "read",
        "description": "Get partV_operations section",
        "response": "cloud_architecture.partV_operations",
        "fields": ["sshCommands", "dockerCommands", "monitoringCommands", "statusLegend"]
      },

      "reference": {
        "method": "GET",
        "path": "/architecture/reference",
        "auth": "read",
        "description": "Get partVI_reference section",
        "response": "cloud_architecture.partVI_reference",
        "fields": ["costs", "wakeOnDemand", "portMapping", "dockerImages"]
      },

      "version": {
        "method": "GET",
        "path": "/architecture/version",
        "auth": "none",
        "description": "Get architecture version and metadata",
        "response": {
          "version": "7.0.0",
          "lastUpdated": "2025-12-23",
          "owner": "Diego Nepomuceno Marcos"
        }
      }
    },

    "vms": {
      "_description": "Virtual machine definitions (static data)",
      "_source": "cloud_architecture.partII_infrastructure.virtualMachines",

      "list": {
        "method": "GET",
        "path": "/vms",
        "auth": "read",
        "description": "List all virtual machines",
        "query": {
          "provider": {"type": "string", "enum": ["oracle", "gcloud"], "description": "Filter by provider"},
          "status": {"type": "string", "enum": ["active", "stopped"], "description": "Filter by status"},
          "availability": {"type": "string", "enum": ["24/7", "wake-on-demand"], "description": "Filter by availability"}
        },
        "response": "cloud_architecture.partII_infrastructure.virtualMachines[]",
        "curl": "curl -H 'Authorization: Bearer $TOKEN' https://api.diegonmarcos.com/vms"
      },

      "get": {
        "method": "GET",
        "path": "/vms/{vmId}",
        "auth": "read",
        "description": "Get single VM details",
        "params": {
          "vmId": {"type": "string", "required": true, "enum": ["oci-f-micro_1", "oci-f-micro_2", "gcp-f-micro_1", "oci-p-flex_1"]}
        },
        "response": "cloud_architecture.partII_infrastructure.virtualMachines[vmId]",
        "curl": "curl -H 'Authorization: Bearer $TOKEN' https://api.diegonmarcos.com/vms/oci-p-flex_1"
      },

      "ssh": {
        "method": "GET",
        "path": "/vms/{vmId}/ssh",
        "auth": "read",
        "description": "Get SSH connection command for VM",
        "response": {
          "vmId": "oci-p-flex_1",
          "command": "ssh -i ~/.ssh/id_rsa ubuntu@84.235.234.87",
          "user": "ubuntu",
          "ip": "84.235.234.87"
        }
      }
    },

    "services": {
      "_description": "Service definitions (static data)",
      "_source": "cloud_architecture.partII_infrastructure.services",

      "list": {
        "method": "GET",
        "path": "/services",
        "auth": "read",
        "description": "List all services",
        "query": {
          "vmId": {"type": "string", "description": "Filter by VM"},
          "category": {"type": "string", "enum": ["user-productivity", "coder", "infra-proxy", "infra-auth", "infra-db", "infra-services"]},
          "status": {"type": "string", "enum": ["on", "off", "wake"]}
        },
        "response": "cloud_architecture.partII_infrastructure.services[]"
      },

      "get": {
        "method": "GET",
        "path": "/services/{serviceId}",
        "auth": "read",
        "description": "Get single service details",
        "params": {
          "serviceId": {"type": "string", "required": true}
        },
        "response": "cloud_architecture.partII_infrastructure.services[serviceId]"
      }
    },

    "domains": {
      "_description": "Domain configuration (static data)",
      "_source": "cloud_architecture.partIII_security.domains",

      "list": {
        "method": "GET",
        "path": "/domains",
        "auth": "read",
        "description": "List all domains and subdomains",
        "response": "cloud_architecture.partIII_security.domains.subdomains"
      },

      "get": {
        "method": "GET",
        "path": "/domains/{domain}",
        "auth": "read",
        "description": "Get domain configuration",
        "params": {
          "domain": {"type": "string", "required": true, "example": "photos.diegonmarcos.com"}
        },
        "response": "cloud_architecture.partIII_security.domains.subdomains[domain]"
      }
    },

    "index": {
      "_description": "API discovery and metadata",

      "root": {
        "method": "GET",
        "path": "/",
        "auth": "none",
        "description": "API root - returns available endpoints",
        "response": {
          "name": "Cloud Architecture API",
          "version": "1.0.0",
          "docs": "/api/docs",
          "health": "/health",
          "endpoints": ["/architecture", "/vms", "/services", "/domains"]
        }
      },

      "docs": {
        "method": "GET",
        "path": "/api/docs",
        "auth": "none",
        "description": "Get API specification",
        "response": "cloud_architecture_api.json"
      }
    }
  },

  "schemas": {
    "VirtualMachine": {
      "type": "object",
      "required": ["id", "name", "provider", "network"],
      "properties": {
        "id": {"type": "string", "pattern": "^(oci|gcp)-[a-z]+-[a-z]+_[0-9]+$"},
        "name": {"type": "string"},
        "displayName": {"type": "string"},
        "provider": {"type": "string", "enum": ["oracle", "gcloud"]},
        "category": {"type": "string", "enum": ["services", "ml"]},
        "instanceType": {"type": "string"},
        "specs": {
          "type": "object",
          "properties": {
            "cpu": {"type": "string"},
            "ram": {"type": "string"},
            "storage": {"type": "string"}
          }
        },
        "network": {
          "type": "object",
          "properties": {
            "publicIp": {"type": "string", "format": "ipv4"},
            "dockerNetwork": {"type": "string"},
            "dockerSubnet": {"type": "string"}
          }
        },
        "availability": {"type": "string", "enum": ["24/7", "wake-on-demand"]},
        "cost": {
          "type": "object",
          "properties": {
            "monthly": {"type": "number"},
            "currency": {"type": "string", "default": "USD"}
          }
        }
      }
    },

    "Service": {
      "type": "object",
      "required": ["id", "displayName", "category", "vmId"],
      "properties": {
        "id": {"type": "string"},
        "displayName": {"type": "string"},
        "category": {"type": "string"},
        "vmId": {"type": "string"},
        "containers": {"type": "array", "items": {"type": "string"}},
        "technology": {"type": "object"},
        "urls": {"type": "object"},
        "authRequired": {"type": "boolean", "default": false},
        "resources": {"type": "object"}
      }
    },

    "Domain": {
      "type": "object",
      "required": ["service", "ssl"],
      "properties": {
        "service": {"type": "string"},
        "vmId": {"type": "string"},
        "proxyVia": {"type": "string"},
        "ssl": {"type": "boolean"},
        "auth": {"type": "string", "enum": ["none", "authelia", "native"]}
      }
    },

    "ApiError": {
      "type": "object",
      "properties": {
        "error": {"type": "string"},
        "code": {"type": "string"},
        "message": {"type": "string"},
        "details": {"type": "object"}
      }
    }
  },

  "errors": {
    "400": {"code": "BAD_REQUEST", "message": "Invalid request parameters"},
    "401": {"code": "UNAUTHORIZED", "message": "Missing or invalid authentication token"},
    "403": {"code": "FORBIDDEN", "message": "Insufficient permissions for this action"},
    "404": {"code": "NOT_FOUND", "message": "Resource not found"},
    "500": {"code": "INTERNAL_ERROR", "message": "Internal server error"}
  },

  "rateLimits": {
    "default": {"requests": 100, "window": "1m"},
    "auth": {"requests": 10, "window": "1m"}
  },

  "_index": {
    "endpointCount": 18,
    "categories": ["health", "architecture", "vms", "services", "domains", "index"],
    "authLevels": {
      "none": ["health.ping", "health.ready", "architecture.version", "index.root", "index.docs"],
      "read": ["All other GET endpoints"]
    },
    "dataSource": "cloud_architecture.json"
  }
}
