(()=>{function T(){document.addEventListener("mousemove",t=>{let e=document.querySelectorAll(".doc-icon"),o=document.querySelectorAll(".glow-spot"),n=(t.clientX/window.innerWidth-.5)*30,s=(t.clientY/window.innerHeight-.5)*30;e.forEach((i,c)=>{let l=(c%4+1)*.4,h=n*.1*l;i.style.transform=`translate(${n*l}px, ${s*l}px) rotate(${h}deg)`}),o.forEach((i,c)=>{let l=(c+1)*.15;i.style.transform=`translate(${n*l}px, ${s*l}px) scale(${1+Math.abs(n*.002)})`})})}function m(){let t=document.querySelector(".service-table.active"),e=t?t.querySelector(".service-option.active"):null,o=document.querySelector(".auth-btn.active"),n=e&&e.dataset.name||"Service",s=e&&e.dataset.url||"#",i=e&&e.dataset.config||"#",c=o&&o.dataset.authPrefix||"",l=e?e.querySelector(".service-desc"):null,h=l&&l.textContent||"",b=document.getElementById("tool-name-app"),C=document.getElementById("go-app-btn"),L=document.getElementById("go-config-btn"),w=document.getElementById("info-app-name"),S=document.getElementById("info-app-desc");b&&(b.textContent=n),C&&(C.href=c?c+encodeURIComponent(s):s),L&&(L.href=c?c+encodeURIComponent(i):i),w&&(w.textContent=n),S&&(S.textContent=h)}var V=["theme-sheets","theme-docs","theme-slides","theme-photos","theme-files","theme-notes","theme-lgtm","theme-powersheets","theme-videos"];function M(t){document.body.classList.remove(...V),document.body.classList.add("theme-"+t)}function x(){let t=document.querySelectorAll(".category-tabs .category-tab, .category-tabs-row2 .category-tab"),e=document.querySelectorAll(".service-table");t.forEach(o=>{o.addEventListener("click",function(){let n=this.dataset.category;n&&(t.forEach(s=>s.classList.remove("active")),this.classList.add("active"),e.forEach(s=>{s.classList.remove("active"),s.dataset.category===n&&s.classList.add("active")}),M(n),m())})}),e.forEach(o=>{let n=o.querySelectorAll(".service-option:not(.coming-soon):not(.not-deployed)");n.forEach(s=>{s.addEventListener("click",function(){n.forEach(i=>i.classList.remove("active")),this.classList.add("active"),m()})})}),M("notes")}function A(){let t=document.querySelectorAll(".auth-btn");t.forEach(e=>{e.addEventListener("click",function(){t.forEach(o=>o.classList.remove("active")),this.classList.add("active"),m()})})}var f="https://api.diegonmarcos.com",B="oci-flex",u=null,v=null,$=null,H=null,I=null,g=null,E=null,r=null;async function y(){if(u)return u;try{console.debug("[vmControl] discovering VM via /rust/health/ids ...");let t=await fetch(`${f}/rust/health/ids`,{signal:AbortSignal.timeout(1e4)});if(!t.ok)return console.debug("[vmControl] discovery HTTP",t.status),null;let e=await t.json();console.debug("[vmControl] discovered VMs:",Object.keys(e.vms||{}));for(let[o,n]of Object.entries(e.vms||{}))if(n.label===B)return u=o,v=`${f}/rust/health/up/${o}`,$=`${f}/rust/vms/${o}/start`,H=`${f}/rust/vms/${o}/stop`,I=`${f}/rust/vms/${o}/reset`,console.debug("[vmControl] matched VM:",o),o;console.debug("[vmControl] no VM with label",B)}catch(t){console.debug("[vmControl] discovery failed:",t.message)}return null}function a(t,e){!g||!E||(g.className="status-dot",g.classList.add(`status-${t}`),E.textContent=e)}async function d(){a("yellow","Checking...");try{if(await y(),!v)throw new Error("VM not discovered");console.debug("[vmControl] checking status:",v);let t=performance.now(),e=await fetch(v,{signal:AbortSignal.timeout(1e4)});if(console.debug("[vmControl] status response:",e.status,`(${((performance.now()-t)/1e3).toFixed(1)}s)`),e.ok){let o=await e.json();console.debug("[vmControl] health data:",JSON.stringify(o)),o.health==="online"?(a("green","Server Online"),r&&(r.textContent="")):(a("red","Server Offline"),r&&(r.textContent="Server is offline."))}else throw new Error(`API HTTP ${e.status}`)}catch(t){console.debug("[vmControl] status check failed:",t.message),a("blue","Status Unknown"),r&&(r.textContent="Could not check server status.")}}async function p(t){if(u||await y(),u||await y(),!u){a("blue","VM not found"),r&&(r.textContent="Could not discover VM.");return}let o={start:$,stop:H,reset:I}[t];if(o){console.debug("[vmControl] action:",t,"\u2192 POST",o),a("yellow",`Sending ${t}...`),r&&(r.textContent=`Sending ${t} command...`);try{let n=performance.now(),s=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},signal:AbortSignal.timeout(3e4)});if(console.debug("[vmControl] action response:",s.status,`(${((performance.now()-n)/1e3).toFixed(1)}s)`),s.ok){let i=await s.json();console.debug("[vmControl] action result:",JSON.stringify(i));let c={start:"VM starting...",stop:"VM stopping...",reset:"VM resetting..."};a("yellow",c[t]),r&&(r.textContent=c[t]),setTimeout(()=>d(),1e4),setTimeout(()=>d(),3e4),setTimeout(()=>d(),6e4)}else{let i=await s.json().catch(()=>({}));console.debug("[vmControl] action failed:",s.status,i),a("red",`${t} failed`),r&&(r.textContent=i.message||`${t} failed`),await d()}}catch(n){console.debug("[vmControl] action error:",n.message),a("blue","Could not reach API"),r&&(r.textContent="Could not reach API."),await d()}}}function k(){g=document.getElementById("status-dot"),E=document.getElementById("status-text"),r=document.getElementById("wake-status");let t=document.getElementById("vm-start-btn"),e=document.getElementById("vm-stop-btn"),o=document.getElementById("vm-reset-btn"),n=document.getElementById("vm-refresh-btn");t&&t.addEventListener("click",()=>p("start")),e&&e.addEventListener("click",()=>p("stop")),o&&o.addEventListener("click",()=>p("reset")),n&&n.addEventListener("click",()=>d()),d(),setInterval(d,3e4)}document.addEventListener("DOMContentLoaded",()=>{T(),x(),A(),k(),m()});})();
