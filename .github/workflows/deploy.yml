name: GitHub Pages Deployment (CI)

on:
  push:
    branches: ["main"]

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¦ Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Needed to compare changes

      - name: ğŸ“‚ Get Changed Files
        id: changed-files
        uses: tj-actions/changed-files@v41

      # ============================================
      # SETUP NODE.JS
      # ============================================
      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: ğŸ“¦ Install Dependencies
        run: |
          echo "ğŸ“¦ Installing npm dependencies..."
          npm install
          echo "âœ… Dependencies installed"

      # ============================================
      # PROJECT BUILDS (All use build.sh)
      # ============================================
      - name: ğŸ”¨ Build Root Index (c_root)
        id: build-c-root
        if: contains(steps.changed-files.outputs.all_changed_files, 'c_root/')
        continue-on-error: false
        run: |
          echo "ğŸ”¨ Building Root Index (c_root)..."
          cd c_root/1.ops
          bash build.sh build
          cd ../../
          echo "âœ… Root Index build complete"

      - name: ğŸ”¨ Build Landpage
        id: build-landpage
        if: contains(steps.changed-files.outputs.all_changed_files, 'b_Work_Profiles/landpage/')
        continue-on-error: false
        run: |
          echo "ğŸ”¨ Building Landpage..."
          cd b_Work_Profiles/landpage/1.ops
          bash build.sh build
          cd ../../..
          echo "âœ… Landpage build complete"

      - name: ğŸ”¨ Build Linktree
        id: build-linktree
        if: contains(steps.changed-files.outputs.all_changed_files, 'a_Portals/linktree/')
        continue-on-error: false
        run: |
          echo "ğŸ”¨ Building Linktree..."
          cd a_Portals/linktree/1.ops
          bash build.sh build
          cd ../../..
          echo "âœ… Linktree build complete"

      - name: ğŸ”¨ Build Linktree Mindmap
        id: build-linktree-mindmap
        if: contains(steps.changed-files.outputs.all_changed_files, 'a_Portals/linktree_mindmap/')
        continue-on-error: false
        run: |
          echo "ğŸ”¨ Building Linktree Mindmap..."
          cd a_Portals/linktree_mindmap/1.ops
          bash build.sh build
          cd ../../..
          echo "âœ… Linktree Mindmap build complete"

      - name: ğŸ”¨ Build CV Web
        id: build-cv-web
        if: contains(steps.changed-files.outputs.all_changed_files, 'b_Work_Profiles/cv_web/')
        continue-on-error: false
        run: |
          echo "ğŸ”¨ Building CV Web..."
          cd b_Work_Profiles/cv_web/1.ops
          bash build.sh build
          cd ../../..
          echo "âœ… CV Web build complete"

      - name: ğŸ”¨ Build MyFeed
        id: build-myfeed
        if: contains(steps.changed-files.outputs.all_changed_files, 'c_Personal_Tools/myfeed/')
        continue-on-error: false
        run: |
          echo "ğŸ”¨ Building MyFeed..."
          cd c_Personal_Tools/myfeed/1.ops
          bash build.sh build
          cd ../../..
          echo "âœ… MyFeed build complete"

      - name: ğŸ”¨ Build MyGames
        id: build-mygames
        if: contains(steps.changed-files.outputs.all_changed_files, 'c_Personal_Tools/mygames/')
        continue-on-error: false
        run: |
          echo "ğŸ”¨ Building MyGames..."
          cd c_Personal_Tools/mygames/1.ops
          bash build.sh build
          cd ../../..
          echo "âœ… MyGames build complete"

      - name: ğŸ”¨ Build Nexus
        id: build-nexus
        if: contains(steps.changed-files.outputs.all_changed_files, 'b_Work_Profiles/nexus/')
        continue-on-error: false
        run: |
          echo "ğŸ”¨ Building Nexus..."
          cd b_Work_Profiles/nexus/1.ops
          bash build.sh build
          cd ../../..
          echo "âœ… Nexus build complete"

      - name: ğŸ”¨ Build Cloud Dashboard
        id: build-cloud
        if: contains(steps.changed-files.outputs.all_changed_files, 'a_Portals/cloud/')
        continue-on-error: false
        run: |
          echo "ğŸ”¨ Building Cloud Dashboard..."
          cd a_Portals/cloud/1.ops
          bash build.sh build
          cd ../../..
          echo "âœ… Cloud Dashboard build complete"

      - name: ğŸ”¨ Build Feed Yourself
        id: build-feed-yourself
        if: contains(steps.changed-files.outputs.all_changed_files, 'c_Personal_Tools/feed_yourself/')
        continue-on-error: false
        run: |
          echo "ğŸ”¨ Building Feed Yourself..."
          cd c_Personal_Tools/feed_yourself/1.ops
          bash build.sh build
          cd ../../..
          echo "âœ… Feed Yourself build complete"

      - name: ğŸ”¨ Build Others
        id: build-others
        if: contains(steps.changed-files.outputs.all_changed_files, 'c_Personal_Tools/others/')
        continue-on-error: false
        run: |
          echo "ğŸ”¨ Building Others..."
          cd c_Personal_Tools/others/1.ops
          bash build.sh build
          cd ../../..
          echo "âœ… Others build complete"

      - name: ğŸ”¨ Build MyMail
        id: build-mymail
        if: contains(steps.changed-files.outputs.all_changed_files, 'b_Work_Tools/mymail/')
        continue-on-error: false
        run: |
          echo "ğŸ”¨ Building MyMail..."
          cd b_Work_Tools/mymail/1.ops
          bash build.sh build
          cd ../../..
          echo "âœ… MyMail build complete"

      - name: ğŸ”¨ Build MyPhotos
        id: build-myphotos
        if: contains(steps.changed-files.outputs.all_changed_files, 'b_Work_Tools/myphotos/')
        continue-on-error: false
        run: |
          echo "ğŸ”¨ Building MyPhotos..."
          cd b_Work_Tools/myphotos/1.ops
          bash build.sh build
          cd ../../..
          echo "âœ… MyPhotos build complete"

      - name: ğŸ”¨ Build MyAnalytics
        id: build-myanalytics
        if: contains(steps.changed-files.outputs.all_changed_files, 'b_Work_Tools/myanalytics/')
        continue-on-error: false
        run: |
          echo "ğŸ”¨ Building MyAnalytics..."
          cd b_Work_Tools/myanalytics/1.ops
          bash build.sh build
          cd ../../..
          echo "âœ… MyAnalytics build complete"

      - name: ğŸ”¨ Build MyDrive
        id: build-mydrive
        if: contains(steps.changed-files.outputs.all_changed_files, 'b_Work_Tools/mydrive/')
        continue-on-error: false
        run: |
          echo "ğŸ”¨ Building MyDrive..."
          cd b_Work_Tools/mydrive/1.ops
          bash build.sh build
          cd ../../..
          echo "âœ… MyDrive build complete"

      - name: ğŸ”¨ Build Health Tracker
        id: build-health-tracker
        if: contains(steps.changed-files.outputs.all_changed_files, 'c_Personal_Tools/health_tracker/')
        continue-on-error: false
        run: |
          echo "ğŸ”¨ Building Health Tracker..."
          cd c_Personal_Tools/health_tracker/1.ops
          bash build.sh build
          cd ../../..
          echo "âœ… Health Tracker build complete"

      - name: ğŸ”¨ Build Market Watch
        id: build-market-watch
        if: contains(steps.changed-files.outputs.all_changed_files, 'c_Personal_Tools/market_watch/')
        continue-on-error: false
        run: |
          echo "ğŸ”¨ Building Market Watch..."
          cd c_Personal_Tools/market_watch/1.ops
          bash build.sh build
          cd ../../..
          echo "âœ… Market Watch build complete"

      - name: ğŸ”¨ Build Central Bank
        id: build-central-bank
        if: contains(steps.changed-files.outputs.all_changed_files, 'c_Personal_Tools/central_bank/')
        continue-on-error: false
        run: |
          echo "ğŸ”¨ Building Central Bank..."
          cd c_Personal_Tools/central_bank/1.ops
          bash build.sh build
          cd ../../..
          echo "âœ… Central Bank build complete"

      # NOTE: Old MyMaps (React+Vite) moved to c_Personal_Tools/maps/
      # New MyMaps (SvelteKit) is at c_Personal_Tools/mymaps/

      - name: ğŸ”¨ Build MyProfile
        id: build-myprofile
        if: contains(steps.changed-files.outputs.all_changed_files, 'c_Personal_Profiles/myprofile/')
        continue-on-error: false
        run: |
          echo "ğŸ”¨ Building MyProfile..."
          cd c_Personal_Profiles/myprofile/1.ops
          bash build.sh build
          cd ../../..
          echo "âœ… MyProfile build complete"

      - name: ğŸ”¨ Build MyMovies (Vue 3)
        id: build-mymovies
        if: contains(steps.changed-files.outputs.all_changed_files, 'c_Personal_Tools/mymovies/')
        continue-on-error: false
        run: |
          echo "ğŸ”¨ Building MyMovies..."
          cd c_Personal_Tools/mymovies/1.ops
          bash build.sh build
          cd ../../..
          echo "âœ… MyMovies build complete"

      - name: ğŸ”¨ Build MyMusic (Vue 3)
        id: build-mymusic
        if: contains(steps.changed-files.outputs.all_changed_files, 'c_Personal_Tools/mymusic/')
        continue-on-error: false
        run: |
          echo "ğŸ”¨ Building MyMusic..."
          cd c_Personal_Tools/mymusic/1.ops
          bash build.sh build
          cd ../../..
          echo "âœ… MyMusic build complete"

      - name: ğŸ”¨ Build JSON Vision (Vue 3)
        id: build-json-vision
        if: contains(steps.changed-files.outputs.all_changed_files, 'c_Personal_Tools/json-vision/')
        continue-on-error: false
        run: |
          echo "ğŸ”¨ Building JSON Vision..."
          cd c_Personal_Tools/json-vision/1.ops
          bash build.sh build
          cd ../../..
          echo "âœ… JSON Vision build complete"

      - name: ğŸ”¨ Build Carto (TypeScript + Sass)
        id: build-carto
        if: contains(steps.changed-files.outputs.all_changed_files, 'c_Personal_Tools/carto/')
        continue-on-error: false
        run: |
          echo "ğŸ”¨ Building Carto..."
          cd c_Personal_Tools/carto/1.ops
          bash build.sh build
          cd ../../..
          echo "âœ… Carto build complete"

      - name: ğŸ”¨ Build MyTrips (Vue 3 + TypeScript + SCSS)
        id: build-mytrips
        if: contains(steps.changed-files.outputs.all_changed_files, 'c_Personal_Tools/mytrips/')
        continue-on-error: false
        run: |
          echo "ğŸ”¨ Building MyTrips..."
          cd c_Personal_Tools/mytrips/1.ops
          bash build.sh build
          cd ../../..
          echo "âœ… MyTrips build complete"

      - name: ğŸ”¨ Build Leafy (TypeScript + SCSS + Shaders)
        id: build-leafy
        if: contains(steps.changed-files.outputs.all_changed_files, 'b_Work_Profiles/leafy/')
        continue-on-error: false
        run: |
          echo "ğŸ”¨ Building Leafy..."
          cd b_Work_Profiles/leafy/1.ops
          bash build.sh
          cd ../../..
          echo "âœ… Leafy build complete"

      - name: ğŸ”¨ Build MyMaps SvelteKit (SvelteKit + MapLibre)
        id: build-mymaps-svelte
        if: contains(steps.changed-files.outputs.all_changed_files, 'c_Personal_Tools/mymaps/')
        continue-on-error: false
        run: |
          echo "ğŸ”¨ Building MyMaps SvelteKit..."
          cd c_Personal_Tools/mymaps/1.ops
          bash build.sh build
          cd ../../..
          echo "âœ… MyMaps SvelteKit build complete"

      - name: ğŸ”¨ Build Maps Classic (React + Vite)
        id: build-maps-classic
        if: contains(steps.changed-files.outputs.all_changed_files, 'c_Personal_Tools/maps/')
        continue-on-error: false
        run: |
          echo "ğŸ”¨ Building Maps Classic..."
          cd c_Personal_Tools/maps/1.ops
          bash build.sh build
          cd ../../..
          echo "âœ… Maps Classic build complete"

      # ============================================
      # BUILD STATUS SUMMARY
      # ============================================
      - name: ğŸ“Š Build Status Summary
        run: |
          echo "============================================"
          echo "ğŸ“Š BUILD STATUS SUMMARY"
          echo "============================================"
          FAILED=""

          if [ "${{ steps.build-c-root.outcome }}" == "failure" ]; then
            echo "âŒ FAILED: Root Index (c_root)"
            FAILED="$FAILED c_root"
          elif [ "${{ steps.build-c-root.outcome }}" == "success" ]; then
            echo "âœ… SUCCESS: Root Index (c_root)"
          fi

          if [ "${{ steps.build-landpage.outcome }}" == "failure" ]; then
            echo "âŒ FAILED: Landpage"
            FAILED="$FAILED landpage"
          elif [ "${{ steps.build-landpage.outcome }}" == "success" ]; then
            echo "âœ… SUCCESS: Landpage"
          fi

          if [ "${{ steps.build-linktree.outcome }}" == "failure" ]; then
            echo "âŒ FAILED: Linktree"
            FAILED="$FAILED linktree"
          elif [ "${{ steps.build-linktree.outcome }}" == "success" ]; then
            echo "âœ… SUCCESS: Linktree"
          fi

          if [ "${{ steps.build-linktree-mindmap.outcome }}" == "failure" ]; then
            echo "âŒ FAILED: Linktree Mindmap"
            FAILED="$FAILED linktree_mindmap"
          elif [ "${{ steps.build-linktree-mindmap.outcome }}" == "success" ]; then
            echo "âœ… SUCCESS: Linktree Mindmap"
          fi

          if [ "${{ steps.build-cv-web.outcome }}" == "failure" ]; then
            echo "âŒ FAILED: CV Web"
            FAILED="$FAILED cv_web"
          elif [ "${{ steps.build-cv-web.outcome }}" == "success" ]; then
            echo "âœ… SUCCESS: CV Web"
          fi

          if [ "${{ steps.build-myfeed.outcome }}" == "failure" ]; then
            echo "âŒ FAILED: MyFeed"
            FAILED="$FAILED myfeed"
          elif [ "${{ steps.build-myfeed.outcome }}" == "success" ]; then
            echo "âœ… SUCCESS: MyFeed"
          fi

          if [ "${{ steps.build-mygames.outcome }}" == "failure" ]; then
            echo "âŒ FAILED: MyGames"
            FAILED="$FAILED mygames"
          elif [ "${{ steps.build-mygames.outcome }}" == "success" ]; then
            echo "âœ… SUCCESS: MyGames"
          fi

          if [ "${{ steps.build-nexus.outcome }}" == "failure" ]; then
            echo "âŒ FAILED: Nexus"
            FAILED="$FAILED nexus"
          elif [ "${{ steps.build-nexus.outcome }}" == "success" ]; then
            echo "âœ… SUCCESS: Nexus"
          fi

          if [ "${{ steps.build-cloud.outcome }}" == "failure" ]; then
            echo "âŒ FAILED: Cloud Dashboard"
            FAILED="$FAILED cloud"
          elif [ "${{ steps.build-cloud.outcome }}" == "success" ]; then
            echo "âœ… SUCCESS: Cloud Dashboard"
          fi

          if [ "${{ steps.build-feed-yourself.outcome }}" == "failure" ]; then
            echo "âŒ FAILED: Feed Yourself"
            FAILED="$FAILED feed_yourself"
          elif [ "${{ steps.build-feed-yourself.outcome }}" == "success" ]; then
            echo "âœ… SUCCESS: Feed Yourself"
          fi

          if [ "${{ steps.build-others.outcome }}" == "failure" ]; then
            echo "âŒ FAILED: Others"
            FAILED="$FAILED others"
          elif [ "${{ steps.build-others.outcome }}" == "success" ]; then
            echo "âœ… SUCCESS: Others"
          fi

          if [ "${{ steps.build-health-tracker.outcome }}" == "failure" ]; then
            echo "âŒ FAILED: Health Tracker"
            FAILED="$FAILED health_tracker"
          elif [ "${{ steps.build-health-tracker.outcome }}" == "success" ]; then
            echo "âœ… SUCCESS: Health Tracker"
          fi

          if [ "${{ steps.build-market-watch.outcome }}" == "failure" ]; then
            echo "âŒ FAILED: Market Watch"
            FAILED="$FAILED market_watch"
          elif [ "${{ steps.build-market-watch.outcome }}" == "success" ]; then
            echo "âœ… SUCCESS: Market Watch"
          fi

          if [ "${{ steps.build-central-bank.outcome }}" == "failure" ]; then
            echo "âŒ FAILED: Central Bank"
            FAILED="$FAILED central_bank"
          elif [ "${{ steps.build-central-bank.outcome }}" == "success" ]; then
            echo "âœ… SUCCESS: Central Bank"
          fi

          if [ "${{ steps.build-mymaps.outcome }}" == "failure" ]; then
            echo "âŒ FAILED: MyMaps"
            FAILED="$FAILED mymaps"
          elif [ "${{ steps.build-mymaps.outcome }}" == "success" ]; then
            echo "âœ… SUCCESS: MyMaps"
          fi

          if [ "${{ steps.build-myprofile.outcome }}" == "failure" ]; then
            echo "âŒ FAILED: MyProfile"
            FAILED="$FAILED myprofile"
          elif [ "${{ steps.build-myprofile.outcome }}" == "success" ]; then
            echo "âœ… SUCCESS: MyProfile"
          fi

          if [ "${{ steps.build-mymovies.outcome }}" == "failure" ]; then
            echo "âŒ FAILED: MyMovies"
            FAILED="$FAILED mymovies"
          elif [ "${{ steps.build-mymovies.outcome }}" == "success" ]; then
            echo "âœ… SUCCESS: MyMovies"
          fi

          if [ "${{ steps.build-mymusic.outcome }}" == "failure" ]; then
            echo "âŒ FAILED: MyMusic"
            FAILED="$FAILED mymusic"
          elif [ "${{ steps.build-mymusic.outcome }}" == "success" ]; then
            echo "âœ… SUCCESS: MyMusic"
          fi

          if [ "${{ steps.build-json-vision.outcome }}" == "failure" ]; then
            echo "âŒ FAILED: JSON Vision"
            FAILED="$FAILED json-vision"
          elif [ "${{ steps.build-json-vision.outcome }}" == "success" ]; then
            echo "âœ… SUCCESS: JSON Vision"
          fi

          if [ "${{ steps.build-carto.outcome }}" == "failure" ]; then
            echo "âŒ FAILED: Carto"
            FAILED="$FAILED carto"
          elif [ "${{ steps.build-carto.outcome }}" == "success" ]; then
            echo "âœ… SUCCESS: Carto"
          fi

          if [ "${{ steps.build-mytrips.outcome }}" == "failure" ]; then
            echo "âŒ FAILED: MyTrips"
            FAILED="$FAILED mytrips"
          elif [ "${{ steps.build-mytrips.outcome }}" == "success" ]; then
            echo "âœ… SUCCESS: MyTrips"
          fi

          if [ "${{ steps.build-leafy.outcome }}" == "failure" ]; then
            echo "âŒ FAILED: Leafy"
            FAILED="$FAILED leafy"
          elif [ "${{ steps.build-leafy.outcome }}" == "success" ]; then
            echo "âœ… SUCCESS: Leafy"
          fi

          if [ "${{ steps.build-mymaps-svelte.outcome }}" == "failure" ]; then
            echo "âŒ FAILED: MyMaps SvelteKit"
            FAILED="$FAILED mymaps-svelte"
          elif [ "${{ steps.build-mymaps-svelte.outcome }}" == "success" ]; then
            echo "âœ… SUCCESS: MyMaps SvelteKit"
          fi

          if [ "${{ steps.build-maps-classic.outcome }}" == "failure" ]; then
            echo "âŒ FAILED: Maps Classic"
            FAILED="$FAILED maps-classic"
          elif [ "${{ steps.build-maps-classic.outcome }}" == "success" ]; then
            echo "âœ… SUCCESS: Maps Classic"
          fi

          if [ "${{ steps.build-mymail.outcome }}" == "failure" ]; then
            echo "âŒ FAILED: MyMail"
            FAILED="$FAILED mymail"
          elif [ "${{ steps.build-mymail.outcome }}" == "success" ]; then
            echo "âœ… SUCCESS: MyMail"
          fi

          if [ "${{ steps.build-myphotos.outcome }}" == "failure" ]; then
            echo "âŒ FAILED: MyPhotos"
            FAILED="$FAILED myphotos"
          elif [ "${{ steps.build-myphotos.outcome }}" == "success" ]; then
            echo "âœ… SUCCESS: MyPhotos"
          fi

          if [ "${{ steps.build-myanalytics.outcome }}" == "failure" ]; then
            echo "âŒ FAILED: MyAnalytics"
            FAILED="$FAILED myanalytics"
          elif [ "${{ steps.build-myanalytics.outcome }}" == "success" ]; then
            echo "âœ… SUCCESS: MyAnalytics"
          fi

          if [ "${{ steps.build-mydrive.outcome }}" == "failure" ]; then
            echo "âŒ FAILED: MyDrive"
            FAILED="$FAILED mydrive"
          elif [ "${{ steps.build-mydrive.outcome }}" == "success" ]; then
            echo "âœ… SUCCESS: MyDrive"
          fi

          echo "============================================"

          if [ -n "$FAILED" ]; then
            echo "âš ï¸ WARNING: Some builds failed:$FAILED"
            echo "âš ï¸ Deployment will continue with existing dist/ files for failed projects"
            echo ""
            echo "::warning::Build failures detected:$FAILED - check logs above for details"
          else
            echo "âœ… All triggered builds completed successfully!"
          fi

      - name: ğŸŒ Setup Pages Environment
        uses: actions/configure-pages@v5

      - name: ğŸ“‚ Prepare Site for Deployment
        run: |
          echo "ğŸ“‹ Creating _site directory and copying all files..."
          mkdir -p _site

          # Copy c_root build to ROOT of _site (this is the main index.html)
          if [ -d "c_root/dist" ]; then
            echo "ğŸ“¦ Copying Root Index (c_root) to _site root..."
            cp -rL c_root/dist/* _site/ 2>/dev/null || cp -r c_root/dist/* _site/
            echo "âœ… Root Index copied to _site/"
          else
            echo "â­ï¸  Skipping Root Index copy (no dist directory found)"
          fi

          # Copy cv_pdf build (dist contents only)
          if [ -d "b_Work_Profiles/cv_pdf/dist" ]; then
            echo "ğŸ“¦ Copying CV PDF build..."
            mkdir -p _site/cv_pdf
            cp -rL b_Work_Profiles/cv_pdf/dist/* _site/cv_pdf/ 2>/dev/null || cp -r b_Work_Profiles/cv_pdf/dist/* _site/cv_pdf/
            echo "âœ… CV PDF build copied to _site/cv_pdf/"
          fi

          # Copy others (static site)
          cp -r c_Personal_Tools/others/ _site/ 2>/dev/null || true

          # Copy MyMail build (if dist exists)
          if [ -d "b_Work_Tools/mymail/dist" ]; then
            echo "ğŸ“¦ Copying MyMail build..."
            mkdir -p _site/mymail
            cp -r b_Work_Tools/mymail/dist/* _site/mymail/
            echo "âœ… MyMail build copied to _site/mymail/"
          fi

          # Copy MyPhotos build (if dist exists)
          if [ -d "b_Work_Tools/myphotos/dist" ]; then
            echo "ğŸ“¦ Copying MyPhotos build..."
            mkdir -p _site/myphotos
            cp -r b_Work_Tools/myphotos/dist/* _site/myphotos/
            echo "âœ… MyPhotos build copied to _site/myphotos/"
          fi

          # Copy MyAnalytics build (if dist exists)
          if [ -d "b_Work_Tools/myanalytics/dist" ]; then
            echo "ğŸ“¦ Copying MyAnalytics build..."
            mkdir -p _site/myanalytics
            cp -r b_Work_Tools/myanalytics/dist/* _site/myanalytics/
            echo "âœ… MyAnalytics build copied to _site/myanalytics/"
          fi

          # Copy MyDrive build (if dist exists)
          if [ -d "b_Work_Tools/mydrive/dist" ]; then
            echo "ğŸ“¦ Copying MyDrive build..."
            mkdir -p _site/mydrive
            cp -r b_Work_Tools/mydrive/dist/* _site/mydrive/
            echo "âœ… MyDrive build copied to _site/mydrive/"
          fi

          # Copy Linktree build (if dist exists)
          if [ -d "a_Portals/linktree/dist" ]; then
            echo "ğŸ“¦ Copying Linktree build..."
            mkdir -p _site/linktree
            # Use -L to dereference symlinks (dist may contain symlinks to public/)
            cp -rL a_Portals/linktree/dist/* _site/linktree/ 2>/dev/null || cp -r a_Portals/linktree/dist/* _site/linktree/
            cp -r a_Portals/linktree/public/* _site/linktree/ 2>/dev/null || true
            echo "âœ… Linktree build copied to _site/linktree/"
          fi

          # Copy Linktree Mindmap build (if dist exists)
          if [ -d "a_Portals/linktree_mindmap/dist" ]; then
            echo "ğŸ“¦ Copying Linktree Mindmap build..."
            mkdir -p _site/linktree_mindmap
            cp -rL a_Portals/linktree_mindmap/dist/* _site/linktree_mindmap/ 2>/dev/null || cp -r a_Portals/linktree_mindmap/dist/* _site/linktree_mindmap/
            echo "âœ… Linktree Mindmap build copied to _site/linktree_mindmap/"
          else
            echo "â­ï¸  Skipping Linktree Mindmap copy (no dist directory found)"
          fi

          # Copy CV Web build (if dist exists)
          if [ -d "b_Work_Profiles/cv_web/dist" ]; then
            echo "ğŸ“¦ Copying CV Web build..."
            mkdir -p _site/cv_web
            # Use -L to dereference symlinks (dist contains symlinks to public/)
            cp -rL b_Work_Profiles/cv_web/dist/* _site/cv_web/ 2>/dev/null || cp -r b_Work_Profiles/cv_web/dist/* _site/cv_web/
            cp -r b_Work_Profiles/cv_web/public/* _site/cv_web/ 2>/dev/null || true
            echo "âœ… CV Web build copied to _site/cv_web/"
          fi

          # Copy Landpage (main landing page)
          if [ -d "b_Work_Profiles/landpage/dist" ]; then
            echo "ğŸ“¦ Copying Landpage build..."
            mkdir -p _site/landpage
            # Use -L to dereference symlinks (dist contains symlinks to public/)
            cp -rL b_Work_Profiles/landpage/dist/* _site/landpage/ 2>/dev/null || cp -r b_Work_Profiles/landpage/dist/* _site/landpage/
            echo "âœ… Landpage build copied to _site/landpage/"
          elif [ -d "b_Work_Profiles/landpage/src_static" ]; then
            echo "ğŸ“¦ Copying Landpage src_static..."
            mkdir -p _site/landpage
            cp b_Work_Profiles/landpage/src_static/index.html landpage/src_static/style.css landpage/src_static/script.js _site/landpage/ 2>/dev/null || true
            cp -r b_Work_Profiles/landpage/public _site/landpage/ 2>/dev/null || true
            echo "âœ… Landpage src_static copied to _site/landpage/"
          fi

          # Copy MyFeed Vue build (if dist exists)
          if [ -d "c_Personal_Tools/myfeed/dist" ]; then
            echo "ğŸ“¦ Copying MyFeed Vue build..."
            mkdir -p _site/myfeed
            cp -rL c_Personal_Tools/myfeed/dist/* _site/myfeed/ 2>/dev/null || cp -r c_Personal_Tools/myfeed/dist/* _site/myfeed/
            echo "âœ… MyFeed Vue build copied to _site/myfeed/"
          else
            echo "â­ï¸  Skipping MyFeed copy (no dist directory found)"
          fi

          # Copy MyGames SvelteKit build (if dist exists)
          if [ -d "c_Personal_Tools/mygames/dist" ]; then
            echo "ğŸ“¦ Copying MyGames SvelteKit build..."
            mkdir -p _site/mygames
            cp -rL c_Personal_Tools/mygames/dist/* _site/mygames/ 2>/dev/null || cp -r c_Personal_Tools/mygames/dist/* _site/mygames/
            echo "âœ… MyGames build copied to _site/mygames/"
          else
            echo "â­ï¸  Skipping MyGames copy (no dist directory found)"
          fi

          # Copy Nexus Vue build (if dist exists)
          if [ -d "b_Work_Profiles/nexus/dist" ]; then
            echo "ğŸ“¦ Copying Nexus Holdings build..."
            mkdir -p _site/nexus
            cp -rL b_Work_Profiles/nexus/dist/* _site/nexus/ 2>/dev/null || cp -r b_Work_Profiles/nexus/dist/* _site/nexus/
            echo "âœ… Nexus build copied to _site/nexus/"
          else
            echo "â­ï¸  Skipping Nexus copy (no dist directory found)"
          fi

          # Copy Cloud Dashboard build (if dist exists)
          if [ -d "a_Portals/cloud/dist" ]; then
            echo "ğŸ“¦ Copying Cloud Dashboard build..."
            mkdir -p _site/cloud
            cp -rL a_Portals/cloud/dist/* _site/cloud/ 2>/dev/null || cp -r a_Portals/cloud/dist/* _site/cloud/
            echo "âœ… Cloud Dashboard build copied to _site/cloud/"
          else
            echo "â­ï¸  Skipping Cloud Dashboard copy (no dist directory found)"
          fi

          # Copy API Docs (Swagger UI) - static files, no build needed
          if [ -d "b_Work_Tools/api/src" ]; then
            echo "ğŸ“¦ Copying API Docs (Swagger UI)..."
            mkdir -p _site/api
            cp -rL b_Work_Tools/api/src/* _site/api/ 2>/dev/null || cp -r b_Work_Tools/api/src/* _site/api/
            echo "âœ… API Docs copied to _site/api/"
          else
            echo "â­ï¸  Skipping API Docs copy (no src directory found)"
          fi

          # Copy Feed Yourself build (if dist exists)
          if [ -d "c_Personal_Tools/feed_yourself/dist" ]; then
            echo "ğŸ“¦ Copying Feed Yourself build..."
            mkdir -p _site/feed_yourself
            cp -rL c_Personal_Tools/feed_yourself/dist/* _site/feed_yourself/ 2>/dev/null || cp -r c_Personal_Tools/feed_yourself/dist/* _site/feed_yourself/
            echo "âœ… Feed Yourself build copied to _site/feed_yourself/"
          else
            echo "â­ï¸  Skipping Feed Yourself copy (no dist directory found)"
          fi

          # Copy Health Tracker build (if dist exists)
          if [ -d "c_Personal_Tools/health_tracker/dist" ]; then
            echo "ğŸ“¦ Copying Health Tracker build..."
            mkdir -p _site/health_tracker
            cp -rL c_Personal_Tools/health_tracker/dist/* _site/health_tracker/ 2>/dev/null || cp -r c_Personal_Tools/health_tracker/dist/* _site/health_tracker/
            echo "âœ… Health Tracker build copied to _site/health_tracker/"
          else
            echo "â­ï¸  Skipping Health Tracker copy (no dist directory found)"
          fi

          # Copy Market Watch build (if dist exists)
          if [ -d "c_Personal_Tools/market_watch/dist" ]; then
            echo "ğŸ“¦ Copying Market Watch build..."
            mkdir -p _site/market_watch
            cp -rL c_Personal_Tools/market_watch/dist/* _site/market_watch/ 2>/dev/null || cp -r c_Personal_Tools/market_watch/dist/* _site/market_watch/
            echo "âœ… Market Watch build copied to _site/market_watch/"
          else
            echo "â­ï¸  Skipping Market Watch copy (no dist directory found)"
          fi

          # Copy Central Bank Forecasting build (if dist exists)
          if [ -d "c_Personal_Tools/central_bank/dist" ]; then
            echo "ğŸ“¦ Copying Central Bank Forecasting build..."
            mkdir -p _site/central_bank
            cp -rL c_Personal_Tools/central_bank/dist/* _site/central_bank/ 2>/dev/null || cp -r c_Personal_Tools/central_bank/dist/* _site/central_bank/
            echo "âœ… Central Bank Forecasting build copied to _site/central_bank/"
          else
            echo "â­ï¸  Skipping Central Bank Forecasting copy (no dist directory found)"
          fi

          # NOTE: Old MyMaps (React+Vite) moved to c_Personal_Tools/maps/
          # MyMaps SvelteKit copy is handled below

          # Copy MyProfile build (if dist exists - Nuxt static export)
          if [ -d "c_Personal_Profiles/myprofile/dist" ]; then
            echo "ğŸ“¦ Copying MyProfile build..."
            mkdir -p _site/myprofile
            cp -rL c_Personal_Profiles/myprofile/dist/* _site/myprofile/ 2>/dev/null || cp -r c_Personal_Profiles/myprofile/dist/* _site/myprofile/
            echo "âœ… MyProfile build copied to _site/myprofile/"
          else
            echo "â­ï¸  Skipping MyProfile copy (no dist directory found)"
          fi

          # Copy MyMovies build (if dist exists - Vue 3 single-file)
          if [ -d "c_Personal_Tools/mymovies/dist" ]; then
            echo "ğŸ“¦ Copying MyMovies build..."
            mkdir -p _site/mymovies
            cp -rL c_Personal_Tools/mymovies/dist/* _site/mymovies/ 2>/dev/null || cp -r c_Personal_Tools/mymovies/dist/* _site/mymovies/
            echo "âœ… MyMovies build copied to _site/mymovies/"
          else
            echo "â­ï¸  Skipping MyMovies copy (no dist directory found)"
          fi

          # Copy MyMusic build (if dist exists - Vue 3 single-file)
          if [ -d "c_Personal_Tools/mymusic/dist" ]; then
            echo "ğŸ“¦ Copying MyMusic build..."
            mkdir -p _site/mymusic
            cp -rL c_Personal_Tools/mymusic/dist/* _site/mymusic/ 2>/dev/null || cp -r c_Personal_Tools/mymusic/dist/* _site/mymusic/
            echo "âœ… MyMusic build copied to _site/mymusic/"
          else
            echo "â­ï¸  Skipping MyMusic copy (no dist directory found)"
          fi

          # Copy JSON Vision build (if dist exists - Vue 3 single-file)
          if [ -d "c_Personal_Tools/json-vision/dist" ]; then
            echo "ğŸ“¦ Copying JSON Vision build..."
            mkdir -p _site/json-vision
            cp -rL c_Personal_Tools/json-vision/dist/* _site/json-vision/ 2>/dev/null || cp -r c_Personal_Tools/json-vision/dist/* _site/json-vision/
            echo "âœ… JSON Vision build copied to _site/json-vision/"
          else
            echo "â­ï¸  Skipping JSON Vision copy (no dist directory found)"
          fi

          # Copy Skills & MCP Docs build (if dist exists)
          if [ -d "b_Work_Tools/skills_mcp/dist" ]; then
            echo "ğŸ“¦ Copying Skills & MCP Docs build..."
            mkdir -p _site/skills_mcp
            cp -rL b_Work_Tools/skills_mcp/dist/* _site/skills_mcp/ 2>/dev/null || cp -r b_Work_Tools/skills_mcp/dist/* _site/skills_mcp/
            echo "âœ… Skills & MCP Docs build copied to _site/skills_mcp/"
          else
            echo "â­ï¸  Skipping Skills & MCP Docs copy (no dist directory found)"
          fi

          # Copy Astro build (if dist exists - Nuxt static single-file)
          if [ -d "c_Personal_Tools/astro/dist" ]; then
            echo "ğŸ“¦ Copying Astro build..."
            mkdir -p _site/astro
            cp -rL c_Personal_Tools/astro/dist/* _site/astro/ 2>/dev/null || cp -r c_Personal_Tools/astro/dist/* _site/astro/
            echo "âœ… Astro build copied to _site/astro/"
          else
            echo "â­ï¸  Skipping Astro copy (no dist directory found)"
          fi

          # Copy Carto build (if dist exists - TypeScript + Sass single-file)
          if [ -d "c_Personal_Tools/carto/dist" ]; then
            echo "ğŸ“¦ Copying Carto build..."
            mkdir -p _site/carto
            cp -rL c_Personal_Tools/carto/dist/* _site/carto/ 2>/dev/null || cp -r c_Personal_Tools/carto/dist/* _site/carto/
            echo "âœ… Carto build copied to _site/carto/"
          else
            echo "â­ï¸  Skipping Carto copy (no dist directory found)"
          fi

          # Copy MyTrips build (if dist exists - Vue 3 + TypeScript + SCSS)
          if [ -d "c_Personal_Tools/mytrips/dist" ]; then
            echo "ğŸ“¦ Copying MyTrips build..."
            mkdir -p _site/mytrips
            cp -rL c_Personal_Tools/mytrips/dist/* _site/mytrips/ 2>/dev/null || cp -r c_Personal_Tools/mytrips/dist/* _site/mytrips/
            echo "âœ… MyTrips build copied to _site/mytrips/"
          else
            echo "â­ï¸  Skipping MyTrips copy (no dist directory found)"
          fi

          # Copy Leafy build (if dist exists - TypeScript + SCSS + Shaders)
          if [ -d "b_Work_Profiles/leafy/dist" ]; then
            echo "ğŸ“¦ Copying Leafy build..."
            mkdir -p _site/leafy
            cp -rL b_Work_Profiles/leafy/dist/* _site/leafy/ 2>/dev/null || cp -r b_Work_Profiles/leafy/dist/* _site/leafy/
            echo "âœ… Leafy build copied to _site/leafy/"
          else
            echo "â­ï¸  Skipping Leafy copy (no dist directory found)"
          fi

          # Copy MyMaps SvelteKit build (if dist exists - SvelteKit + MapLibre)
          if [ -d "c_Personal_Tools/mymaps/dist" ]; then
            echo "ğŸ“¦ Copying MyMaps SvelteKit build..."
            mkdir -p _site/mymaps
            cp -rL c_Personal_Tools/mymaps/dist/* _site/mymaps/ 2>/dev/null || cp -r c_Personal_Tools/mymaps/dist/* _site/mymaps/
            echo "âœ… MyMaps SvelteKit build copied to _site/mymaps/"
          else
            echo "â­ï¸  Skipping MyMaps SvelteKit copy (no dist directory found)"
          fi

          # Copy Maps Classic build (if dist exists - React + Vite)
          if [ -d "c_Personal_Tools/maps/dist" ]; then
            echo "ğŸ“¦ Copying Maps Classic build..."
            mkdir -p _site/maps
            cp -rL c_Personal_Tools/maps/dist/* _site/maps/ 2>/dev/null || cp -r c_Personal_Tools/maps/dist/* _site/maps/
            echo "âœ… Maps Classic build copied to _site/maps/"
          else
            echo "â­ï¸  Skipping Maps Classic copy (no dist directory found)"
          fi

          echo "âœ… All files prepared for deployment"

          # Remove any broken symlinks that could cause tar to fail
          echo "ğŸ”— Checking for broken symlinks..."
          find _site -type l ! -exec test -e {} \; -delete 2>/dev/null || true
          echo "âœ… Broken symlinks removed"

          echo "ğŸ“Š Site structure:"
          ls -lah _site/
          echo ""
          echo "ğŸ“Š MyFeed contents:"
          ls -lah _site/myfeed/ 2>/dev/null || echo "No myfeed directory"

      - name: â¬†ï¸ Upload Site Artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: _site

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: ğŸš€ Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
